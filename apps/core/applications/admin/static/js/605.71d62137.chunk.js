"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[605],{41442:function(e,n,t){t.d(n,{Z:function(){return m}});var r=t(33028),i=t(59740),a=t(80688),l=t(43157),o=(t(54681),t(39918)),s=t(5168),u=t(74280),d=t(19913),c=t(57450),f=["attributes"];var v=function(e){var n=e.attributes,t=void 0===n?[]:n,a=(0,i.Z)(e,f),l=(0,u.Z)().lang,o=t.map((function(e){return{key:e.id,value:e.id,text:(0,d.dX)(e.label,l)}}));return a.clearable&&o.unshift({key:"",value:"",text:""}),(0,c.jsx)(s.Z.Dropdown,(0,r.Z)((0,r.Z)({},(0,r.Z)((0,r.Z)({},a),{},{clearable:void 0})),{},{search:!0,options:o}))},p=["filters","excludeReverseLinks"];var m=function(e){var n,t=e.filters,s=void 0===t?{}:t,u=e.excludeReverseLinks,d=void 0!==u&&u,f=(0,i.Z)(e,p),m=(0,a.useQuery)(o.V,{variables:s}),b=m.loading,x=m.error,h=m.data;if(x)return(0,c.jsx)(l.Z,{message:x.message});var Z=(null===h||void 0===h||null===(n=h.attributes)||void 0===n?void 0:n.list)||[];return d&&(Z=Z.filter((function(e){return!e.reverse_link}))),(0,c.jsx)(v,(0,r.Z)((0,r.Z)({},f),{},{loading:b,attributes:Z}))}},39719:function(e,n,t){t.d(n,{Z:function(){return g}});var r=t(38777),i=t(34795),a=t(2867),l=t(77162),o=t.n(l),s=t(80688),u=t(54681),d=t(70663),c=t(33495),f=t(92042),v=t(39918),p=t(64449),m=t(31010),b=t(56022),x=t(57450),h=function(e){var n=(0,d.$G)().t,t=e.attributes,r=e.toggleSelection,i=e.selection;return(0,x.jsxs)(m.Z,{selectable:!0,striped:!0,children:[(0,x.jsx)(m.Z.Header,{children:(0,x.jsxs)(m.Z.Row,{children:[(0,x.jsx)(m.Z.HeaderCell,{}),(0,x.jsx)(m.Z.HeaderCell,{children:n("attributes.label")}),(0,x.jsx)(m.Z.HeaderCell,{children:n("attributes.ID")})]})}),(0,x.jsx)(m.Z.Body,{children:t.map((function(e){var n=null!==e.label&&(e.label.fr||e.label.en)||e.id,t=-1!==i.indexOf(e.id);return(0,x.jsxs)(m.Z.Row,{onClick:function(){return r(e)},active:t,children:[(0,x.jsx)(m.Z.Cell,{children:(0,x.jsx)(b.Z,{readOnly:!0,checked:t})}),(0,x.jsx)(m.Z.Cell,{children:n}),(0,x.jsx)(m.Z.Cell,{children:e.id})]},e.id)}))})]})},Z=function(e){var n=e.openModal,t=e.selection,l=e.onClose,m=e.onSubmit,b=e.filter,Z=(0,d.$G)().t,g=(0,u.useState)([]),y=(0,a.Z)(g,2),j=y[0],_=y[1],C=(0,u.useState)(!1),k=(0,a.Z)(C,2),I=k[0],S=k[1],w=(0,s.useQuery)(v.V,{variables:b}),A=w.loading,T=w.error,V=w.data,D=function(){_([]),l()},E=function(){var e=(0,i.Z)(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S(!0),e.next=3,m(j);case 3:S(!1);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return A?(0,x.jsx)(p.Z,{}):T?(0,x.jsxs)("div",{className:"error",children:["Error: ",T.message]}):V&&V.attributes?V.attributes&&(0,x.jsxs)(c.Z,{size:"small",open:n,onClose:D,centered:!0,closeOnDimmerClick:!0,closeOnEscape:!0,closeIcon:!0,children:[(0,x.jsx)(c.Z.Header,{children:Z("attributes.select_attributes")}),(0,x.jsx)(c.Z.Content,{scrolling:!0,children:(0,x.jsx)(h,{attributes:V.attributes.list.filter((function(e){return-1===t.indexOf(e.id)})),selection:j,toggleSelection:function(e){var n=-1!==j.indexOf(e.id)?j.filter((function(n){return n!==e.id})):[].concat((0,r.Z)(j),[e.id]);_(n)}})}),(0,x.jsxs)(c.Z.Actions,{children:[(0,x.jsx)(f.Z,{onClick:D,children:Z("admin.cancel")}),(0,x.jsx)(f.Z,{primary:!0,onClick:E,loading:I,disabled:I,children:Z("admin.submit")})]})]}):(0,x.jsx)(x.Fragment,{})},g=Z},9169:function(e,n,t){t.r(n),t.d(n,{default:function(){return $t}});var r,i,a,l,o,s=t(71171),u=t(80688),d=t(43157),c=t(95541),f=t(54681),v=t(37893),p=t(64449),m=t(2867),b=t(70663),x=t(47016),h=t(81592),Z=t(63851),g=t(74280),y=t(71446),j=t(52987),_=t(42737),C=t.n(_),k=C()(r||(r=(0,s.Z)(["\n    query GET_AVAILABLE_ACTIONS {\n        availableActions {\n            id\n            name\n            description\n            input_types\n            output_types\n            params {\n                name\n                type\n                description\n                required\n                default_value\n            }\n        }\n    }\n"]))),I=t(33028),S=t(56666),w=t(50576),A=C()(i||(i=(0,s.Z)(["\n    query GET_ACTIONS_LIST_QUERY($attId: ID!) {\n        attributes(filters: {id: $attId}) {\n            list {\n                id\n                format\n                input_types {\n                    saveValue\n                    getValue\n                    deleteValue\n                }\n                output_types {\n                    saveValue\n                    getValue\n                    deleteValue\n                }\n                actions_list {\n                    saveValue {\n                        id\n                        is_system\n                        params {\n                            name\n                            value\n                        }\n                    }\n                    getValue {\n                        id\n                        is_system\n                        params {\n                            name\n                            value\n                        }\n                    }\n                    deleteValue {\n                        id\n                        is_system\n                        params {\n                            name\n                            value\n                        }\n                    }\n                }\n            }\n        }\n    }\n"]))),T=C()(a||(a=(0,s.Z)(["\n    mutation SAVE_ATTRIBUTE_ACTION_LIST($att: AttributeInput!) {\n        saveAttribute(attribute: $att) {\n            id\n            actions_list {\n                saveValue {\n                    id\n                    params {\n                        name\n                        value\n                    }\n                }\n                getValue {\n                    id\n                    params {\n                        name\n                        value\n                    }\n                }\n                deleteValue {\n                    id\n                    params {\n                        name\n                        value\n                    }\n                }\n            }\n        }\n    }\n"]))),V=t(41344),D=t(92042),E=t(89301),G=t(85802),N=t(16392),P=t(55152),O=t(57450),$=v.ZP.div(l||(l=(0,s.Z)(["\n    width: 100%;\n    display: flex;\n    flex-direction: row;\n    border-radius: 3px;\n    overflow: hidden;\n    height: 5px;\n"]))),F=v.ZP.div(o||(o=(0,s.Z)(["\n    color: ",";\n    background-color: ",";\n    flex-grow: 1;\n    text-align: center;\n"])),(function(e){return e.iColor[2]>200&&e.iColor[1]<170?"#ffffff":"#000000"}),(function(e){return"rgb("+e.iColor[0]+","+e.iColor[1]+","+e.iColor[2]+")"}));var R,L,B,q,z,M,Q,U,Y,H=function(e){var n=e.inputs,t=e.dictionnary,r=e.isDragging,i=Object.keys(t);return(0,O.jsx)($,{isDragging:!!r,children:i&&i.map((function(e,r){return function(e,r){if(n){var i=n.includes(e)?t[e]:[205,205,205];return(0,O.jsx)(F,{iColor:i,title:e},r)}}(e,r)}))})},K="action",X=v.ZP.div(R||(R=(0,s.Z)(["\n    height: 100%;\n    display: grid;\n    grid-template-columns: 50% 50%;\n    justify-items: stretch;\n    overflow: hidden;\n"]))),J=v.ZP.div(L||(L=(0,s.Z)(["\n    position: relative;\n    height: 100%;\n    align-self: stretch;\n    display: flex;\n    flex-direction: column;\n    width: 100%;\n    margin-right: 5px;\n"]))),W=v.ZP.div(B||(B=(0,s.Z)(["\n    position: relative;\n    max-height: 100%;\n    align-self: stretch;\n    display: flex;\n    width: calc(100% - 5px);\n    margin-left: 5px;\n"]))),ee=v.ZP.div(q||(q=(0,s.Z)(["\n    height: 100%;\n    overflow-x: hidden;\n    overflow-y: scroll;\n    padding: 2px;\n    padding-right: 5px;\n    flex: 1 1 0;\n"]))),ne=v.ZP.div(z||(z=(0,s.Z)(["\n    display: flex;\n    flex-direction: column;\n    align-items: stretch;\n    width: 100%;\n"]))),te=v.ZP.div(M||(M=(0,s.Z)(["\n    padding: 0 5px;\n    position: relative;\n    flex: 1 0 0;\n    cursor: move;\n    border: 1px solid #bcbec0;\n    border-radius: 3px;\n    display: flex;\n    flex-direction: column;\n    overflow-y: auto;\n"]))),re=v.ZP.div(Q||(Q=(0,s.Z)(["\n    min-height: ",";\n    flex-grow: 1;\n    height: 'auto';\n"])),(function(e){return e.extend&&e.hover?"50px":"0px"})),ie=v.ZP.div(U||(U=(0,s.Z)(["\n    color: #c8c8c8;\n    font-size: 1.2em;\n    text-align: center;\n    padding-top: 30px;\n    margin: 3px;\n    height: 90px;\n    background: #ececec;\n    border: 2px dashed #c8c8c8;\n    border-radius: 3px;\n    box-shadow: inset 0px 0px 3px 0px #00000038;\n"]))),ae=v.ZP.div(Y||(Y=(0,s.Z)(["\n    background-color: ",";\n    border-style: solid;\n    border-color: #dddddd;\n    border-width: 0 2px 0 2px;\n    border-radius: 3px;\n    opacity: ",";\n    margin-top: ",";\n"])),(function(e){return e.isDragging?"#dddddd":"#f9fafb"}),(function(e){return e.opacity}),(function(e){return e.marginTop})),le=t(5168),oe=t(53259),se=t(98540),ue=t(35925);var de=function(e){var n=e.param,t=e.actionId,r=e.changeParam,i=e.setBlockCard,a=(e.index,(0,f.useState)(n?n.value?n.value:n.default_value:null)),l=(0,m.Z)(a,2),o=l[0],s=l[1],u={float:"number",integer:"number",boolean:"checkbox",string:"text",date:"date"},d=function(e){var i=e.target,a=n&&"checkbox"===u[n.type]?i.checked.toString():i.value.toString();s(a),n&&r&&r({actionId:t,paramName:n.name,value:a}),e.stopPropagation()},c=function(e){i(!0)},v=function(){i(!1)};return(0,O.jsx)("div",{children:n&&(0,O.jsx)(O.Fragment,{children:"textarea"===n.type?(0,O.jsxs)(le.Z,{children:[(0,O.jsxs)(oe.Z,{attached:"top",basic:!0,size:"large",children:[n.name,":"]}),(0,O.jsx)(se.Z,{style:{marginBottom:"3px"},name:n.name,placeholder:n.default_value,value:o||"",onChange:d,onFocus:c,onBlur:v})]}):(0,O.jsx)(ue.Z,{style:{marginBottom:"3px"},fluid:!0,label:{basic:!0,content:"".concat(n.name,":")},labelPosition:"left",type:u[n.type],name:n.name,placeholder:n.default_value,value:o||"",checked:!("checkbox"!==u[n.type]||!o)&&JSON.parse(o),onChange:d,onFocus:c,onBlur:v})})})};var ce=function(e){var n=e.id,t=e.action,r=e.moveCard,i=e.findCard,a=e.origin,l=e.removeActionFromList,o=e.marginTop,s=e.setCurrentIndex,u=e.colorTypeDictionnary,d=e.changeParam,c=e.index,v=e.dragging,p=(0,b.$G)().t,x=(0,f.useRef)(null),h=(0,f.useState)(null),Z=(0,m.Z)(h,2),g=Z[0],y=Z[1],j=(0,f.useState)(!1),_=(0,m.Z)(j,2),C=_[0],k=_[1],I=(0,f.useState)(!1),S=(0,m.Z)(I,2),w=S[0],A=S[1],T=(0,E.c)({item:{type:K,id:n,originalIndex:i&&i(n),origin:a,action:t,colorTypeDictionnary:u,width:g},end:function(e,t){s&&s(-1),t.didDrop()||l&&!e.action.isSystem&&l(n)},collect:function(e){return{isDragging:!!e.isDragging()}},canDrag:function(e){return!w}}),$=(0,m.Z)(T,3),F=$[0].isDragging,R=$[1],L=$[2],B=(0,V.L)({accept:K,canDrop:function(){return!1},hover:function(e,t){if(t.isOver({shallow:!0}),i&&r){var l=i(n),o=JSON.parse(JSON.stringify(e));if("ALCReserve"===o.origin)return void("ALCList"===a&&s&&s(Number(l)));void 0!==l&&r(o.id,z,l)}},collect:function(e){return{isOver:e.isOver()}}}),q=(0,m.Z)(B,2),z=q[0].isOver,M=q[1],Q=function(){Y(t.list_id)},U=function(){k(!C)},Y=function(e){l&&l(String(e))};(0,f.useEffect)((function(){L((0,G.r)(),{captureDraggingState:!1}),y(x&&x.current&&x.current.offsetWidth)}),[L]);var X,J=F?0:1,W=t.input_types,ee=t.output_types;return(0,O.jsx)("div",{ref:x,children:(X=t,(0,O.jsx)(ae,{ref:function(e){return w?e:R(M(e))},opacity:J,marginTop:o,index:c,isDragging:v,children:(0,O.jsxs)(N.Z,{fluid:!0,children:[(0,O.jsx)(H,{inputs:W,dictionnary:u,isDragging:v}),(0,O.jsxs)(N.Z.Content,{children:[(0,O.jsx)("h3",{children:X.name}),(0,O.jsx)("p",{children:X.description}),X.isSystem?(0,O.jsx)(P.Z,{style:{position:"absolute",right:"6px",top:"15px",color:"#383939"},name:"lock",title:"action is system"}):(0,O.jsx)(D.Z,{style:{position:"absolute",right:"2px",top:"10px",fontSize:"0.8em"},circular:!0,icon:"trash",onClick:Q}),X.params&&X.params.length>0&&(0,O.jsx)("div",{style:{textAlign:"right"},onClick:U,children:(0,O.jsxs)(N.Z.Meta,{children:[p(C?"attributes.hide_params":"attributes.display_params"),(0,O.jsx)(P.Z,{name:C?"triangle down":"triangle right"})]})})]}),C&&(0,O.jsx)(N.Z.Content,{children:(0,O.jsx)("div",{style:{margin:"5px 0"},children:X.params&&X.params.length&&X.params.map((function(e,n){return(0,O.jsx)(de,{index:c,actionId:void 0!==X.list_id?X.list_id:-1,param:e,changeParam:d,setBlockCard:A},n)}))})}),(0,O.jsx)(H,{inputs:ee,dictionnary:u,isDragging:v})]})}))})},fe=t(1385);var ve=function(e){var n=e.changeSelectorTo,t=e.currentActionListName,r=e.connectionFailures,i={background:"#ffcccc"},a=[];return r&&r.length&&r.forEach((function(e){a.includes(e.list)||a.push(e.list)})),(0,O.jsxs)(fe.Z,{pointing:!0,secondary:!0,children:[(0,O.jsx)(fe.Z.Item,{name:"saveValue",style:a.includes("saveValue")?i:{},active:"saveValue"===t,onClick:function(){n("saveValue")}}),(0,O.jsx)(fe.Z.Item,{name:"getValue",style:a.includes("getValue")?i:{},active:"getValue"===t,onClick:function(){n("getValue")}}),(0,O.jsx)(fe.Z.Item,{name:"deleteValue",style:a.includes("deleteValue")?i:{},active:"deleteValue"===t,onClick:function(){n("deleteValue")}})]})},pe=function(e,n){var t=!1;return n.forEach((function(n){e.includes(n)&&(t=!0)})),t};var me,be=function(e){var n=e.actions,t=e.moveCard,r=e.findCard,i=e.addActionToList,a=e.removeActionFromList,l=e.getNewId,o=e.currentIndex,s=e.setCurrentIndex,u=e.inType,d=e.outType,c=e.colorTypeDictionnary,v=e.changeParam,p=e.cardOrder,x=e.onSelectorChange,h=e.currentActionListName,g=e.onSave,y=(0,b.$G)().t,j=p[h],_=n[h],C=(0,f.useState)([]),k=(0,m.Z)(C,2),I=k[0],S=k[1],w=(0,V.L)({accept:K,canDrop:function(){return!0},drop:function(e){"ALCReserve"===e.origin&&(o>=0?i(e.action.id,o):i(e.action.id),s(-1))},hover:function(e){if("ALCReserve"===e.origin&&!e.id){var n=l();e.id="".concat(n)}},collect:function(e){return{hovered:e.isOver(),canDrop:!!e.canDrop()}}}),A=(0,m.Z)(w,2),T=A[0],E=A[1],G=(0,V.L)({accept:K,canDrop:function(){return!1},hover:function(e,n){s(-1)}}),N=(0,m.Z)(G,2)[1],P=(0,f.useCallback)((function(){var e=[];Object.keys(n).forEach((function(t){var r=p[t],i=n[t];if(r&&r.length)for(var a=0;a<r.length;a++){var l=r[a],o=i[l];if(!o)return;var s=0===a?u[t]:i[r[a-1]].output_types,c=a>=r.length-1?d[t]:i[r[a+1]].input_types,f=pe(s,o.input_types),v=pe(c,o.output_types);f&&v||e.push({list:t,id:l})}S(e)}))}),[n,p,u,d]);return(0,f.useEffect)((function(){P(),T.hovered||s(-1)}),[T.hovered,s,p,P]),(0,O.jsxs)(ne,{ref:E,children:[(0,O.jsx)(Z.Z,{as:"h4",children:y("attributes.action_list")}),(0,O.jsx)(ve,{changeSelectorTo:function(e){x(e)},currentActionListName:h,connectionFailures:I}),(0,O.jsxs)(te,{children:[(0,O.jsx)("div",{style:{width:"100%",padding:"0 1px"},children:(0,O.jsx)(H,{inputs:u[h],dictionnary:c})}),j&&j.length?j.map((function(e,n){return function(e,n){var l=_[e];return l?(0,O.jsx)(ce,{index:n,id:"".concat(l.list_id),action:l,moveCard:t,findCard:r,origin:"ALCList",addActionToList:i,removeActionFromList:a,marginTop:o===n?"100px":"0",currentIndex:o,setCurrentIndex:s,colorTypeDictionnary:c,changeParam:v},e):(0,O.jsx)(ie,{children:"Slide Actions Here"},"placeholder".concat(n))}(e,n)})):(0,O.jsx)(ie,{children:"Slide Actions Here"}),(0,O.jsx)(re,{ref:N,extend:-1===o,hover:T.hovered}),(0,O.jsx)("div",{style:{width:"100%",padding:"0 1px"},children:(0,O.jsx)(H,{inputs:d[h],dictionnary:c})})]}),(0,O.jsx)("div",{style:{textAlign:"right"},children:(0,O.jsx)(D.Z,{primary:!(null!==I&&void 0!==I&&I.length),negative:!(null===I||void 0===I||!I.length),disabled:!!(I&&I.length>0),style:{marginTop:"8px"},className:"ui button",onClick:function(e){return g(),e.preventDefault(),!0},children:I&&I.length>0?y("attributes.connection_problem"):y("admin.submit")})})]})},xe=v.ZP.span(me||(me=(0,s.Z)(["\n    padding: 1px 2px;\n    margin: 1px 2px;\n    color: ",";\n    background-color: ",";\n    border-radius: 3px;\n"])),(function(e){return e.color[2]>200&&e.color[1]<170?"#ffffff":"#000000"}),(function(e){return"rgb("+e.color[0]+","+e.color[1]+","+e.color[2]+")"}));var he=function(e){var n=e.color,t=e.input;return(0,O.jsx)(xe,{color:n,children:t})};var Ze=function(e){var n=e.id,t=e.action,r=e.origin,i=e.addActionToList,a=e.removeActionFromList,l=e.setCurrentIndex,o=e.connectionState,s=e.colorTypeDictionnary,u=(0,b.$G)().t,d=(0,f.useRef)(null),c=(0,f.useState)(!1),v=(0,m.Z)(c,2),p=v[0],x=v[1],h=(0,f.useState)(null),Z=(0,m.Z)(h,2),g=Z[0],y=Z[1],j=(0,E.c)({item:{type:K,id:n,originalIndex:-1,origin:r,action:t,connectionState:o,colorTypeDictionnary:s,width:g},end:function(e,t){l&&l(-1),t.didDrop()||a&&!e.action.isSystem&&a(n)},collect:function(e){return{isDragging:!!e.isDragging()}}}),_=(0,m.Z)(j,3),C=_[1],k=_[2];(0,f.useEffect)((function(){k((0,G.r)(),{captureDraggingState:!1}),y(d&&d.current&&d.current.offsetWidth)}),[k]);var I=function(e,n){i&&i(e,n)},S=t.input_types,w=t.output_types;return(0,O.jsx)("div",{ref:d,children:(0,O.jsx)("div",{ref:function(e){return C(e)},style:{paddingBottom:"5px"},children:(0,O.jsxs)(N.Z,{fluid:!0,children:[(0,O.jsxs)(N.Z.Content,{children:[(0,O.jsx)(N.Z.Header,{children:t.name}),(0,O.jsx)(N.Z.Description,{children:t.description}),(0,O.jsx)(D.Z,{style:{position:"absolute",right:"2px",top:"5px",fontSize:"0.8em"},circular:!0,icon:"add",onClick:function(){I(t.id,-1)}}),(0,O.jsx)("div",{style:{textAlign:"right"},onClick:function(){x(!p)},children:(0,O.jsxs)(N.Z.Meta,{children:[u(p?"attributes.hide_types":"attributes.display_types"),(0,O.jsx)(P.Z,{name:p?"triangle down":"triangle right"})]})})]}),p&&(0,O.jsxs)(N.Z.Content,{extra:!0,children:[(0,O.jsxs)("div",{style:{padding:0},children:[(0,O.jsx)(P.Z,{name:"triangle right"}),(0,O.jsxs)("span",{children:[u("attributes.input_types"),": "]}),S&&s[S[0]]&&S.map((function(e,n){return(0,O.jsx)(he,{color:s[e],input:e},n)}))]}),(0,O.jsxs)("div",{style:{marginTop:"5px"},children:[(0,O.jsx)(P.Z,{name:"triangle left"}),(0,O.jsxs)("span",{children:[u("attributes.output_types"),": "]}),w&&s[w[0]]&&w.map((function(e,n){return(0,O.jsx)(he,{color:s[e],input:e},n)}))]})]})]})})})};var ge=function(e){var n=e.actions,t=e.setCurrentIndex,r=e.colorTypeDictionnary,i=e.addActionToList,a=(0,b.$G)().t;return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(Z.Z,{as:"h4",children:a("attributes.available_actions")}),(0,O.jsx)(ee,{children:n&&n.length>0?n.map((function(e,n){return function(e,n){var a=(0,I.Z)((0,I.Z)({},e),{},{list_id:-1,isSystem:!1});return(0,O.jsx)(Ze,{id:"".concat(n),action:a,addActionToList:i,origin:"ALCReserve",setCurrentIndex:t,colorTypeDictionnary:r},n)}(e,n)})):a("attributes.no_available_action")})]})},ye=t(9249),je=t(87371),_e=t(45754),Ce=t(86906),ke=t(28553),Ie={position:"fixed",pointerEvents:"none",zIndex:100,left:0,top:0,width:"100%",height:"100%"},Se=function(e){var n={maxWidth:300};return n.opacity=e?.8:1,n},we=function(e){var n=e.currentOffset;if(!n)return{display:"none"};var t=n.x,r=n.y,i="translate(".concat(t,"px, ").concat(r,"px)");return{transform:i,WebkitTransform:i}},Ae=function(e){(0,_e.Z)(t,e);var n=(0,Ce.Z)(t);function t(){var e;(0,ye.Z)(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).renderItem=function(e,n){if(n){var t=void 0===n.connectionState?"neutral":n.connectionState?"connected":"disconnected",r=n.colorTypeDictionnary,i=n.width;return(0,O.jsx)("div",{style:{pointerEvents:"none",width:"".concat(i,"px")},children:(0,O.jsx)(ce,{id:"".concat(n.id),action:n.action,findCard:function(){return{index:n.id}},origin:n.origin,connectionState:t,colorTypeDictionnary:r,dragging:!0},n.id)})}},e}return(0,je.Z)(t,[{key:"render",value:function(){var e=this.props,n=e.item,t=e.itemType,r=e.isDragging;return(0,O.jsx)("div",{style:Ie,children:(0,O.jsx)("div",{style:we(this.props),children:(0,O.jsx)("div",{style:Se(r),children:this.renderItem(t,n)})})})}}]),t}(f.Component);Ae.defaultProps={};var Te,Ve=(0,ke.DragLayer)((function(e){return{item:e.getItem(),itemType:e.getItemType(),currentOffset:e.getSourceClientOffset(),initialOffset:e.getInitialClientOffset(),diff:e.getDifferenceFromInitialOffset(),isDragging:e.isDragging()}}))(Ae);!function(e){e.saveValue="saveValue",e.getValue="getValue",e.deleteValue="deleteValue"}(Te||(Te={}));var De=function(e,n,t){var r=(0,I.Z)((0,I.Z)({},(0,w.cloneDeep)(n.filter((function(n){return n.id===e.id}))[0])),{},{list_id:t,isSystem:e.is_system});return r.params&&r.params.length&&r.params.forEach((function(n){if(n&&e.params&&e.params.length){var t=e.params.filter((function(e){return n.name===e.name})),r=(0,m.Z)(t,1)[0];r&&(n.value=r.value)}})),r},Ee=function(e){var n=new Set;e&&e.forEach((function(e){e.input_types.forEach((function(e){return n.add(e)})),e.output_types.forEach((function(e){return n.add(e)}))}));var t=function(e){var n=0;e<5&&(n=5-e,e=5);for(var t=[255,0,0],r=[],i=Math.floor(1275/e),a=1,l=1;r.length<e;)t[l]+=i*a,(1===a?t[l]>255:t[l]<0)?(a*=-1,(l-=1)<0&&(l=2)):r.push([].concat(t));return r.slice(n)}(n.size);return Array.from(n).reduce((function(e,n,r){return e[n]=t[r],e}),{})};var Ge=function(e){var n=e.availableActions,t=void 0===n?[]:n,r=e.attribute,i=(0,f.useState)("saveValue"),a=(0,m.Z)(i,2),l=a[0],o=a[1],s=(0,f.useState)({inTypes:{saveValue:[],getValue:[],deleteValue:[]},outTypes:{saveValue:[],getValue:[],deleteValue:[]}}),d=(0,m.Z)(s,2),c=d[0],v=d[1],b=(0,f.useState)({saveValue:{higherId:0},getValue:{higherId:0},deleteValue:{higherId:0}}),x=(0,m.Z)(b,2),h=x[0],Z=x[1],g=(0,f.useState)({saveValue:[],getValue:[],deleteValue:[]}),y=(0,m.Z)(g,2),j=y[0],_=y[1],C=(0,f.useState)(-1),k=(0,m.Z)(C,2),V=k[0],D=k[1],E=(0,f.useState)({}),G=(0,m.Z)(E,2),N=G[0],P=G[1],$=(0,u.useQuery)(A,{variables:{attId:r?r.id:void 0}}),F=$.loading,R=$.data,L=(0,u.useMutation)(T,{onError:function(e){return console.error(e.message)}}),B=(0,m.Z)(L,2),q=B[0],z=B[1].loading;(0,f.useEffect)((function(){var e,n=R&&R.attributes&&R.attributes.list[0]&&R.attributes.list[0].actions_list?R.attributes.list[0].actions_list:(e={},(0,S.Z)(e,Te.saveValue,[]),(0,S.Z)(e,Te.getValue,[]),(0,S.Z)(e,Te.deleteValue,[]),e),r=R&&R.attributes&&R.attributes.list[0];if(r){var i=r.input_types,a=r.output_types;v({inTypes:i,outTypes:a})}Z(function(e,n){var t={saveValue:{higherId:0},getValue:{higherId:0},deleteValue:{higherId:0}};return e&&Object.keys(e).length>0&&Object.keys(Te).forEach((function(r){var i=e[r],a={higherId:0};n&&i&&i.length&&i.forEach((function(e,t){var r=De(e,n,t);r.list_id=t,a[r.list_id]=r,a.higherId=t})),t[r]=a})),t}(n,t)),_(function(e){var n={saveValue:[],getValue:[],deleteValue:[]};return Object.keys(Te).forEach((function(t){var r=[];e[t]&&e[t].length&&e[t].forEach((function(e,n){r.push(n)})),n[t]=r})),n}(n)),P(Ee(t))}),[R,t]);var M=function(e,n){var r=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h[l].higherId+1;if(t){var r=(0,I.Z)((0,I.Z)({},(0,w.cloneDeep)(t.filter((function(n){return n.id===e}))[0])),{},{list_id:n,isSystem:!1});return r}return{list_id:-1}}(e),i=(0,w.cloneDeep)(h);i[l].higherId=r.list_id,i[l][r.list_id]=r;var a=void 0===n||-1===n?r.list_id:n;if(Z(i),j){var o=(0,I.Z)({},j);o[l].splice(a,0,r.list_id),_(o)}};return(0,O.jsxs)(X,{children:[(0,O.jsx)(Ve,{}),(0,O.jsx)(J,{children:t&&(0,O.jsx)(ge,{actions:t,setCurrentIndex:D,addActionToList:M,colorTypeDictionnary:N})}),(0,O.jsx)(W,{children:F||z?(0,O.jsx)(p.Z,{}):(0,O.jsx)(be,{actions:h,cardOrder:j,moveCard:function(e,n,t){if(!n){var r,i=-1;j&&(r=(0,I.Z)({},j),i=j[l].indexOf(Number(e)),r[l][i]=j[l][t],r[l][t]=Number(e),_(r))}},findCard:function(e){return j?j[l].indexOf(Number(e)):-1},addActionToList:M,removeActionFromList:function(e){var n=(0,w.cloneDeep)(h);delete n[l][e];var t=(0,I.Z)({},j),r=[];j&&(r=j[l].filter((function(n){return Number(n)!==Number(e)})),t[l]=r),Z(n),_(t)},getNewId:function(){return h?h[l].higherId+1:0},currentIndex:V,setCurrentIndex:D,inType:c.inTypes,outType:c.outTypes,colorTypeDictionnary:N,changeParam:function(e){var n=e.actionId,t=e.paramName,r=e.value;if(h&&l){var i=h[l][n];if(i&&i.params){var a=i.params.filter((function(e){return e&&e.name===t}));a[0]&&(a[0].value=r)}}},onSelectorChange:function(e){o(e)},currentActionListName:l,onSave:function(){var e={saveValue:[],getValue:[],deleteValue:[]};Object.keys(h).forEach((function(n){var t=[];j[n].forEach((function(e){var r=function(e){var n=e.params&&e.params.length?e.params.map((function(e){return function(e){return{name:e.name,value:e.value?e.value:e.default_value}}(e)})):null;return{id:e.id,params:n}}(h[n][e]);t.push(r)})),e[n]=t})),(e.saveValue||e.getValue||e.deleteValue)&&q({variables:{att:{id:r.id,type:r.type,actions_list:{saveValue:e.saveValue?e.saveValue:null,getValue:e.getValue?e.getValue:null,deleteValue:e.deleteValue?e.deleteValue:null}}}})}})})]})},Ne=Ge;var Pe,Oe,$e=function(e){var n=e.attribute,t=(0,u.useQuery)(k),r=t.loading,i=t.error,a=t.data;if(r)return(0,O.jsx)(p.Z,{});if(i)return(0,O.jsxs)("p",{children:["Error: ",i.message]});if(!a)return(0,O.jsx)(O.Fragment,{});var l=[];return a.availableActions&&a.availableActions.forEach((function(e){var n=function(e){var n=(0,I.Z)({},e);return n.params&&n.params.length?n.params=n.params.map((function(e){return(0,I.Z)((0,I.Z)({},e),{},{value:e.value?e.value:e.default_value})})):n.params=null,n}(e);n&&l.push(n)})),(0,O.jsx)(Ne,{availableActions:l,attribute:n})},Fe=t(59740),Re=t(38777),Le=t(34795),Be=t(77162),qe=t.n(Be),ze=t(66502),Me=t(19913),Qe=function e(n){return"\n        embedded_fields {\n            validation_regex\n            id\n            format\n            label\n            ".concat(n>0?e(n-1):"","\n        }\n    ")},Ue=C()(Oe||(Oe=(0,s.Z)(["\n    mutation SAVE_ATTRIBUTE_EMBEDDED_FIELDS($attribute: AttributeInput) {\n        saveAttribute(attribute: $attribute) {\n            id\n            label\n            format\n        }\n    }\n"]))),Ye=t(5918);var He=function(e){var n=e.attrId,t=e.add,r=e.t,i=(0,f.useState)(!1),a=(0,m.Z)(i,2),l=a[0],o=a[1],s=(0,f.useState)(""),u=(0,m.Z)(s,2),d=u[0],c=u[1],v=function(){return o(!1)};return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(D.Z,{onClick:function(){return o(!0)},basic:!0,positive:!0,icon:"plus"}),(0,O.jsx)(Ye.Z,{open:l,header:r("attributes.new_embedded_fields",{attrId:n}),content:(0,O.jsx)(ue.Z,{type:"text",label:r("attributes.ID"),value:d,onChange:function(e){c(e.target.value)}}),confirmButton:(0,O.jsx)(D.Z,{disabled:!d.length,children:r("admin.submit")}),cancelButton:(0,O.jsx)(D.Z,{children:r("admin.cancel")}),onCancel:v,onConfirm:function(){d.length&&(t(d),v(),c(""))}})]})};var Ke=function(e){var n=e.remove,t=e.t,r=(0,f.useState)(!1),i=(0,m.Z)(r,2),a=i[0],l=i[1],o=function(){return l(!1)};return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(D.Z,{onClick:function(){return l(!0)},basic:!0,negative:!0,icon:"remove"}),(0,O.jsx)(Ye.Z,{open:a,content:t("attributes.remove_embedded_fields"),onCancel:o,onConfirm:function(){n(),o()},confirmButton:(0,O.jsx)(D.Z,{children:t("admin.submit")}),cancelButton:(0,O.jsx)(D.Z,{children:t("admin.cancel")})})]})};var Xe=function(e){var n=e.id,t=e.format,r=e.flatItem,i=e.isRoot,a=e.expend,l=e.add,o=e.remove,s=e.t;return(0,O.jsxs)(D.Z.Group,{style:{position:"relative",left:"1rem",top:"-1rem"},children:[!i&&(0,O.jsx)(D.Z,{basic:!0,primary:!0,onClick:a,icon:null!==r&&void 0!==r&&r.displayForm?"angle up":"angle down"}),t===j.aZ.extended&&(0,O.jsx)(He,{attrId:n,add:l,t:s}),!i&&(0,O.jsx)(Ke,{remove:o,t:s})]})},Je=t(17823);var We=function(e){var n=e.attribute;return(0,O.jsx)(Je.Z,{fluid:!0,textAlign:"center",style:{padding:"1rem",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,O.jsx)(Z.Z,{as:"h5",children:n.id})})};var en=function(e){var n,t=e.formValues,r=e.setFormValues,i=e.onChange,a=e.t,l=e.save,o=null!==(n=t.label)&&void 0!==n?n:Object.keys(j.AW).reduce((function(e,n){return(0,I.Z)((0,I.Z)({},e),{},(0,S.Z)({},n,""))}),{}),s=Object.keys(j.AW).map((function(e){return(0,O.jsx)(le.Z.Input,{name:"label-".concat(e),label:"".concat(a("attributes.label")," ").concat(e),value:o[e],onChange:function(n,t){var a,l=(0,I.Z)((0,I.Z)({},o),{},(0,S.Z)({},e,null!==(a=t.value.toString())&&void 0!==a?a:""));r((function(e){return(0,I.Z)((0,I.Z)({},e),{},{label:l})})),i(l)},onBlur:function(){l(t)}},e)}));return(0,O.jsx)(le.Z.Group,{children:s})};var nn=function(e){var n=e.formValues,t=e.hasChild,r=e.onChange,i=e.t,a=e.save,l=(0,f.useState)(!1),o=(0,m.Z)(l,2),s=o[0],u=o[1],d=(0,f.useState)(n.format),c=(0,m.Z)(d,2),v=c[0],p=c[1];return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(le.Z.Select,{label:i("attributes.format"),name:"format",options:Object.keys(j.aZ).map((function(e){return{text:i("attributes.formats."+e),value:e}})),value:n.format,onChange:function(e,i){var l,o,s=null!==(l=null===(o=i.value)||void 0===o?void 0:o.toString())&&void 0!==l?l:"";p(s),v===j.aZ.extended&&i.value!==j.aZ.extended&&t?u(!0):(r(s),a((0,I.Z)((0,I.Z)({},n),{},{format:s})))}}),(0,O.jsx)(Ye.Z,{open:s,content:"Are you sure ? You will lost the child",onCancel:function(){u(!1)},onConfirm:function(){r(v),a((0,I.Z)((0,I.Z)({},n),{},{format:v})),u(!1)}})]})};var tn=function(e){var n,t=e.attribute,r=t.id,i=t.label,a=t.format,l=t.validation_regex,o=t.embedded_fields,s=e.formValues,u=e.setFormValues,d=e.save,c=e.isRoot,v=(0,b.$G)().t,p=(0,f.useState)({originalId:r,id:r,label:i,format:a,validation_regex:l}),x=(0,m.Z)(p,2),h=x[0],Z=x[1],g=function(){var e=(0,Le.Z)(qe().mark((function e(n,t){var r,i,a;return qe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=null!==(r=null===(i=t.value)||void 0===i?void 0:i.toString())&&void 0!==r?r:"",Z((function(e){return(0,I.Z)((0,I.Z)({},e),{},{validation_regex:a})})),y((0,I.Z)((0,I.Z)({},h),{},{validation_regex:a}));case 3:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),y=function(e){var n=C(e);u(n)},_=function(e){var n=C(e);d(n)},C=function(e){return s.find((function(e){return e.originalId===r}))?s.map((function(n){return n.originalId===r?e:n})):[].concat((0,Re.Z)(s),[e])},k=function(){_(h)},S=[j.aZ.text,j.aZ.numeric,j.aZ.encrypted];return(0,O.jsx)("div",{className:"ui fluid",style:{padding:"1rem"},children:(0,O.jsxs)(le.Z,{children:[(0,O.jsx)(le.Z.Input,{label:v("attributes.ID"),disabled:c,name:"id",value:h.id,onChange:function(e,n){var t,r,i=null!==(t=null===(r=n.value)||void 0===r?void 0:r.toString())&&void 0!==t?t:"";Z((function(e){return(0,I.Z)((0,I.Z)({},e),{},{id:i})})),y((0,I.Z)((0,I.Z)({},h),{},{id:i}))},onBlur:k}),(0,O.jsx)(en,{t:v,formValues:h,setFormValues:Z,onChange:function(e){y((0,I.Z)((0,I.Z)({},h),{},{label:e}))},save:k}),(0,O.jsxs)(le.Z.Group,{children:[(0,O.jsx)(nn,{formValues:h,hasChild:!!o,onChange:function(e){Z((function(n){return(0,I.Z)((0,I.Z)({},n),{},{format:e})})),y((0,I.Z)((0,I.Z)({},h),{},{format:e}))},t:v,save:_}),S.includes(h.format)&&(0,O.jsx)(le.Z.Input,{label:v("attributes.validation_regex"),value:null!==(n=h.validation_regex)&&void 0!==n?n:"",name:"validation_regex",onChange:g,onBlur:k})]})]})})},rn=tn;var an=function(e){var n=e.attribute,t=e.displayForm,r=e.formValues,i=e.setFormValues,a=e.isRoot,l=e.save;return t?(0,O.jsx)(rn,{attribute:n,formValues:r,setFormValues:i,isRoot:a,save:l}):(0,O.jsx)(We,{attribute:n})},ln=t(61156);var on=function(e){var n=e.flatItems,t=e.setFlatItems,r=(0,b.$G)().t;return(0,O.jsx)("div",{children:(0,O.jsxs)(ln.Z,{compact:!0,widths:"1",children:[(0,O.jsx)(D.Z,{size:"mini",onClick:function(){(0,ze.UI)({treeData:n,callback:function(e){var n=e.node;return t((function(e){return e.map((function(e){return e.id===n.id?(0,I.Z)((0,I.Z)({},e),{},{expanded:!0}):e}))})),(0,I.Z)((0,I.Z)({},n),{},{expanded:!0})},getNodeKey:function(e){return e.treeIndex},ignoreCollapsed:!1})},children:r("admin.expanded")}),(0,O.jsx)(D.Z,{size:"mini",onClick:function(){(0,ze.UI)({treeData:n,callback:function(e){var n=e.node;return t((function(e){return e.map((function(e){return e.id===n.id?(0,I.Z)((0,I.Z)({},e),{},{expanded:!1}):e}))})),(0,I.Z)((0,I.Z)({},n),{},{expanded:!1})},getNodeKey:function(e){return e.treeIndex},ignoreCollapsed:!1})},children:r("admin.reduce")})]})})},sn=on,un=["originalId"];var dn=function(e,n){var t={attribute:function e(n,t){var r=t.find((function(e){return e.originalId===n.id})),i=r?function(e){e.originalId;return(0,Fe.Z)(e,un)}(r):void 0;return n.children&&(null===r||void 0===r?void 0:r.format)===j.aZ.extended?(0,I.Z)((0,I.Z)({},i),{},{embedded_fields:(null===n||void 0===n?void 0:n.children).map((function(n){return e(n,t)}))}):i}(e,n.map((function(e){return e.originalId?e:(0,I.Z)((0,I.Z)({},e),{},{originalId:e.id})})))};return delete t.attribute.validation_regex,t},cn=function(e){var n,t=e.attribute,r=(0,b.$G)().t,i=(0,f.useState)([]),a=(0,m.Z)(i,2),l=a[0],o=a[1],d=(0,f.useState)([]),c=(0,m.Z)(d,2),v=c[0],p=c[1],x=(0,f.useState)([]),h=(0,m.Z)(x,2),Z=h[0],g=h[1],y=(0,f.useState)(!0),_=(0,m.Z)(y,2),C=_[0],k=_[1],S=(0,f.useState)(100),w=(0,m.Z)(S,1)[0],A=(0,u.useQuery)((n=w,(0,Me.FQ)(Pe||(Pe=(0,s.Z)(["\n        query GET_EMBEDDED_FIELDS_QUERY($attId: ID!) {\n            attributes(filters: {id: $attId}) {\n                list {\n                    id\n                    label\n                    format\n                    ... on StandardAttribute {\n                        ","\n                    }\n                }\n            }\n        }\n    "])),Qe(n))),{variables:{attId:t.id}}),T=A.loading,V=A.error,E=A.data,G=A.refetch,N=(0,u.useMutation)(Ue),P=(0,m.Z)(N,1)[0],$=(0,f.useCallback)(function(){var e=(0,Le.Z)(qe().mark((function e(n,t){var r;return qe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=function(){var e=(0,Le.Z)(qe().mark((function e(t){var r;return qe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=dn(t[0],n),e.next=3,P({variables:r});case 3:G();case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),!t){e.next=6;break}return e.next=4,r(t);case 4:e.next=7;break;case 6:o((function(e){return r(e),e}));case 7:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),[P,G,o]);(0,f.useEffect)((function(){var e,n=function e(n){var r,i,a=Z.find((function(e){return e.originalId===n.id})),l=v.find((function(e){return e.id===n.id}));if(l||a||Z.forEach((function(e){if(e.id!==e.originalId){var n=v.find((function(n){return n.id===e.originalId}));n&&p((function(t){return l=(0,I.Z)((0,I.Z)({},n),{},{id:e.id}),[].concat((0,Re.Z)(t.filter((function(n){return n.id!==e.originalId}))),[l])}))}})),!l){var o={id:n.id,expanded:!1,displayForm:!1};p((function(e){return[].concat((0,Re.Z)(e),[o])}))}if(!a){var s,u={originalId:n.id,id:n.id,label:n.label,format:n.format,validation_regex:null!==(s=null===n||void 0===n?void 0:n.validation_regex)&&void 0!==s?s:""};g((function(e){return[].concat((0,Re.Z)(e.filter((function(e){return e.originalId===e.id}))),[u])}))}var d=n.format===j.aZ.extended&&n.embedded_fields?n.embedded_fields.filter((function(e){return null!==e&&void 0!==e?e:void 0})).map((function(n){return e(n)})):void 0;return{id:n.id,title:(0,O.jsx)(an,{attribute:n,displayForm:!(null===(r=l)||void 0===r||!r.displayForm),formValues:Z,setFormValues:g,isRoot:n.id===t.id,save:function(e){return $(e)}},n.id),children:d,expanded:null===(i=l)||void 0===i?void 0:i.expanded}},r=null!==E&&void 0!==E&&null!==(e=E.attributes)&&void 0!==e&&e.list?E.attributes.list.map((function(e){return n(e)})):[];o(r)}),[T,E,v,Z,t.id,$]);var F=function(){var e=(0,Le.Z)(qe().mark((function e(){return qe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:$(Z,l),k(!1);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),R=function(){var e=(0,Le.Z)(qe().mark((function e(n){var t;return qe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.isDragging){e.next=6;break}return t=dn(l[0],Z),e.next=5,P({variables:t});case 5:G();case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return V?(0,O.jsx)("div",{className:"error",children:"ERROR"}):(0,O.jsxs)("div",{className:"grow height100",style:{display:"flex",flexFlow:"column",justifyContent:"space-between"},children:[(0,O.jsx)(sn,{flatItems:v,setFlatItems:p}),(0,O.jsx)("div",{style:{flex:1},children:(0,O.jsx)(ze.ZP,{treeData:l,onChange:function(e){o(e)},onVisibilityToggle:function(e){var n=e.node;p((function(e){return e.map((function(e){return e.id===n.id?(0,I.Z)((0,I.Z)({},e),{},{expanded:!e.expanded}):e}))}))},rowHeight:function(e){var n=v.find((function(n){return n.id===e.node.id}));return!!n&&n.displayForm?260:60},getNodeKey:function(e){return e.treeIndex},generateNodeProps:function(e){var n=function(){var n=(0,Le.Z)(qe().mark((function n(t){var r,i,o,s,u;return qe().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r={id:t,format:"text",label:{fr:"",en:""}},i=function(e){return $(e)},o=(0,ze.YI)({treeData:l,parentKey:e.treeIndex,getNodeKey:function(e){return e.treeIndex},newNode:{id:r.id,title:(0,O.jsx)(an,{attribute:r,displayForm:!(null===a||void 0===a||!a.displayForm),formValues:Z,setFormValues:g,save:i},r.id),children:void 0,expanded:!1}}),s=o.treeData,u=[].concat((0,Re.Z)(Z),[(0,I.Z)({originalId:r.id},r)]),g(u),$(u,s);case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),i=function(){var n=(0,Le.Z)(qe().mark((function n(){var t,r;return qe().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=(0,ze.k)({treeData:l,path:e.path,getNodeKey:function(e){return e.treeIndex}}),o(t),r=dn(t[0],Z),n.next=5,P({variables:r});case 5:G();case 6:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),a=v.find((function(n){return n.id===e.node.id})),s=function e(n,t){return n.id===t?n:n.embedded_fields?n.embedded_fields.filter((function(e){return!!e})).map((function(n){return e(n,t)})).find((function(e){return e&&e.id===t})):void 0}(null===E||void 0===E?void 0:E.attributes.list[0],e.node.id);return{buttons:[(0,O.jsx)("div",{style:{position:"absolute"},children:(0,O.jsx)(Xe,{id:e.node.id,flatItem:a,format:null===s||void 0===s?void 0:s.format,expend:function(){p((function(n){return n.map((function(n){return n.id===e.node.id?(k(!1),(0,I.Z)((0,I.Z)({},n),{},{displayForm:!n.displayForm})):n}))}))},add:n,remove:i,isRoot:t.id===e.node.id,t:r})},e.treeIndex+"_btn-group")]}},onDragStateChanged:R,isVirtualized:C})}),(0,O.jsx)("div",{children:(0,O.jsx)(D.Z,{color:"green",floated:"right",onClick:F,children:r("admin.submit")})})]})},fn=cn,vn=t(39918),pn=t(8726),mn=t(41442),bn=t(42875),xn=t(29653),hn=["profiles"];var Zn=function(e){var n=e.profiles,t=(0,Fe.Z)(e,hn),r=(0,g.Z)().lang,i=n.map((function(e){return{key:e.id,value:e.id,text:(0,xn.a0)(e.label,r)}}));return t.clearable&&i.unshift({key:"",value:"",text:""}),(0,O.jsx)(le.Z.Dropdown,(0,I.Z)((0,I.Z)({},(0,I.Z)((0,I.Z)({},t),{},{clearable:void 0})),{},{search:!0,options:i}))};var gn,yn=function(e){var n,t=(0,u.useQuery)(bn.o),r=t.loading,i=t.error,a=t.data;if(i)return(0,O.jsx)(d.Z,{message:i.message});var l=(null===a||void 0===a||null===(n=a.versionProfiles)||void 0===n?void 0:n.list)||[];return(0,O.jsx)(Zn,(0,I.Z)((0,I.Z)({},e),{},{loading:r,profiles:l}))},jn=t(91492),_n=t(80687),Cn=t(61247),kn=t(9983),In=t(45611),Sn=t(43248),wn=t(46389),An=t(63146),Tn=t.n(An),Vn=C()(gn||(gn=(0,s.Z)(["\n    query GET_LIBRARIES_WITH_ATTRIBUTES {\n        libraries {\n            totalCount\n            list {\n                id\n                label\n                gqlNames {\n                    query\n                    type\n                    list\n                    filter\n                    searchableFields\n                }\n                attributes {\n                    id\n                    label\n                }\n            }\n        }\n    }\n"]))),Dn=t(22263),En=["libraries"];var Gn=function(e){var n=e.libraries,t=(0,Fe.Z)(e,En),r=(0,g.Z)().lang,i=n?n.map((function(e){return{key:e.id,value:e.id,text:(0,Me.dX)(e.label,r)}})):[];return(0,O.jsx)(le.Z.Dropdown,(0,I.Z)((0,I.Z)({},t),{},{"aria-label":"linked-libraries",search:!0,options:i}))},Nn=["attribute","onChange"];var Pn,On,$n=function(e){var n,t,r=e.attribute,i=(e.onChange,(0,Fe.Z)(e,Nn)),a=(0,u.useQuery)(Vn),l=a.loading,o=a.error,s=a.data,c=(0,u.useMutation)(Dn.D,{onError:function(e){}}),v=(0,m.Z)(c,2),p=v[0],b=v[1],x=b.loading,h=b.error,Z=null!==(n=null===s||void 0===s||null===(t=s.libraries)||void 0===t?void 0:t.list)&&void 0!==n?n:[],g=(0,f.useMemo)((function(){return Z.reduce((function(e,n){return e[n.id]=n,e}),{})}),[Z]),y=function(){var e=(0,Le.Z)(qe().mark((function e(n,t){var i,a,l;return qe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.libraries.map((function(e){return e.id})),a=Tn()(t.value,i),l=Tn()(i,t.value),e.next=5,Promise.all([].concat((0,Re.Z)(a.map((function(e){return p({variables:{libId:e,attributes:[].concat((0,Re.Z)(g[e].attributes.map((function(e){return e.id}))),[r.id])}})}))),(0,Re.Z)(l.map((function(e){return p({variables:{libId:e,attributes:(0,Re.Z)(g[e].attributes.filter((function(e){return e.id!==r.id})).map((function(e){return e.id})))}})})))));case 5:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}();return o?(0,O.jsx)(d.Z,{message:o.message}):(0,O.jsx)(Sn.Z,{error:null===h||void 0===h?void 0:h.message,children:(0,O.jsx)(Gn,(0,I.Z)((0,I.Z)({libraries:Z},i),{},{onChange:y,loading:l||x,defaultValue:r.libraries.map((function(e){return e.id}))}))})},Fn=$n,Rn={id:"",system:!1,readonly:!1,label:{fr:"",en:""},description:{fr:"",en:""},type:j.GC.simple,format:j.aZ.text,linked_tree:null,linked_library:null,reverse_link:null,unique:null,permissions_conf:null,multiple_values:!1,metadata_fields:null,versions_conf:{versionable:!1,mode:j.S5.smart,profile:null},libraries:[]},Ln=(0,v.ZP)(le.Z)(Pn||(Pn=(0,s.Z)(["\n    && {\n        position: unset;\n    }\n"]))),Bn=v.ZP.div(On||(On=(0,s.Z)(["\n    border-top: 1px solid #dddddd;\n    padding: 1em;\n    text-align: right;\n"])));var qn=function(e){var n,t,r,i,a,l,o,s,u=e.attribute,d=e.readonly,c=e.onSubmitInfos,f=e.errors,v=e.onCheckIdExists,p=e.forcedType,x=(0,b.$G)().t,h=(0,g.Z)(),Z=h.lang,y=h.availableLangs,_=h.defaultLang,C=null===u,k=null!==u?(0,I.Z)((0,I.Z)({},u),{},{linked_library:null!==(n=null===(t=u.linked_library)||void 0===t?void 0:t.id)&&void 0!==n?n:null,reverse_link:null!==(r=u.reverse_link)&&void 0!==r?r:null,linked_tree:null!==(i=null===(a=u.linked_tree)||void 0===a?void 0:a.id)&&void 0!==i?i:null,versions_conf:(0,I.Z)((0,I.Z)({},u.versions_conf),{},{profile:null!==(l=null===(o=u.versions_conf.profile)||void 0===o?void 0:o.id)&&void 0!==l?l:null}),unique:null!==(s=u.unique)&&void 0!==s?s:null}):Rn;C&&p&&(k.type=p);var w=f&&f.extensions.code===kn.Z.VALIDATION_ERROR?f.extensions.fields:{},A=Cn.Z_().required().matches(/^[a-z0-9_]+$/);C&&(A=A.test("isIdUnique",x("admin.validation_errors.id_exists"),v));var T=Cn.Ry().shape({label:Cn.Ry().shape((0,S.Z)({},_,Cn.Z_().required())),description:Cn.Ry().shape((0,S.Z)({},_,Cn.Z_())).nullable(),id:A,type:Cn.Z_().required(),format:Cn.Z_().nullable(),multiple_values:Cn.O7(),unique:Cn.O7().nullable(),versions_conf:Cn.Ry().shape({versionable:Cn.O7().nullable(),mode:Cn.Z_().oneOf([].concat((0,Re.Z)(Object.values(j.S5)),[null])).nullable(),profile:Cn.Z_().nullable()}).nullable()});return(0,O.jsxs)(O.Fragment,{children:[f&&f.extensions.code===kn.Z.PERMISSION_ERROR&&(0,O.jsx)(_n.Z,{negative:!0,children:(0,O.jsxs)(_n.Z.Header,{children:[(0,O.jsx)(P.Z,{name:"ban"})," ",f.message,(0,O.jsx)(P.Z,{"aria-label":"ban"})," ",f.message]})}),(0,O.jsx)(jn.J9,{initialValues:k,onSubmit:function(e){c(e)},validateOnChange:!0,validationSchema:T,children:function(e){var n,t=e.handleSubmit,r=e.handleBlur,i=e.setFieldValue,a=e.errors,l=e.values,o=e.touched,s=e.submitForm,c=function(e,n){f(e,n);var t=n.name,r=n.value,a=t.split("."),l=(0,m.Z)(a,2),o=l[0],s=l[1];C&&"label"===o&&s===_&&i("id",(0,Me.GV)(r))},f=function(){var e=(0,Le.Z)(qe().mark((function e(n,t){var r,a,l;return qe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="checkbox"===t.type,a=r?t.checked:t.value,l=t.name,e.next=5,i(l,a);case 5:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),v=function(){var e=(0,Le.Z)(qe().mark((function e(n,t){return qe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(n,t);case 2:C||s();case 3:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),b=[j.GC.advanced,j.GC.simple].includes(l.type),h=[j.GC.advanced,j.GC.advanced_link,j.GC.tree].includes(l.type),g=[j.GC.advanced,j.GC.advanced_link,j.GC.tree].includes(l.type),k=!!l.versions_conf&&l.versions_conf.versionable,I=[j.GC.advanced_link,j.GC.simple_link].includes(l.type),S=function(e){return(0,Me.zQ)(e,o,w||{},a)},A=function(e){C?r(e):s()},T=function(e){"Enter"===e.key&&s()};return(0,O.jsxs)(Ln,{onSubmit:t,"aria-label":"infos-form",children:[(0,O.jsxs)(le.Z.Group,{grouped:!0,children:[(0,O.jsx)("label",{children:x("attributes.label")}),y.map((function(e){var n,t;return(0,O.jsx)(Sn.Z,{error:S("label.".concat(e)),children:(0,O.jsx)(le.Z.Input,{label:"".concat(e," ").concat(e===_?"*":""),width:"4",name:"label.".concat(e),"aria-label":"label.".concat(e),disabled:d,onChange:c,onBlur:A,onKeyPress:T,value:null!==(n=null===(t=l.label)||void 0===t?void 0:t[e])&&void 0!==n?n:""})},e)}))]}),(0,O.jsxs)(le.Z.Group,{grouped:!0,children:[(0,O.jsx)("label",{children:x("attributes.description")}),y.map((function(e){var n,t;return(0,O.jsx)(Sn.Z,{error:S("description.".concat(e)),children:(0,O.jsx)(le.Z.Input,{label:"".concat(e),value:null!==(n=null===(t=l.description)||void 0===t?void 0:t[e])&&void 0!==n?n:"",width:"4",name:"description.".concat(e),"aria-label":"description.".concat(e),disabled:d,onChange:f,onBlur:A,onKeyPress:T})},e)}))]}),(0,O.jsx)(Sn.Z,{error:S("id"),children:(0,O.jsx)(le.Z.Input,{label:x("attributes.ID"),width:"4",disabled:!C||d,name:"id","aria-label":"id",onChange:f,onBlur:A,value:l.id})}),(0,O.jsx)(Sn.Z,{error:S("type"),children:(0,O.jsx)(le.Z.Select,{label:x("attributes.type"),width:"4",disabled:!C||l.system||d||C&&!!p,name:"type","aria-label":"type",onChange:v,options:Object.keys(j.GC).map((function(e){return{text:x("attributes.types."+e),value:e}})),value:l.type})}),b&&(0,O.jsx)(Sn.Z,{error:S("format"),children:(0,O.jsx)(le.Z.Select,{label:x("attributes.format"),disabled:!C||l.system||d,width:"4",name:"format","aria-label":"format",onChange:v,options:Object.keys(j.aZ).map((function(e){return{text:x("attributes.formats."+e),value:e}})),value:l.format||""})}),I&&(0,O.jsx)(Sn.Z,{error:S("linked_library"),children:(0,O.jsx)(In.Z,{disabled:l.system||d,lang:Z,fluid:!0,selection:!0,multiple:!1,label:x("attributes.linked_library"),placeholder:x("attributes.linked_library"),width:"4",name:"linked_library","aria-label":"linked_library",onChange:function(e,n){f(e,n),i("reverse_link",null)},value:l.linked_library||""})}),(0,O.jsx)(Sn.Z,{error:S("readonly"),children:(0,O.jsx)(le.Z.Checkbox,{label:x("attributes.readonly"),width:"4",disabled:d||l.system,name:"readonly","aria-label":"readonly",onChange:v,onBlur:A,checked:l.readonly,toggle:!0})}),l.type===j.GC.simple&&(0,O.jsx)(Sn.Z,{error:S("unique"),children:(0,O.jsx)(le.Z.Checkbox,{label:x("attributes.unique"),width:"4",disabled:l.system||d,name:"unique","aria-label":"unique",onChange:v,onBlur:A,checked:l.unique,toggle:!0})}),I&&!!l.linked_library&&(0,O.jsx)(Sn.Z,{error:S("reverse_link"),children:(0,O.jsx)(mn.Z,{filters:{libraries:[l.linked_library],type:[j.GC.advanced_link,j.GC.simple_link]},excludeReverseLinks:!0,disabled:l.system||d,lang:Z,fluid:!0,selection:!0,clearable:!0,multiple:!1,label:x("attributes.reverse_link"),placeholder:x("attributes.linked_attribute"),width:"4",name:"reverse_link","aria-label":"reverse_link",onChange:v,value:l.reverse_link||""})}),l.type===j.GC.tree&&(0,O.jsx)(Sn.Z,{error:S("versions_conf"),children:(0,O.jsx)(wn.Z,{fluid:!0,selection:!0,multiple:!1,width:"4",disabled:l.system||d,label:x("attributes.linked_tree"),placeholder:x("attributes.linked_tree"),name:"linked_tree","aria-label":"linked_tree",value:l.linked_tree||"",onChange:v})}),h&&(0,O.jsx)(Sn.Z,{error:S("multiple_values"),children:(0,O.jsx)(le.Z.Checkbox,{label:x("attributes.allow_multiple_values"),disabled:l.system||d,width:"8",toggle:!0,name:"multiple_values","aria-label":"multiple_values",onChange:v,onBlur:A,checked:!!l.multiple_values})}),g&&(0,O.jsxs)(le.Z.Group,{grouped:!0,children:[(0,O.jsx)("label",{children:x("attributes.values_versions")}),(0,O.jsx)(Sn.Z,{error:S("versions_conf.versionable"),children:(0,O.jsx)(le.Z.Checkbox,{label:x("attributes.versionable"),disabled:l.system||d,width:"8",toggle:!0,name:"versions_conf.versionable","aria-label":"versions_conf.versionable",onChange:v,checked:k})}),k&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(Sn.Z,{error:S("versions_conf.mode"),children:(0,O.jsx)(le.Z.Select,{label:x("attributes.versions_mode"),disabled:l.system||d,width:"4",name:"versions_conf.mode","aria-label":"versions_conf.mode",onChange:v,options:[{text:x("attributes.versions_mode_simple"),value:j.S5.simple},{text:x("attributes.versions_mode_smart"),value:j.S5.smart}],value:l.versions_conf&&l.versions_conf.mode?l.versions_conf.mode:j.S5.smart})}),(0,O.jsx)(Sn.Z,{error:S("versions_conf.profile"),children:(0,O.jsx)(yn,{fluid:!0,selection:!0,width:"4",disabled:l.system||d,label:x("attributes.version_profile"),placeholder:x("attributes.version_profile"),value:null===l||void 0===l||null===(n=l.versions_conf)||void 0===n?void 0:n.profile,name:"versions_conf.profile","aria-label":"versions_conf.profile",onChange:v,clearable:!0})})]})]}),!C&&(0,O.jsx)(Fn,{attribute:u,fluid:!0,selection:!0,width:"10",multiple:!0,disabled:l.system||d,label:x("attributes.linked_libraries"),placeholder:x("attributes.linked_libraries"),name:"libraries","aria-label":"linked-libraries"}),!d&&C&&(0,O.jsx)(Bn,{children:(0,O.jsxs)(le.Z.Button,{type:"submit",primary:!0,icon:!0,"data-test-id":"attribute-infos-submit-btn",style:{float:"right"},labelPosition:"left",children:[(0,O.jsx)(P.Z,{name:"save outline"}),x("admin.submit")]})})]})}})]})},zn=qn;var Mn=function(e){var n,t=e.attribute,r=e.onPostSave,i=e.forcedType,a=e.redirectAfterCreate,l=void 0===a||a,o=(0,x.k6)(),s=!t,d=(0,u.useMutation)(pn.u,{onError:function(){},onCompleted:function(e){o&&s&&l&&o.replace({pathname:"/attributes/edit/"+e.saveAttribute.id})},update:function(e){t||e.evict({fieldName:"attributes"})}}),c=(0,m.Z)(d,2),f=c[0],v=c[1].error,p=(0,u.useLazyQuery)(vn.V,{fetchPolicy:"no-cache"}),b=(0,m.Z)(p,2),h=b[0],Z=b[1].data,g=function(){var e=(0,Le.Z)(qe().mark((function e(n){return qe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h({variables:{id:n}});case 2:return e.abrupt("return",!!Z&&!!Z.attributes&&!Z.attributes.list.length);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),y=function(){var e=(0,Le.Z)(qe().mark((function e(n){var t,i,a,l,o,s,u,d,c,v,p,m,b,x,h;return qe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h={attrData:{id:n.id,label:{fr:null!==(t=null===(i=n.label)||void 0===i?void 0:i.fr)&&void 0!==t?t:"",en:null!==(a=null===(l=n.label)||void 0===l?void 0:l.en)&&void 0!==a?a:""},description:null!==(o=n.description)&&void 0!==o&&o.fr||null!==(s=n.description)&&void 0!==s&&s.en?{fr:null!==(u=null===(d=n.description)||void 0===d?void 0:d.fr)&&void 0!==u?u:"",en:null!==(c=null===(v=n.description)||void 0===v?void 0:v.en)&&void 0!==c?c:""}:null,type:n.type,format:n.format,readonly:n.readonly,linked_tree:n.linked_tree,linked_library:n.linked_library,reverse_link:n.reverse_link,multiple_values:n.multiple_values,unique:n.unique,versions_conf:{versionable:null!==(p=null===n||void 0===n||null===(m=n.versions_conf)||void 0===m?void 0:m.versionable)&&void 0!==p&&p,mode:null===n||void 0===n||null===(b=n.versions_conf)||void 0===b?void 0:b.mode,profile:null===n||void 0===n||null===(x=n.versions_conf)||void 0===x?void 0:x.profile}}},e.next=3,f({variables:h});case 3:r&&r(n);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),j=null!==v&&void 0!==v&&null!==(n=v.graphQLErrors)&&void 0!==n&&n.length?v.graphQLErrors[0]:null;return(0,O.jsx)(zn,{onSubmitInfos:y,errors:j,attribute:t||null,readonly:!1,onCheckIdExists:g,forcedType:i})},Qn=Mn,Un=t(38769),Yn=t(31010),Hn=t(16058),Kn=t(52788),Xn=t(33495);var Jn=function(e){var n=e.open,t=e.onPostSave,r=e.onClose,i=e.forcedType,a=(0,b.$G)().t;return(0,O.jsx)(O.Fragment,{children:(0,O.jsxs)(Xn.Z,{size:"large",open:n,onClose:r,centered:!0,closeIcon:!0,children:[(0,O.jsx)(Xn.Z.Header,{children:a("attributes.new")}),(0,O.jsx)(Xn.Z.Content,{children:(0,O.jsx)($t,{attributeId:null,onPostSave:t,forcedType:i})})]})})},Wn=t(39719);var et=function(e){var n=e.fields,t=e.readonly,r=e.onChange,i=(0,g.Z)().lang,a=(0,b.$G)().t,l=(0,f.useState)({visible:!1}),o=(0,m.Z)(l,2),s=o[0],u=o[1],d=(0,f.useState)(!1),c=(0,m.Z)(d,2),v=c[0],p=c[1],x=(0,f.useState)(!1),h=(0,m.Z)(x,2),Z=h[0],y=h[1],_=function(){p(!1)},C=function(){y(!1)};return(0,O.jsxs)(O.Fragment,{children:[!t&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(D.Z,{"data-test-id":"metadata-add-field-new",icon:!0,labelPosition:"left",size:"medium",onClick:function(){p(!0)},children:[(0,O.jsx)(P.Z,{name:"plus"}),a("attributes.new")]}),(0,O.jsxs)(D.Z,{"data-test-id":"metadata-add-field-existing",icon:!0,labelPosition:"left",size:"medium",onClick:function(){y(!0)},children:[(0,O.jsx)(P.Z,{name:"plus"}),a("libraries.link_existing_attribute")]})]}),(0,O.jsxs)(Yn.Z,{selectable:!0,striped:!0,children:[(0,O.jsx)(Yn.Z.Header,{children:(0,O.jsxs)(Yn.Z.Row,{children:[(0,O.jsx)(Yn.Z.HeaderCell,{width:4,children:a("attributes.ID")}),(0,O.jsx)(Yn.Z.HeaderCell,{width:4,children:a("attributes.label")}),(0,O.jsx)(Yn.Z.HeaderCell,{width:3,children:a("attributes.type")}),(0,O.jsx)(Yn.Z.HeaderCell,{width:3,children:a("attributes.format")}),(0,O.jsx)(Yn.Z.HeaderCell,{width:1})]})}),(0,O.jsx)(Yn.Z.Body,{children:n.map((function(e){var l=(0,Me.dX)(e.label,i);return(0,O.jsxs)(Yn.Z.Row,{onClick:function(){u({visible:!0,attribute:e.id})},children:[(0,O.jsx)(Yn.Z.Cell,{children:e.id}),(0,O.jsx)(Yn.Z.Cell,{children:l}),(0,O.jsx)(Yn.Z.Cell,{children:a("attributes.types."+e.type)}),(0,O.jsx)(Yn.Z.Cell,{children:e.format?a("attributes.formats."+e.format):""}),(0,O.jsx)(Yn.Z.Cell,{children:!t&&(0,O.jsx)(Hn.Z,{"data-test-id":"metadata-delete-button",confirmMessage:a("attributes.metadata_field_delete_confirm",{attrLabel:l}),action:function(){return t=e.id,r(n.filter((function(e){return e.id!==t})).map((function(e){return e.id})));var t},children:(0,O.jsx)(Kn.Z,{disabled:!1})})})]},e.id)}))})]}),!t&&(0,O.jsxs)(O.Fragment,{children:[v&&(0,O.jsx)(Jn,{open:v,onClose:_,onPostSave:function(e){r([].concat((0,Re.Z)(n.map((function(e){return e.id}))),[e.id])),_()},forcedType:j.GC.simple}),Z&&(0,O.jsx)(Wn.Z,{openModal:Z,onClose:C,onSubmit:function(e){r([].concat((0,Re.Z)(n.map((function(e){return e.id}))),(0,Re.Z)(e))),C()},selection:n.map((function(e){return e.id})),filter:{type:[j.GC.simple]}}),s.visible&&(0,O.jsx)(Un.Z,{open:!0,onClose:function(){return u({visible:!1})},attribute:s.attribute})]})]})};var nt,tt=function(e){var n=e.attribute,t=e.readonly,r=(0,u.useMutation)(pn.u),i=(0,m.Z)(r,1)[0];return(0,O.jsx)(et,{fields:n.metadata_fields||[],readonly:t,onChange:function(e){return i({variables:{attrData:{id:n.id,metadata_fields:e}},refetchQueries:[{query:vn.V,variables:{id:n.id}}]})}})},rt=t(68648),it=t(90930),at=t(10290),lt=(0,v.ZP)(rt.Z)(nt||(nt=(0,s.Z)(["\n    position: absolute;\n    top: 2rem;\n    right: 2rem;\n"])));var ot=function(e){var n=e.attribute,t=e.onSubmitSettings,r=e.readonly,i=(0,b.$G)().t,a=(0,g.Z)().lang,l={permissionTreeAttributes:[],relation:j.sl.and},o=(n.permissions_conf||l).permissionTreeAttributes.map((function(e){return{key:e.id,menuItem:(0,Me.dX)(e.label,a),render:function(){return(0,O.jsx)(h.Z.Pane,{className:"grow",children:e.linked_tree?(0,O.jsx)(at.Z,{treeAttribute:e,permissionType:j.r3.record_attribute,applyTo:n.id,readOnly:r},e.id):(0,O.jsx)("p",{children:"Missing tree ID"})},e.id)}}}));return o.unshift({key:"libPermissions",menuItem:i("permissions.attribute_tab_name"),render:function(){return(0,O.jsx)(h.Z.Pane,{className:"grow",children:(0,O.jsx)(it.Z,{type:j.r3.attribute,applyTo:n.id,readOnly:r},"attrPermissions")},"libPermissions")}}),(0,O.jsxs)("div",{className:"flex-col height100",children:[(0,O.jsx)(lt,{permissionsSettings:n.permissions_conf,onChangeSettings:function(e){t(e)},readonly:r}),(0,O.jsx)(h.Z,{panes:o,className:"grow flex-col height100"})]})};var st,ut=function(e){var n=e.attribute,t=e.readonly,r=(0,u.useMutation)(pn.u),i=(0,m.Z)(r,1)[0];return(0,O.jsx)(ot,{attribute:n,readonly:t,onSubmitSettings:function(e){i({variables:{attrData:{id:n.id,permissions_conf:e}}})}})},dt=t(82332),ct=C()(st||(st=(0,s.Z)(["\n    ","\n    query GET_ATTRIBUTES_VALUES_LIST($attrId: ID!) {\n        attributes(filters: {id: $attrId}) {\n            list {\n                id\n                label\n                type\n                format\n                ...AttributeValuesListDetails\n                ... on LinkAttribute {\n                    linked_library {\n                        id\n                    }\n                    reverse_link\n                }\n                ... on TreeAttribute {\n                    linked_tree {\n                        id\n                    }\n                }\n            }\n        }\n    }\n"])),dt.Q),ft=t(71988),vt=t(85823),pt=t(98132),mt=t(73377),bt=t(19046);var xt,ht=function(e){var n=e.values,t=e.onValuesUpdate,r=e.linkedLibrary,i=(0,b.$G)().t,a=i("admin.or"),l=(0,f.useState)(!1),o=(0,m.Z)(l,2),s=o[0],u=o[1],d=(0,f.useState)(),c=(0,m.Z)(d,2),v=c[0],p=c[1],x=(0,f.useState)(!1),h=(0,m.Z)(x,2),Z=h[0],g=h[1],y=function(){return g(!1)},j=function(){return u(!0)},_=function(e){if(!n.filter((function(n){return n.whoAmI.id===e.id})).length){var r=[].concat((0,Re.Z)(n),[{whoAmI:e}]);t(r)}},C=function(e){return function(r){r.stopPropagation(),r.preventDefault();var i=[].concat((0,Re.Z)(n.slice(0,e)),(0,Re.Z)(n.slice(e+1)));t(i)}};return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(D.Z.Group,{size:"tiny",children:[(0,O.jsxs)(D.Z,{"data-test-id":"open-create-record",type:"button",onClick:function(){p(void 0),j()},children:[(0,O.jsx)(P.Z,{name:"plus circle"}),i("records.create_record")]}),(0,O.jsx)(D.Z.Or,{text:a}),(0,O.jsxs)(D.Z,{"data-test-id":"open-select-record",type:"button",onClick:function(){return g(!0)},children:[(0,O.jsx)(P.Z,{name:"search"}),i("records.select_record")]})]}),(0,O.jsx)(vt.Z,{"data-test-id":"values-list-wrapper",style:{width:"100%"},divided:!0,children:n.map((function(e,n){return(0,O.jsxs)(vt.Z.Item,{"data-test-id":"values-list-value",onClick:(t=e.whoAmI.id,function(){p(t),j()}),children:[(0,O.jsx)(vt.Z.Content,{floated:"left",children:(0,O.jsx)(bt.Z,{record:e.whoAmI})}),(0,O.jsx)(vt.Z.Content,{floated:"right",children:(0,O.jsx)(D.Z,{"data-test-id":"link-value-delete-btn",icon:"trash",onClick:C(n)})})]},"values_".concat(n));var t}))}),(0,O.jsx)(pt.Z,{open:s,onClose:function(e){u(!1),e&&(v||_(e))},recordId:v,library:r}),(0,O.jsx)(mt.Z,{open:Z,library:r,onClose:y,onSelect:function(e){e&&(_(e),y())}})]})},Zt=t(26275),gt=t.n(Zt),yt=v.ZP.div(xt||(xt=(0,s.Z)(["\n    display: flex;\n\n    & > * {\n        flex-grow: 1;\n        margin-right: 0.25em;\n    }\n\n    &&& input {\n        width: auto;\n    }\n"])));var jt,_t=function(e){var n=e.value,t=e.onChange,r=e.onDelete,i=(0,f.useState)(null!==n&&void 0!==n?n:{from:"",to:""}),a=(0,m.Z)(i,2),l=a[0],o=a[1],s=(0,b.$G)().t,u=function(e){var n=gt()(e.target.value).unix(),r=(0,I.Z)((0,I.Z)({},l),{},(0,S.Z)({},e.target.name,n));r.from>r.to&&(r.to=r.from),o(r),r.from&&r.to&&t(r)},d=isNaN(Number(l.from))?"":gt()(1e3*Number(l.from)).format("YYYY-MM-DD"),c=isNaN(Number(l.to))?"":gt()(1e3*Number(l.to)).format("YYYY-MM-DD");return(0,O.jsxs)(yt,{children:[(0,O.jsx)(ue.Z,{value:d,name:"from","aria-label":"date-from",label:{basic:!0,content:s("attributes.date_range_from")},size:"small",type:"date",onChange:u,onBlur:u,transparent:!1,role:"textbox"}),(0,O.jsx)(ue.Z,{value:c,name:"to","aria-label":"date-to",label:{basic:!0,content:s("attributes.date_range_to")},size:"small",type:"date",onChange:u,onBlur:u,min:d,role:"textbox"}),(0,O.jsx)(D.Z,{icon:"trash",style:{flexGrow:0},onClick:function(){r()}})]})},Ct=(jt={},(0,S.Z)(jt,j.aZ.text,"text"),(0,S.Z)(jt,j.aZ.date,"date"),(0,S.Z)(jt,j.aZ.numeric,"number"),(0,S.Z)(jt,j.aZ.boolean,"checkbox"),(0,S.Z)(jt,j.aZ.extended,"text"),(0,S.Z)(jt,j.aZ.encrypted,"text"),jt);var kt=function(e){var n=e.values,t=e.onValuesUpdate,r=e.attribute,i=(0,b.$G)().t,a=(0,f.useState)(n),l=(0,m.Z)(a,2),o=l[0],s=l[1],u=function(e){return function(n){var t=[].concat((0,Re.Z)(o.slice(0,e)),[n],(0,Re.Z)(o.slice(e+1)));s(t),p(t)}},d=function(e){return function(n){var t=n.target.value,i=String(r.format===j.aZ.date?gt()(t).unix():t);s([].concat((0,Re.Z)(o.slice(0,e)),[i],(0,Re.Z)(o.slice(e+1))))}},c=function(e){return function(){var n=[].concat((0,Re.Z)(o.slice(0,e)),(0,Re.Z)(o.slice(e+1)));s(n),p(n)}},v=function(){return p(o)},p=function(e){return t(e.map((function(e){return"object"===typeof e?JSON.stringify(e):e})))},x=function(e){"Enter"===e.key&&p(o)};return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(D.Z,{icon:!0,labelPosition:"left",size:"medium","aria-label":"add-value",onClick:function(){var e=r.format===j.aZ.date?gt()().unix():"";s([].concat((0,Re.Z)(o),[String(e)]))},type:"button",children:[(0,O.jsx)(P.Z,{name:"plus"}),i("attributes.add_value")]}),(0,O.jsx)(vt.Z,{style:{width:"100%"},children:o.map((function(e,n){var t=e;r.format===j.aZ.date&&(t=(isNaN(Number(e))?gt()():gt()(1e3*Number(e))).format("YYYY-MM-DD"));return(0,O.jsx)(vt.Z.Item,{"aria-label":"values-list-value",children:(0,O.jsx)(vt.Z.Content,{children:r.format===j.aZ.date_range?(0,O.jsx)(_t,{onChange:u(n),onDelete:c(n),value:t}):(0,O.jsx)(ue.Z,{value:t,size:"small",fluid:!0,type:Ct[r.format],onChange:d(n),onBlur:v,onKeyPress:x,action:{icon:"trash",onClick:c(n),type:"button","aria-label":"delete-value"}})})},"values_".concat(n,"_").concat(o.length))}))})]})},It=t(25154),St=t(42538);var wt=function(e){var n=e.values,t=e.onValuesUpdate,r=e.linkedTree,i=(0,b.$G)().t,a=(0,f.useState)(!1),l=(0,m.Z)(a,2),o=l[0],s=l[1],u=function(){return s(!1)},d=(0,f.useState)(!1),c=(0,m.Z)(d,2),v=c[0],p=c[1],x=(0,f.useState)(),h=(0,m.Z)(x,2),Z=h[0],g=h[1],y=function(e){return function(r){r.stopPropagation(),r.preventDefault();var i=[].concat((0,Re.Z)(n.slice(0,e)),(0,Re.Z)(n.slice(e+1)));t(i)}},j=[{text:i("records.edit"),icon:"edit outline",action:function(e){g(e),p(!0)}}];return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(D.Z,{icon:!0,labelPosition:"left",size:"medium","data-test-id":"values-list-add-btn",onClick:function(){return s(!0)},type:"button",children:[(0,O.jsx)(P.Z,{name:"plus"}),i("attributes.add_value")]}),(0,O.jsx)(vt.Z,{"data-test-id":"values-list-wrapper",style:{width:"100%"},divided:!0,children:n.map((function(e,n){return(0,O.jsxs)(vt.Z.Item,{"data-test-id":"values-list-value",children:[(0,O.jsx)(vt.Z.Content,{floated:"left",children:(0,O.jsx)(It.Z,{element:e,actions:j})}),(0,O.jsx)(vt.Z.Content,{floated:"right",children:(0,O.jsx)(D.Z,{"data-test-id":"link-value-delete-btn",icon:"trash",onClick:y(n)})})]},"values_".concat(n))}))}),(0,O.jsx)(St.Z,{open:o,onClose:u,tree:r,onSelect:function(e){var r=e.node;if(u(),!n.filter((function(e){return e.record.whoAmI.id===r.record.whoAmI.id&&e.record.whoAmI.id===r.record.whoAmI.id})).length){var i=[].concat((0,Re.Z)(n),[{id:r.id,record:{whoAmI:r.record.whoAmI},ancestors:r.parents.map((function(e){return{record:{whoAmI:e.whoAmI}}}))}]);t(i)}}}),(0,O.jsx)(pt.Z,{open:v,onClose:function(){return p(!1)},recordId:(null===Z||void 0===Z?void 0:Z.id)||"",library:(null===Z||void 0===Z?void 0:Z.library.id)||""})]})},At=function(e,n){var t=(0,I.Z)({},e.conf),r=!0;switch(n.type){case"toggle_enable":t.enable=!t.enable;break;case"toggle_allow_free_entry":t.allowFreeEntry=!t.allowFreeEntry;break;case"change_values":JSON.stringify(t.values)===JSON.stringify(n.values)&&(r=!1),t.values=(0,Re.Z)(new Set(n.values));break;case"submit_done":r=!1}return(0,I.Z)((0,I.Z)({},e),{},{execSubmit:r,conf:t})},Tt=function(e){switch(e.type){case j.GC.simple:return e.format===j.aZ.date_range?"dateRangeValues":"values";case j.GC.advanced:return"values";case j.GC.simple_link:case j.GC.advanced_link:return"linkValues";case j.GC.tree:return"treeValues"}};var Vt=function(e){var n=e.attribute,t=e.onSubmit,r=(0,b.$G)().t,i={execSubmit:!1,conf:{enable:!1}};n.values_list&&(i.conf=(0,I.Z)((0,I.Z)({},n.values_list),{},{values:n.values_list[Tt(n)]}));var a=(0,f.useReducer)(At,i),l=(0,m.Z)(a,2),o=l[0],s=l[1],u=(0,f.useCallback)((function(e){var t=[];switch(n.type){case j.GC.simple:case j.GC.advanced:t=n.format===j.aZ.date_range?((null===e||void 0===e?void 0:e.values)||[]).map((function(e){return"object"===typeof e?JSON.stringify(e):e})):(null===e||void 0===e?void 0:e.values)||[];break;case j.GC.simple_link:case j.GC.advanced_link:var r=e.values;t=r?r.map((function(e){return e.whoAmI.id})):[];break;case j.GC.tree:var i=e.values;t=i?i.map((function(e){return e.id})):[]}return t.filter((function(e){return""!==e}))}),[n]),d=function(e){s({type:"change_values",values:e})};return(0,f.useEffect)((function(){o.execSubmit&&(t({enable:o.conf.enable,allowFreeEntry:o.conf.allowFreeEntry,values:u(o.conf)}),s({type:"submit_done"}))}),[o,u,t]),(0,O.jsxs)(le.Z,{children:[(0,O.jsxs)(le.Z.Group,{inline:!1,children:[(0,O.jsx)(le.Z.Checkbox,{name:"enable",toggle:!0,label:r("attributes.values_list_enable"),checked:o.conf.enable,onChange:function(){return s({type:"toggle_enable"})}}),o.conf.enable&&(0,O.jsx)(le.Z.Checkbox,{name:"allowFreeEntry",toggle:!0,label:r("attributes.allow_free_entry"),checked:!!o.conf.allowFreeEntry,onChange:function(){return s({type:"toggle_allow_free_entry"})}})]}),o.conf.enable&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(ft.Z,{horizontal:!0,children:r("attributes.values")}),function(e){var t,r;switch(e){case j.GC.simple:case j.GC.advanced:return(0,O.jsx)(kt,{values:o.conf.values||[],onValuesUpdate:d,attribute:n});case j.GC.simple_link:case j.GC.advanced_link:return(0,O.jsx)(ht,{values:o.conf.values||[],onValuesUpdate:d,linkedLibrary:(null===(t=n.linked_library)||void 0===t?void 0:t.id)||""});case j.GC.tree:return(0,O.jsx)(wt,{values:o.conf.values||[],onValuesUpdate:d,linkedTree:(null===(r=n.linked_tree)||void 0===r?void 0:r.id)||""})}}(n.type)]})]})};var Dt,Et=function(e){var n,t,r=e.attributeId,i=(0,u.useQuery)(ct,{variables:{attrId:r}}),a=i.loading,l=i.error,o=i.data,s=(0,u.useMutation)(pn.u),d=(0,m.Z)(s,2),c=d[0],f=d[1].error;return a?(0,O.jsx)(p.Z,{}):l?(0,O.jsx)("div",{className:"error",children:"ERROR"}):f?(0,O.jsx)("div",{className:"error",children:"SAVE ERROR"}):null!==o&&void 0!==o&&null!==(n=o.attributes)&&void 0!==n&&n.list.length?(0,O.jsx)(Vt,{attribute:null===o||void 0===o||null===(t=o.attributes)||void 0===t?void 0:t.list[0],onSubmit:function(e){c({variables:{attrData:{id:r,values_list:e}}})}}):(0,O.jsx)("div",{children:"Unknown attribute"})},Gt=(0,v.ZP)(h.Z)(Dt||(Dt=(0,s.Z)(["\n    display: grid;\n    grid-template-rows: 4rem 1fr;\n"])));Gt.displayName="Tab";var Nt,Pt=function(e){var n=e.attribute,t=e.onPostSave,r=e.forcedType,i=e.redirectAfterCreate,a=(0,b.$G)().t,l=(0,g.Z)().lang,o=(0,x.k6)(),s=(0,x.TH)(),u=n&&n.label?(0,y.dX)(n.label,l):a("attributes.new"),d=[{key:"infos",menuItem:a("attributes.informations"),render:function(){return(0,O.jsx)(h.Z.Pane,{className:"grow",children:(0,O.jsx)(Qn,{attribute:n,onPostSave:t,forcedType:r,redirectAfterCreate:i})},"infos")}}];if(n){var c=[j.GC.advanced,j.GC.advanced_link,j.GC.tree].includes(n.type),v="extended"===n.format;d.push({key:"values_list",menuItem:a("attributes.values_list"),render:function(){return(0,O.jsx)(h.Z.Pane,{className:"grow flex-col height100",children:(0,O.jsx)(Et,{attributeId:n.id})},"values_list")}},{key:"permissions",menuItem:a("attributes.permissions"),render:function(){return(0,O.jsx)(h.Z.Pane,{className:"",style:{display:"grid"},children:(0,O.jsx)(ut,{attribute:n,readonly:!1})},"permissions")}},{key:"actions_list",menuItem:a("attributes.action_list"),render:function(){return(0,O.jsx)(h.Z.Pane,{className:"grow flex-col height100",children:(0,O.jsx)($e,{attribute:n})},"actions_list")}}),c&&d.push({key:"metadata",menuItem:a("attributes.metadata"),render:function(){return(0,O.jsx)(h.Z.Pane,{className:"grow flex-col",children:(0,O.jsx)(tt,{attribute:n,readonly:!1})},"metadata")}}),v&&d.push({key:"embeddedFields",menuItem:a("attributes.embedded_fields"),render:function(){return(0,O.jsx)(h.Z.Pane,{className:"grow flex-col",children:(0,O.jsx)(fn,{attribute:n})},"EmbeddedFields")}})}var p=s?s.hash.replace("#",""):void 0,_=(0,f.useState)(p?d.findIndex((function(e){return p===e.key})):0),C=(0,m.Z)(_,2),k=C[0],I=C[1];return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(Z.Z,{className:"no-grow","data-testid":"header",children:u}),(0,O.jsx)(Gt,{onTabChange:function(e,n){n.panes&&void 0!==n.activeIndex&&(I(Number(n.activeIndex.toString())),null===o||void 0===o||o.push("#".concat(n.panes[n.activeIndex].key)))},menu:{secondary:!0,pointing:!0},panes:d,activeIndex:k>=0?k:0})]})},Ot=v.ZP.div(Nt||(Nt=(0,s.Z)(["\n    display: grid;\n    grid-template-rows: auto 1fr;\n"])));var $t=function(e){var n=e.match,t=e.attributeId,r=e.onPostSave,i=e.forcedType,a=e.redirectAfterCreate,l="undefined"!==typeof t?t:n?n.params.id:"",o=(0,u.useQuery)(c.y,{variables:{id:l},skip:!l}),s=o.loading,v=o.error,m=o.data,b=(0,f.useMemo)((function(){return function(e){return(0,O.jsx)(Pt,{attribute:e,onPostSave:r,forcedType:i,redirectAfterCreate:a})}}),[r,i,history]);return l?s?(0,O.jsx)(p.Z,{}):v?(0,O.jsx)(d.Z,{message:v.message}):m&&m.attributes&&m.attributes.list.length?(0,O.jsx)(Ot,{className:"grow",children:b(m.attributes.list[0])}):(0,O.jsx)(d.Z,{message:"Unknown attribute"}):b()}},38769:function(e,n,t){t.d(n,{Z:function(){return c}});var r,i=t(71171),a=(t(54681),t(70663)),l=t(33495),o=t(37893),s=t(9169),u=t(57450),d=(0,o.ZP)(l.Z.Content)(r||(r=(0,i.Z)(["\n    &&& {\n        display: grid;\n    }\n"])));var c=function(e){var n=e.attribute,t=e.open,r=e.onClose,i=e.onPostSave,o=e.redirectAfterCreate;return(0,a.$G)().t,(0,u.jsx)(l.Z,{open:t,size:"fullscreen",centered:!0,closeOnDimmerClick:!0,closeOnEscape:!0,closeIcon:!0,dimmer:!0,className:"overlay",onClose:r,children:(0,u.jsx)(d,{scrolling:!0,children:(0,u.jsx)(s.default,{attributeId:n,onPostSave:i,redirectAfterCreate:o})})})}},45611:function(e,n,t){t.d(n,{Z:function(){return p}});var r=t(33028),i=t(80688),a=(t(54681),t(74790)),l=t(59740),o=t(5168),s=t(74280),u=t(71446),d=t(57450),c=["loading","libraries"],f=function(e){e.loading;var n=e.libraries,t=(0,l.Z)(e,c),i=(0,s.Z)().lang,a=n?n.map((function(e){return{key:e.id,value:e.id,text:(0,u.dX)(e.label,i)}})):[];return delete t.t,delete t.tReady,delete t.defaultNS,delete t.i18nOptions,delete t.reportNS,(0,d.jsx)(o.Z.Dropdown,(0,r.Z)((0,r.Z)({},t),{},{search:!0,options:a}))};f.defaultProps={loading:!1,libraries:[]};var v=f;var p=function(e){var n=(0,i.useQuery)(a.c),t=n.loading,l=n.data;return(0,d.jsx)(v,(0,r.Z)((0,r.Z)({},e),{},{loading:t,libraries:l&&l.libraries?l.libraries.list:null}))}},10290:function(e,n,t){t.d(n,{Z:function(){return f}});var r=t(2867),i=t(54681),a=t(70621),l=t(71446),o=t(73218),s=t(22660),u=t(78053),d=t(57450),c=function(e){var n=e.treeAttribute,t=e.permissionType,c=e.applyTo,f=e.readOnly,v=i.useState({node:{id:a.Y},path:[],treeIndex:0}),p=(0,r.Z)(v,2),m=p[0],b=p[1],x=i.useState({node:{id:a.Y},path:[],treeIndex:0}),h=(0,r.Z)(x,2),Z=h[0],g=h[1];if(!n.linked_tree)return(0,d.jsx)("p",{children:"Cannot find tree"});var y=[(0,d.jsx)(s.Z,{treeId:n.linked_tree.id,onClick:function(e){return b((0,l.xN)(e)!==(0,l.xN)(m)?e:null)},selectedNode:m},"perm_tree")];return m&&(y.push((0,d.jsx)(s.Z,{treeId:"users_groups",onClick:function(e){return g((0,l.xN)(e)!==(0,l.xN)(Z)?e:null)},selectedNode:Z})),Z&&y.push((0,d.jsx)(u.Z,{permParams:{type:t,applyTo:c,usersGroup:Z.node.id!==a.Y?Z.node.id:null,permissionTreeTarget:{tree:n.linked_tree.id,nodeId:m.node.id!==a.Y?m.node.id:null}},readOnly:f}))),(0,d.jsx)(o.Z,{columnsNumber:3,columnsContent:y})};c.defaultProps={readOnly:!1};var f=c},16058:function(e,n,t){t.d(n,{Z:function(){return s}});var r=t(2867),i=t(54681),a=t(70663),l=t(5918),o=t(57450),s=function(e){var n=e.confirmMessage,t=e.children,s=(0,a.$G)().t,u=(0,i.useState)(!1),d=(0,r.Z)(u,2),c=d[0],f=d[1],v=function(e){e.preventDefault(),e.stopPropagation(),f(!1)},p=i.cloneElement(t,{onClick:function(e){e.preventDefault(),e.stopPropagation(),f(!0)}});return(0,o.jsxs)("div",{onClick:function(e){e.preventDefault(),e.stopPropagation()},children:[p,(0,o.jsx)(l.Z,{open:c,content:n,onCancel:v,onConfirm:function(n){v(n),e.action()},cancelButton:s("admin.cancel"),closeOnDocumentClick:!1,closeOnDimmerClick:!1})]})}},52788:function(e,n,t){t.d(n,{Z:function(){return a}});t(54681);var r=t(92042),i=t(57450);var a=function(e){var n=e.disabled,t=e.onClick;return(0,i.jsx)(r.Z,{"aria-label":"delete",className:"delete",circular:!0,icon:"trash",disabled:n,onClick:t})}},68648:function(e,n,t){t.d(n,{Z:function(){return F}});var r,i=t(38777),a=t(33028),l=t(2867),o=t(59740),s=t(71171),u=t(74280),d=t(54681),c=t(70663),f=t(31010),v=t(55152),p=t(887),m=t(92042),b=t(37893),x=t(19913),h=t(52987),Z=t(53852),g=t(80688),y=t(43157),j=t(64449),_=t(39918),C=t(85823),k=t(80687),I=t(71207),S=t(57450),w=(0,b.ZP)(C.Z.Item)(r||(r=(0,s.Z)(["\n    &&&& {\n        cursor: pointer;\n        padding: 0.5rem;\n    }\n    &:hover {\n        background-color: ",";\n    }\n"])),I.d6);var A=function(e){var n=e.attributes,t=e.onSelect,r=(0,u.Z)().lang,i=(0,c.$G)().t,a=function(e){return function(){t(e)}};return(0,S.jsxs)(C.Z,{divided:!0,"aria-label":"attribute-selector-list",children:[!n.length&&(0,S.jsx)(k.Z,{info:!0,size:"tiny",children:i("permissions_settings.no_attributes_to_add")}),n.map((function(e){return(0,S.jsxs)(w,{onClick:a(e),children:[(0,S.jsx)(C.Z.Header,{children:(0,x.dX)(e.label,r)}),(0,S.jsx)(C.Z.Description,{children:e.id})]},e.id)}))]})};var T,V,D,E=function(e){var n,t,r=e.library,i=e.selectedAttributes,a=e.onSelectAttribute,o=(0,c.$G)().t,s=(0,d.useState)(!1),u=(0,l.Z)(s,2),f=u[0],p=u[1],m=(0,g.useLazyQuery)(_.V,{variables:{libraries:r?[r.id]:null,type:[h.GC.tree]}}),b=(0,l.Z)(m,2),x=b[0],C=b[1],k=C.loading,I=C.error,w=C.data,T=C.called;(0,d.useEffect)((function(){f&&!T&&x()}),[f,T]);var V=(null!==(n=null===w||void 0===w||null===(t=w.attributes)||void 0===t?void 0:t.list)&&void 0!==n?n:[]).filter((function(e){return!i.includes(e.id)}));return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)(Z.Z,{basic:!0,compact:!0,onClick:function(){p(!0)},children:[(0,S.jsx)(v.Z,{name:"plus"}),o("permissions_settings.add_permissions_attribute")]}),k&&(0,S.jsx)(j.Z,{size:"small"}),I&&(0,S.jsx)(y.Z,{message:I.message,size:"small"}),f&&T&&!k&&!I&&(0,S.jsx)(A,{attributes:V,onSelect:function(e){a(e.id),p(!1)}})]})},G=["permissionsSettings","onChangeSettings","library","readonly"],N=b.ZP.div(T||(T=(0,s.Z)(["\n    display: flex;\n    gap: 1rem;\n    flex-direction: column;\n    min-width: 225px;\n    max-width: 90vw;\n    font-size: 1rem;\n"]))),P=b.ZP.div(V||(V=(0,s.Z)(["\n    cursor: pointer;\n"]))),O=(0,b.ZP)(f.Z.Cell)(D||(D=(0,s.Z)(["\n    &&& {\n        ","\n    }\n"])),(function(e){return!e.$hasAttributes&&"border-top: none;"})),$=h.sl.and;var F=function(e){var n,t,r=e.permissionsSettings,s=e.onChangeSettings,b=e.library,g=e.readonly,y=(0,o.Z)(e,G),j=(0,c.$G)().t,_=(0,u.Z)().lang,C=d.useState(null!==(n=null===r||void 0===r?void 0:r.relation)&&void 0!==n?n:h.sl.and),k=(0,l.Z)(C,2),I=k[0],w=k[1],A=null!==(t=null===r||void 0===r?void 0:r.permissionTreeAttributes)&&void 0!==t?t:[],T=(0,S.jsxs)(P,(0,a.Z)((0,a.Z)({},y),{},{children:[(0,S.jsx)(v.Z,{name:"cog"}),j("permissions_settings.title")]})),V=Object.values(h.sl),D=function(e){return function(){w(e),s({permissionTreeAttributes:r.permissionTreeAttributes.map((function(e){return e.id})),relation:e})}},F={type:[h.GC.tree]};return b&&(F.libraries=[b.id]),(0,S.jsx)(p.Z,{trigger:T,on:"click",closeOnEscape:!0,position:"bottom left",style:{maxWidth:"none"},children:(0,S.jsxs)(N,{children:[(0,S.jsxs)("div",{children:[(0,S.jsx)("h5",{children:j("permissions_settings.permissions_attributes")}),(0,S.jsxs)(f.Z,{compact:!0,children:[(0,S.jsx)(f.Z.Body,{children:A.map((function(e){return(0,S.jsxs)(f.Z.Row,{children:[(0,S.jsx)(f.Z.Cell,{children:(0,x.dX)(e.label,_)}),(0,S.jsx)(f.Z.Cell,{width:3,children:!g&&(0,S.jsx)(Z.Z,{"aria-label":"remove",icon:"trash alternate outline",onClick:(n=e.id,function(){var e;s({permissionTreeAttributes:A.map((function(e){return e.id})).filter((function(e){return e!==n})),relation:null!==(e=null===r||void 0===r?void 0:r.relation)&&void 0!==e?e:$})})})})]},e.id);var n}))}),!g&&(0,S.jsx)(f.Z.Footer,{children:(0,S.jsx)(f.Z.Row,{children:(0,S.jsx)(O,{colSpan:2,$hasAttributes:!!A.length,children:(0,S.jsx)(E,{library:b,onSelectAttribute:function(e){var n,t={permissionTreeAttributes:[].concat((0,i.Z)(A.map((function(e){return e.id}))),[e]),relation:null!==(n=null===r||void 0===r?void 0:r.relation)&&void 0!==n?n:$};s(t)},selectedAttributes:A.map((function(e){return e.id}))})})})})]})]}),A.length>1&&(0,S.jsxs)("div",{children:[(0,S.jsx)("h5",{children:j("permissions_settings.operator")}),(0,S.jsx)(m.Z.Group,{basic:!0,children:V.map((function(e){return(0,S.jsx)(m.Z,{disabled:g,compact:!0,onClick:D(e),active:I===e,children:j("permissions_settings.operator_".concat(e))},e)}))})]})]})})}},46389:function(e,n,t){t.d(n,{Z:function(){return p}});var r=t(33028),i=t(59740),a=t(80688),l=(t(54681),t(72335)),o=t(5168),s=t(74280),u=t(71446),d=t(57450),c=["trees"],f=function(e){var n=e.trees,t=(0,i.Z)(e,c),a=(0,s.Z)().lang,l=n?n.map((function(e){return{key:e.id,value:e.id,text:(0,u.dX)(e.label,a)}})):[];return delete t.t,delete t.tReady,delete t.defaultNS,delete t.i18nOptions,delete t.reportNS,(0,d.jsx)(o.Z.Dropdown,(0,r.Z)((0,r.Z)({},t),{},{search:!0,options:l}))},v=["filters"];var p=function(e){var n=e.filters,t=(0,i.Z)(e,v),o=(0,a.useQuery)(l.u,{variables:n}),s=o.loading,u=o.data;return(0,d.jsx)(f,(0,r.Z)((0,r.Z)({},t),{},{loading:s,trees:u&&u.trees?u.trees.list:[]}))}},95541:function(e,n,t){t.d(n,{y:function(){return s}});var r,i=t(71171),a=t(42737),l=t.n(a),o=t(82332),s=l()(r||(r=(0,i.Z)(["\n    ","\n    query GET_ATTRIBUTE_BY_ID($id: ID) {\n        attributes(filters: {id: $id}) {\n            totalCount\n            list {\n                ...AttributeDetails\n            }\n        }\n    }\n"])),o.Z)},39918:function(e,n,t){t.d(n,{V:function(){return l}});var r,i=t(71171),a=t(42737),l=t.n(a)()(r||(r=(0,i.Z)(["\n    query GET_ATTRIBUTES(\n        $id: ID\n        $label: String\n        $type: [AttributeType]\n        $format: [AttributeFormat]\n        $system: Boolean\n        $multiple_values: Boolean\n        $versionable: Boolean\n        $libraries: [String!]\n    ) {\n        attributes(\n            filters: {\n                id: $id\n                label: $label\n                type: $type\n                format: $format\n                system: $system\n                multiple_values: $multiple_values\n                versionable: $versionable\n                libraries: $libraries\n            }\n        ) {\n            totalCount\n            list {\n                id\n                label\n                type\n                format\n                system\n                multiple_values\n                ... on StandardAttribute {\n                    unique\n                }\n                ... on LinkAttribute {\n                    linked_library {\n                        id\n                    }\n                    reverse_link\n                }\n                ... on TreeAttribute {\n                    linked_tree {\n                        id\n                    }\n                }\n            }\n        }\n    }\n"])))},8726:function(e,n,t){t.d(n,{u:function(){return s}});var r,i=t(71171),a=t(42737),l=t.n(a),o=t(82332),s=l()(r||(r=(0,i.Z)(["\n    ","\n    ","\n    mutation SAVE_ATTRIBUTE($attrData: AttributeInput!) {\n        saveAttribute(attribute: $attrData) {\n            ...AttributeDetails\n            ...AttributeValuesListDetails\n            ... on LinkAttribute {\n                linked_library {\n                    id\n                }\n                reverse_link\n            }\n            ... on TreeAttribute {\n                linked_tree {\n                    id\n                }\n            }\n        }\n    }\n"])),o.Q,o.Z)},22263:function(e,n,t){t.d(n,{D:function(){return s}});var r,i=t(71171),a=t(42737),l=t.n(a),o=t(82332),s=l()(r||(r=(0,i.Z)(["\n    ","\n    mutation SAVE_LIBRARY_ATTRIBUTES($libId: ID!, $attributes: [ID!]!) {\n        saveLibrary(library: {id: $libId, attributes: $attributes}) {\n            id\n            attributes {\n                ...AttributeDetails\n            }\n        }\n    }\n"])),o.Z)},72335:function(e,n,t){t.d(n,{T:function(){return l},u:function(){return o}});var r,i=t(71171),a=t(42737),l="GET_TREES",o=t.n(a)()(r||(r=(0,i.Z)(["\n    query GET_TREES($id: ID, $label: String, $system: Boolean) {\n        trees(filters: {id: $id, label: $label, system: $system}) {\n            totalCount\n            list {\n                id\n                label\n                system\n                behavior\n                libraries {\n                    library {\n                        id\n                        label\n                    }\n                    settings {\n                        allowMultiplePositions\n                        allowedAtRoot\n                        allowedChildren\n                    }\n                }\n            }\n        }\n    }\n"])))},42875:function(e,n,t){t.d(n,{o:function(){return a}});var r,i=t(71171),a=(0,t(175).gql)(r||(r=(0,i.Z)(["\n    query GET_VERSION_PROFILES($filters: VersionProfilesFiltersInput, $sort: SortVersionProfilesInput) {\n        versionProfiles(filters: $filters, sort: $sort) {\n            list {\n                id\n                label\n            }\n        }\n    }\n"])))}}]);
//# sourceMappingURL=605.71d62137.chunk.js.map