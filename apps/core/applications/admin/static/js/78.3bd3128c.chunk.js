"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[78,378],{59820:function(e,n,t){t.d(n,{Z:function(){return f}});var r=t(54681),i=t(70663),l=t(31010),a=t(35925),o=t(69356),s=t(56022),d=t(74280),u=t(71446),c=t(52987),m=t(64449),v=t(57450),f=function(e){var n=e.attributes,t=void 0===n?[]:n,f=e.loading,p=void 0!==f&&f,b=e.withFilters,Z=void 0===b||b,h=e.filters,x=void 0===h?{}:h,y=e.onRowClick,g=e.actions,E=e.onFiltersUpdate,j=function(e,n){"checkbox"===n.type&&!1===x[n.name]&&n.checked&&(n.indeterminate=!0,n.checked=!1),E&&E(n)},I=(0,i.$G)().t,C=(0,d.Z)().lang,T=g?Array.isArray(g)?g:[g]:[],_=Object.keys(c.GC).map((function(e){return{key:e,value:e,text:I("attributes.types."+e)}})),D=Object.keys(c.aZ).map((function(e){return{key:e,value:e,text:I("attributes.formats."+e)}}));return(0,v.jsxs)(l.Z,{selectable:!0,striped:!0,children:[(0,v.jsxs)(l.Z.Header,{children:[(0,v.jsxs)(l.Z.Row,{children:[(0,v.jsx)(l.Z.HeaderCell,{width:4,children:I("attributes.label")}),(0,v.jsx)(l.Z.HeaderCell,{width:4,children:I("attributes.ID")}),(0,v.jsx)(l.Z.HeaderCell,{width:3,children:I("attributes.type")}),(0,v.jsx)(l.Z.HeaderCell,{width:3,children:I("attributes.format")}),(0,v.jsx)(l.Z.HeaderCell,{width:1,children:I("attributes.multiple_values")}),(0,v.jsx)(l.Z.HeaderCell,{width:1,children:I("attributes.isSystem")}),(0,v.jsx)(l.Z.HeaderCell,{width:1})]}),Z&&(0,v.jsxs)(l.Z.Row,{className:"filters",children:[(0,v.jsx)(l.Z.HeaderCell,{children:(0,v.jsx)(a.Z,{size:"small",fluid:!0,placeholder:I("attributes.label")+"...",name:"label",value:x.label||"",onChange:j})}),(0,v.jsx)(l.Z.HeaderCell,{children:(0,v.jsx)(a.Z,{size:"small",fluid:!0,placeholder:I("attributes.ID")+"...",name:"id",value:x.id||"",onChange:j})}),(0,v.jsx)(l.Z.HeaderCell,{children:(0,v.jsx)(o.Z,{fluid:!0,multiple:!0,search:!0,selection:!0,options:_,placeholder:I("attributes.type")+"...",name:"type",value:x.type||[],onChange:j})}),(0,v.jsx)(l.Z.HeaderCell,{children:(0,v.jsx)(o.Z,{fluid:!0,multiple:!0,search:!0,selection:!0,options:D,placeholder:I("attributes.format")+"...",name:"format",value:x.format||[],onChange:j})}),(0,v.jsx)(l.Z.HeaderCell,{children:(0,v.jsx)(s.Z,{indeterminate:"undefined"===typeof x.multiple_values,name:"multiple_values",checked:x.multiple_values,onChange:j})}),(0,v.jsx)(l.Z.HeaderCell,{children:(0,v.jsx)(s.Z,{indeterminate:"undefined"===typeof x.system,name:"system",checked:x.system,onChange:j})}),(0,v.jsx)(l.Z.HeaderCell,{})]})]}),(0,v.jsx)(l.Z.Body,{children:p?(0,v.jsx)(l.Z.Row,{children:(0,v.jsx)(l.Z.Cell,{colSpan:6,children:(0,v.jsx)(m.Z,{})})}):!!t&&t.map((function(e){var n=(0,u.dX)(e.label,C);return(0,v.jsxs)(l.Z.Row,{onClick:function(){return y(e)},children:[(0,v.jsx)(l.Z.Cell,{children:n}),(0,v.jsx)(l.Z.Cell,{children:e.id}),(0,v.jsx)(l.Z.Cell,{children:I("attributes.types."+e.type)}),(0,v.jsx)(l.Z.Cell,{children:e.format?I("attributes.formats."+e.format):""}),(0,v.jsx)(l.Z.Cell,{width:1,children:(0,v.jsx)(s.Z,{readOnly:!0,checked:e.multiple_values})}),(0,v.jsx)(l.Z.Cell,{width:1,children:(0,v.jsx)(s.Z,{readOnly:!0,checked:e.system})}),(0,v.jsx)(l.Z.Cell,{textAlign:"right",width:1,className:"actions",children:T.map((function(n){return r.cloneElement(n,{attribute:e})}))})]},e.id)}))})]})}},71961:function(e,n,t){t.r(n),t.d(n,{default:function(){return Rr}});var r,i,l,a,o,s,d=t(80688),u=t(54681),c=t(74280),m=t(18758),v=t(64449),f=t(34795),p=t(2867),b=t(71171),Z=t(77162),h=t.n(Z),x=t(76307),y=t(70663),g=t(19106),E=t(47016),j=t(63851),I=t(81592),C=t(8450),T=t(92042),_=t(37893),D=t(42737),w=t.n(D),N=w()(r||(r=(0,b.Z)(["\n    mutation INDEX_RECORDS($libraryId: String!, $records: [String!]) {\n        indexRecords(libraryId: $libraryId, records: $records)\n    }\n"]))),S=t(38777),k=t(38769),O=t(55152),A=t(22263),R=t(59820),P=t(39719),L=t(16058),B=t(57450),V=function(e){var n=(0,y.$G)().t,t=e.attribute,r=e.library,i=e.onUnlink;if(!t||!r)return(0,B.jsx)(B.Fragment,{});var l=null!==r.label&&(r.label.fr||r.label.en)||r.id;return(0,B.jsx)(L.Z,{action:function(){var e=r.attributes?r.attributes.filter((function(e){return e.id!==t.id})).map((function(e){return e.id})):[];return i(e)},confirmMessage:n("libraries.confirm_unlink_attr",{libLabel:l}),children:(0,B.jsx)(T.Z,{className:"unlink",circular:!0,icon:"cancel",disabled:t.system})})},M=function(e){var n=e.library,t=e.readonly,r=(0,y.$G)().t,i=(0,u.useState)({visible:!1}),l=(0,p.Z)(i,2),a=l[0],o=l[1],s=(0,u.useState)(!1),c=(0,p.Z)(s,2),v=c[0],b=c[1],Z=(0,d.useMutation)(A.D),x=(0,p.Z)(Z,1)[0],g=function(){return o({visible:!1})},E=function(){b(!1)},j=function(){var e=(0,f.Z)(h().mark((function e(t){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",x({variables:{libId:n.id,attributes:t},refetchQueries:[{query:m.w,variables:{id:n.id}}]}));case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),I=function(){var e=(0,f.Z)(h().mark((function e(t){var r;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==n){e.next=2;break}return e.abrupt("return");case 2:return r=n.attributes?[].concat((0,S.Z)(n.attributes.map((function(e){return e.id}))),[t.id]):[t.id],e.next=5,j(r);case 5:g();case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),C=function(){var e=(0,f.Z)(h().mark((function e(n){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",j(n));case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),_=function(){var e=(0,f.Z)(h().mark((function e(t){var r;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=n.attributes?n.attributes.map((function(e){return e.id})):[]).push.apply(r,(0,S.Z)(t)),e.next=4,j(r);case 4:return E(),e.abrupt("return");case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return n&&(0,B.jsxs)("div",{children:[!t&&(0,B.jsxs)(B.Fragment,{children:[(0,B.jsxs)(T.Z,{icon:!0,labelPosition:"left",size:"medium",onClick:function(){o({visible:!0})},children:[(0,B.jsx)(O.Z,{name:"plus"}),r("attributes.new")]}),(0,B.jsxs)(T.Z,{icon:!0,labelPosition:"left",size:"medium",onClick:function(){b(!0)},children:[(0,B.jsx)(O.Z,{name:"plus"}),r("libraries.link_existing_attribute")]})]}),(0,B.jsx)(R.Z,{loading:!1,attributes:n?n.attributes:[],onRowClick:function(e){o({visible:!0,attribute:e.id})},withFilters:!1,actions:t?(0,B.jsx)(B.Fragment,{}):(0,B.jsx)(V,{library:n,onUnlink:C},"unlink_attr_btn")}),!!n.attributes&&v&&(0,B.jsx)(P.Z,{openModal:v,onClose:E,onSubmit:_,selection:n.attributes.map((function(e){return e.id})),filter:{system:!1}}),a.visible&&(0,B.jsx)(k.Z,{open:!0,onClose:g,onPostSave:a.attribute?null:I,attribute:a.attribute,redirectAfterCreate:!1})]})},F=M,G=t(56666),H=t(33028),$=w()(i||(i=(0,b.Z)(["\n    mutation DELETE_FORM($library: ID!, $formId: ID!) {\n        deleteForm(library: $library, id: $formId) {\n            library {\n                id\n            }\n            id\n        }\n    }\n"]))),U=w()(l||(l=(0,b.Z)(["\n    query GET_FORMS_LIST($library: ID!, $id: ID, $label: String, $system: Boolean) {\n        forms(filters: {library: $library, id: $id, label: $label, system: $system}) {\n            totalCount\n            list {\n                id\n                label\n                system\n            }\n        }\n    }\n"]))),X=t(19913),K=t(33495),Y=w()(a||(a=(0,b.Z)(["\n    fragment FormElementsByDeps on FormElementsByDeps {\n        dependencyValue {\n            attribute\n            value {\n                id\n                library\n            }\n        }\n        elements {\n            id\n            containerId\n            order\n            type\n            uiElementType\n            settings {\n                key\n                value\n            }\n        }\n    }\n"]))),z=w()(o||(o=(0,b.Z)(["\n    ","\n    query GET_FORM($library: ID!, $id: ID!) {\n        forms(filters: {library: $library, id: $id}) {\n            totalCount\n            list {\n                id\n                label\n                system\n                elements {\n                    ...FormElementsByDeps\n                }\n                dependencyAttributes {\n                    id\n                    label\n                    ... on TreeAttribute {\n                        linked_tree {\n                            id\n                        }\n                    }\n                }\n            }\n        }\n    }\n"])),Y),Q=(0,u.createContext)({form:null,library:null,readonly:!1,setForm:null}),q=function(){return(0,u.useContext)(Q)},W=t(67605),J=t(85031),ee=w()(s||(s=(0,b.Z)(["\n    ","\n    mutation SAVE_FORM($formData: FormInput!) {\n        saveForm(form: $formData) {\n            id\n            label\n            system\n            elements {\n                ...FormElementsByDeps\n            }\n            dependencyAttributes {\n                id\n                label\n            }\n        }\n    }\n"])),Y),ne=(0,u.createContext)(null),te=function(){return(0,u.useContext)(ne)},re=t(24532),ie={form:null,library:"",openSettings:!1,activeDependency:null,elementInSettings:null,elements:{},activeElements:{}},le=u.createContext({state:ie,dispatch:function(){return ie}}),ae=function(){return(0,u.useContext)(le)},oe=t(15189),se=t(50576);function de(e){return e?"".concat(e.library.id,"/").concat(e.id):ge}var ue=t(68346),ce=t.n(ue);function me(e,n){return ce()(e,n,(function(e,n){if(Array.isArray(e))return e.concat(n)}))}function ve(e,n){return e.order-n.order}var fe=t(41361),pe=t(74082),be=t.n(pe);var Ze=function e(n,t){var r=be()(t);if("undefined"!==typeof r[n.id]){var i,l=(0,fe.Z)(r[n.id]);try{for(l.s();!(i=l.n()).done;){r=e(i.value,r)}}catch(a){l.e(a)}finally{l.f()}delete r[n.id]}return r},he=function(e,n,t,r,i){var l=be()(e.elements),a=function(e){return e.id!==n};l[t][r][i]=l[t][r][i].filter(a),l[t][r]=Ze({id:n},l[t][r]);var o=be()(e.activeElements);return o[i]=e.activeElements[i].filter(a),o=Ze({id:n},o),(0,H.Z)((0,H.Z)({},e),{},{elements:l,activeElements:o})};var xe,ye="__default",ge="__default",Ee="__root";!function(e){e.ADD_ELEMENT="ADD_ELEMENT",e.REMOVE_ELEMENT="REMOVE_ELEMENT",e.MOVE_ELEMENT="MOVE_ELEMENT",e.OPEN_SETTINGS="OPEN_SETTINGS",e.CLOSE_SETTINGS="CLOSE_SETTINGS",e.SAVE_SETTINGS="SAVE_SETTINGS",e.CHANGE_ACTIVE_DEPENDENCY="CHANGE_ACTIVE_DEPENDENCY",e.REMOVE_TAB="REMOVE_TAB"}(xe||(xe={}));var je,Ie,Ce,Te=function(e,n){switch(n.type){case xe.ADD_ELEMENT:return function(e,n){var t,r=function(e){return function(t){var r=(0,H.Z)({},t);return t.id===e?(r.order=n.position.order,r):(t.order>=n.position.order&&r.order++,r)}},i=(0,H.Z)((0,H.Z)({},n.element),{},{order:n.position.order,containerId:n.position.containerId}),l=(0,se.cloneDeep)(e.elements),a=null!==(t=i.containerId)&&void 0!==t?t:Ee,o=e.activeDependency?e.activeDependency.attribute:ye,s=e.activeDependency?de(e.activeDependency.value):ge;(l=me(l,(0,G.Z)({},o,(0,G.Z)({},s,(0,G.Z)({},a,[i])))))[o][s][a]=l[o][s][a].map(r(i.id)).sort(ve);var d=(0,G.Z)({},a,[(0,H.Z)((0,H.Z)({},i),{},{herited:!1})]),u=me((0,se.cloneDeep)(e.activeElements),d);return u[a]=u[a].map(r(i.id)).sort(ve),(0,H.Z)((0,H.Z)({},e),{},{elements:l,activeElements:u})}(e,n);case xe.REMOVE_ELEMENT:return function(e,n){var t,r=e.activeDependency?e.activeDependency.attribute:ye,i=e.activeDependency?de(e.activeDependency.value):ge,l=null!==(t=n.element.containerId)&&void 0!==t?t:Ee;return he(e,n.element.id,r,i,l)}(e,n);case xe.MOVE_ELEMENT:return function(e,n){var t=be()(e.elements),r=be()(e.activeElements),i=e.activeDependency?e.activeDependency.attribute:ye,l=e.activeDependency?de(e.activeDependency.value):ge;if(n.to.containerId===n.from.containerId){var a=n.from.order>n.to.order?"down":"up",o=function(e){return function(t){var r=(0,H.Z)({},t);return t.id===e?(r.order=n.to.order,r):("down"===a&&t.order>=n.to.order&&t.order<n.from.order?r.order++:"up"===a&&t.order>n.from.order&&t.order<=n.to.order&&r.order--,r)}};t[i][l][n.from.containerId]=t[i][l][n.from.containerId].map(o(n.elementId)).sort(ve),r[n.to.containerId]=r[n.to.containerId].map(o(n.elementId)).sort(ve)}else{var s=e.activeElements[n.from.containerId].findIndex((function(e){return e.id===n.elementId}));if(-1===s)return e;var d=(0,H.Z)((0,H.Z)({},e.activeElements[n.from.containerId][s]),n.to);"undefined"!==typeof t[i][l][n.from.containerId]&&(t[i][l][n.from.containerId]=t[i][l][n.from.containerId].filter((function(e){return e.id!==n.elementId})).map((function(e){return(0,H.Z)((0,H.Z)({},e),{},{order:e.order>n.from.order?e.order-1:e.order})})).sort(ve)),(t=me(t,(0,G.Z)({},i,(0,G.Z)({},l,(0,G.Z)({},n.to.containerId,[d])))))[i][l][n.to.containerId]=t[i][l][n.to.containerId].map((function(e){return(0,H.Z)((0,H.Z)({},e),{},{order:e.order>=n.to.order&&e.id!==n.elementId?e.order+1:e.order})})).sort(ve),"undefined"!==typeof r[n.from.containerId]&&(r[n.from.containerId]=r[n.from.containerId].filter((function(e){return e.id!==n.elementId})).map((function(e){return(0,H.Z)((0,H.Z)({},e),{},{order:e.order>n.from.order?e.order-1:e.order})})).sort(ve)),(r=me(r,(0,G.Z)({},n.to.containerId,[d])))[n.to.containerId]=r[n.to.containerId].map((function(e){return(0,H.Z)((0,H.Z)({},e),{},{order:e.order>=n.to.order&&e.id!==n.elementId?e.order+1:e.order})})).sort(ve)}return(0,H.Z)((0,H.Z)({},e),{},{elements:t,activeElements:r})}(e,n);case xe.OPEN_SETTINGS:return function(e,n){return(0,H.Z)((0,H.Z)({},e),{},{openSettings:!0,elementInSettings:n.element})}(e,n);case xe.CLOSE_SETTINGS:return function(e,n){return(0,H.Z)((0,H.Z)({},e),{},{openSettings:!1,elementInSettings:null})}(e);case xe.SAVE_SETTINGS:return function(e,n){var t,r,i,l,a=null!==(t=n.element)&&void 0!==t?t:e.elementInSettings;if(!a)return e;var o=(null===(r=e.activeDependency)||void 0===r?void 0:r.attribute)||"__default",s=null!==(i=e.activeDependency)&&void 0!==i&&i.value?de(e.activeDependency.value):"__default",d=null!==(l=a.containerId)&&void 0!==l?l:Ee,u=e.elements[o][s][d].findIndex((function(e){return e.id===a.id})),c=e.activeElements[d].findIndex((function(e){return e.id===a.id}));if(u<0||c<0)return e;var m=(0,H.Z)((0,H.Z)({},a.settings),n.settings),v=(0,H.Z)((0,H.Z)({},a),{},{settings:m}),f=be()(e.elements);f[o][s][d][u]=v;var p=(0,H.Z)({},e.activeElements);return p[d][c]=(0,H.Z)((0,H.Z)({},p[d][c]),{},{settings:m}),(0,H.Z)((0,H.Z)({},e),{},{elementInSettings:v,elements:f,activeElements:p})}(e,n);case xe.CHANGE_ACTIVE_DEPENDENCY:return function(e,n){for(var t,r=null!==(t=n.activeDependency)&&void 0!==t?t:{},i=r.attribute,l=void 0===i?"":i,a=r.value,o=void 0===a?{}:a,s=r.ancestors,d=void 0===s?[]:s,u=be()(e.elements[ye][ge]),c=0,m=Object.keys(u);c<m.length;c++){var v=m[c];u[v]=u[v].map((function(e){return(0,H.Z)((0,H.Z)({},e),{},{herited:!(!l||null===o||void 0===o||!o.id)})}))}if(l){var f,p,b,Z,h=(0,fe.Z)(d);try{for(h.s();!(Z=h.n()).done;){for(var x,y,g,E=de(Z.value),j=null!==(x=null===(y=e.elements)||void 0===y||null===(g=y[l])||void 0===g?void 0:g[E])&&void 0!==x?x:{},I=0,C=Object.keys(j);I<C.length;I++){var T=C[I];j[T]=j[T].map((function(e){return(0,H.Z)((0,H.Z)({},e),{},{herited:!0})}))}u=me(u,j)}}catch(k){h.e(k)}finally{h.f()}for(var _=de(o),D=null!==(f=null===(p=e.elements)||void 0===p||null===(b=p[l])||void 0===b?void 0:b[_])&&void 0!==f?f:{},w=0,N=Object.keys(D);w<N.length;w++){var S=N[w];D[S]=D[S].map((function(e){return(0,H.Z)((0,H.Z)({},e),{},{herited:!1})}))}u=me(u,D)}return(0,H.Z)((0,H.Z)({},e),{},{activeElements:u,activeDependency:n.activeDependency?(0,H.Z)({},n.activeDependency):null})}(e,n);case xe.REMOVE_TAB:return function(e,n){var t,r=e.activeDependency?e.activeDependency.attribute:ye,i=e.activeDependency?de(e.activeDependency.value):ge,l=null!==(t=n.parentElement.containerId)&&void 0!==t?t:Ee,a="".concat(n.parentElement.id,"/").concat(n.tabId),o=he(e,a,r,i,l),s=o.elements[r][i][l].findIndex((function(e){return e.id===n.parentElement.id})),d=o.activeElements[l].findIndex((function(e){return e.id===n.parentElement.id}));if(s>=0&&d>=0){var u,c=(0,H.Z)((0,H.Z)({},n.parentElement.settings),{},{tabs:(0,S.Z)(null===(u=n.parentElement.settings)||void 0===u?void 0:u.tabs).filter((function(e){return e.id!==n.tabId}))}),m=(0,H.Z)((0,H.Z)({},n.parentElement),{},{settings:c});o.elements[r][i][l][s]=m,o.activeElements[l][d]=m}return o}(e,n);default:return e}},_e=t(887),De=t(19046),we=t(15098),Ne=_.ZP.div(je||(je=(0,b.Z)(["\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n"]))),Se=_.ZP.div(Ie||(Ie=(0,b.Z)(["\n    height: 300px;\n    width: 300px;\n"]))),ke=(0,_.ZP)(oe.Z.Section)(Ce||(Ce=(0,b.Z)(["\n    position: relative;\n"])));var Oe=function(e){var n,t=e.treeData,r=e.element,i=e.ancestors,l=(0,c.Z)().lang,a=(0,X.dX)(t.label,l),o=ae(),s=o.state,d=o.dispatch,m=(0,u.useState)(!1),v=(0,p.Z)(m,2),f=v[0],b=v[1],Z=r?(0,B.jsx)(De.Z,{record:r}):a;if(i){var h=i.slice(-1)[0];n=h?{id:h.id,library:h.library.id}:void 0}return(0,B.jsx)(ke,{children:(0,B.jsxs)(Ne,{children:[(0,B.jsx)("div",{className:"identity",onClick:function(){var e,n;return d({type:xe.CHANGE_ACTIVE_DEPENDENCY,activeDependency:{attribute:null!==(e=null===(n=s.activeDependency)||void 0===n?void 0:n.attribute)&&void 0!==e?e:ye,value:null!==r&&void 0!==r?r:null,ancestors:null!==i&&void 0!==i?i:[]}})},children:Z}),(0,B.jsx)(_e.Z,{on:"click",open:f,onOpen:function(){return b(!0)},onClose:function(){return b(!1)},trigger:(0,B.jsx)("div",{className:"dropdown-icon",children:(0,B.jsx)(O.Z,{name:"dropdown"})}),content:(0,B.jsx)(Se,{children:(0,B.jsx)(we.Z,{tree:t,onClickNode:function(e){var n,t=e.node;b(!1),d({type:xe.CHANGE_ACTIVE_DEPENDENCY,activeDependency:{attribute:(null===(n=s.activeDependency)||void 0===n?void 0:n.attribute)||ye,value:t.record.whoAmI||ge,ancestors:t.ancestors.slice(0,-1).map((function(e){return e.whoAmI}))}})},readOnly:!0,compact:!0,startAt:n})}),position:"bottom left",basic:!0})]})})};var Ae=function(e){var n,t,r,i=e.treeData,l=ae().state,a=function(e,n){var t;return(0,B.jsx)(Oe,{treeData:i,element:e,ancestors:n},null!==(t=null===e||void 0===e?void 0:e.id)&&void 0!==t?t:ge)},o=[{key:ge,content:a(),link:!1,active:!1}];return null!==(n=l.activeDependency)&&void 0!==n&&n.ancestors&&(o=[].concat((0,S.Z)(o),(0,S.Z)(l.activeDependency.ancestors.map((function(e,n){return{key:e.id,content:a(e,(0,S.Z)(l.activeDependency.ancestors).splice(0,n)),link:!1,active:!1}}))))),null!==(t=l.activeDependency)&&void 0!==t&&t.value&&o.push({key:l.activeDependency.value.id,content:a(l.activeDependency.value,null!==(r=l.activeDependency.ancestors)&&void 0!==r?r:[]),link:!1,active:!1}),(0,B.jsx)(oe.Z,{sections:o,icon:"right angle"})};var Re,Pe=function(){var e,n,t,r=ae(),i=r.state,l=(r.dispatch,null===(n=(null===(e=i.form.dependencyAttributes)||void 0===e?void 0:e.find((function(e){var n;return e.id===(null===(n=i.activeDependency)||void 0===n?void 0:n.attribute)}))).linked_tree)||void 0===n?void 0:n.id),a=(0,d.useQuery)(re.F,{variables:{id:l},skip:!l}),o=a.loading,s=a.error,u=a.data;if(o)return(0,B.jsx)(v.Z,{});if(s)return(0,B.jsxs)("div",{className:"error",children:["ERROR ",s]});if(null===u||void 0===u||null===(t=u.trees)||void 0===t||!t.list.length)return(0,B.jsx)("div",{className:"error",children:"CANNOT RETRIEVE TREE DATA"});var c=u.trees.list[0];return(0,B.jsx)(Ae,{treeData:c})},Le=t(69356),Be=(0,_.ZP)(Le.Z)(Re||(Re=(0,b.Z)(["\n    margin: 2em 0;\n"])));Be.displayName="Dropdown";var Ve,Me,Fe,Ge,He,$e=function(){var e=(0,c.Z)().lang,n=(0,y.$G)().t,t=ae(),r=t.state,i=t.dispatch;if(!r.form.dependencyAttributes||!r.form.dependencyAttributes.length)return(0,B.jsx)(B.Fragment,{});var l=r.form.dependencyAttributes.map((function(n){return{text:(0,X.dX)(n.label,e),value:n.id}}));return(0,B.jsx)(Be,{"data-test-id":"attribute-selection",selection:!0,fluid:!0,clearable:!0,options:l,placeholder:n("forms.select_attribute"),onChange:function(e,n){return i({type:xe.CHANGE_ACTIVE_DEPENDENCY,activeDependency:{attribute:n.value,value:null,ancestors:[]}})}})},Ue=t(39918),Xe=t(89301),Ke=t(74954),Ye=t(52987);!function(e){e.DIVIDER="divider",e.FIELDS_CONTAINER="fields_container",e.TEXT_BLOCK="text_block",e.TABS="tabs"}(Ve||(Ve={})),function(e){e.TEXT_INPUT="input_field",e.DATE="date",e.CHECKBOX="checkbox",e.ENCRYPTED="encrypted",e.DROPDOWN="dropdown",e.LINK="link",e.TREE="tree"}(Me||(Me={})),function(e){e.RESERVE_LAYOUT_ELEMENT="RESERVE_LAYOUT_ELEMENT",e.ATTRIBUTE="ATTRIBUTE",e.FORM_ELEMENT="FORM_ELEMENT"}(Fe||(Fe={})),function(e){e.VERTICAL="VERTICAL",e.HORIZONTAL="HORIZONTAL"}(Ge||(Ge={})),function(e){e.NONE="NONE",e.ATTRIBUTE_SELECTION="ATTRIBUTE_SELECTION",e.ATTRIBUTE_SELECTION_MULTIPLE="ATTRIBUTE_SELECTION_MULTIPLE",e.INPUT="INPUT",e.CHECKBOX="CHECKBOX",e.RTE="RTE",e.SELECT="SELECT"}(He||(He={}));var ze=t(56022);var Qe,qe,We=function(e){var n={label:e.settings.label};return(0,B.jsx)(ze.Z,(0,H.Z)({toggle:!0},n))},Je=t(35925),en=(0,_.ZP)(Je.Z)(Qe||(Qe=(0,b.Z)(["\n    && {\n        flex-grow: 0;\n    }\n"]))),nn=(0,_.ZP)(Je.Z)(qe||(qe=(0,b.Z)(["\n    && {\n        margin-left: 0.5em;\n        flex-grow: 0;\n    }\n"])));var tn=function(e){var n=e.settings,t=n.label,r=void 0===t?"Date":t,i=n.withTime,l=void 0!==i&&i,a={label:r};return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(en,(0,H.Z)({"data-test-id":"date-field",type:"date"},a)),l&&(0,B.jsx)(nn,{"data-test-id":"time-field",type:"time"})]})};var rn=function(e){var n=e.settings;return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)("label",{children:n.label}),(0,B.jsx)(Le.Z,(0,H.Z)({},n))]})};var ln=function(e){var n=e.settings.label,t={label:void 0===n?"Toto":n};return(0,B.jsx)(Je.Z,(0,H.Z)({type:"password"},t))};var an,on,sn,dn=function(e){var n=e.settings,t=n.label,r=n.type,i=void 0===r?"text":r,l={label:t};return(0,B.jsx)(Je.Z,(0,H.Z)((0,H.Z)({type:i},l),{},{fluid:!0}))},un=t(31010),cn=_.ZP.div(an||(an=(0,b.Z)(["\n    border-radius: 50%;\n    background: #ddd;\n    margin-right: 1em;\n    height: 2em;\n    width: 2em;\n    flex-grow: 0;\n"]))),mn=_.ZP.div(on||(on=(0,b.Z)(["\n    background: #ddd;\n    height: 1.5em;\n    flex-grow: 1;\n"]))),vn=_.ZP.div(sn||(sn=(0,b.Z)(["\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n"])));var fn,pn,bn,Zn=function(e){var n=e.settings;return(0,B.jsxs)(un.Z,{celled:!0,striped:!0,children:[(0,B.jsx)(un.Z.Header,{children:(0,B.jsx)(un.Z.Row,{children:(0,B.jsx)(un.Z.HeaderCell,{colSpan:"3",children:n.label})})}),(0,B.jsx)(un.Z.Body,{children:(0,B.jsxs)(un.Z.Row,{children:[(0,B.jsx)(un.Z.Cell,{width:"4",children:(0,B.jsxs)(vn,{children:[(0,B.jsx)(cn,{}),(0,B.jsx)(mn,{})]})}),(0,B.jsx)(un.Z.Cell,{width:"6",children:(0,B.jsx)(mn,{})}),(0,B.jsx)(un.Z.Cell,{width:"6",children:(0,B.jsx)(mn,{})})]})})]})},hn=_.ZP.div(fn||(fn=(0,b.Z)(["\n    border-radius: 50%;\n    background: #ddd;\n    margin-right: 1em;\n    height: 2em;\n    width: 2em;\n    flex-grow: 0;\n"]))),xn=_.ZP.div(pn||(pn=(0,b.Z)(["\n    background: #ddd;\n    height: 1.5em;\n    flex-grow: 1;\n"]))),yn=_.ZP.div(bn||(bn=(0,b.Z)(["\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    width: 200px;\n"])));var gn,En=function(){return(0,B.jsxs)(yn,{children:[(0,B.jsx)(hn,{}),(0,B.jsx)(xn,{})]})},jn=(0,_.ZP)(oe.Z)(gn||(gn=(0,b.Z)(["\n    && {\n        display: flex;\n        align-items: center;\n    }\n"])));var In,Cn,Tn,_n,Dn=function(e){var n=e.settings,t=(0,S.Z)(Array(3)).map((function(e,n){return{key:n,content:(0,B.jsx)(En,{}),link:!1,active:!1}}));return(0,B.jsxs)(un.Z,{celled:!0,striped:!0,children:[(0,B.jsx)(un.Z.Header,{children:(0,B.jsx)(un.Z.Row,{children:(0,B.jsx)(un.Z.HeaderCell,{children:n.label})})}),(0,B.jsx)(un.Z.Body,{children:(0,B.jsx)(un.Z.Row,{children:(0,B.jsx)(un.Z.Cell,{width:"4",children:(0,B.jsx)(jn,{icon:"right angle",sections:t})})})})]})},wn=t(41344),Nn=(0,_.ZP)(T.Z.Group)(In||(In=(0,b.Z)(["\n    position: absolute;\n    top: 5px;\n    right: 5px;\n    cursor: pointer;\n    z-index: 10;\n"]))),Sn=_.ZP.div(Cn||(Cn=(0,b.Z)(["\n    position: relative;\n    background: ",";\n    margin: 1em 0;\n    border-radius: 5px;\n    border-width: 1px;\n    border-style: dashed;\n    border-color: ",";\n    display: flex;\n    color: #aaaaaa;\n    min-height: 4em;\n"])),(function(e){return e.isHerited?"#C3FFF9":"#FFF"}),(function(e){return e.isOver?"#999":"#DDD"})),kn=_.ZP.div(Tn||(Tn=(0,b.Z)(["\n    text-align: center;\n    align-self: center;\n    width: 2em;\n    cursor: move;\n"]))),On=_.ZP.div(_n||(_n=(0,b.Z)(["\n    width: 100%;\n    text-align: left;\n    padding: 0.5em;\n    border-left: ",";\n    display: flex;\n\n    & > div {\n        flex-grow: 1;\n    }\n"])),(function(e){return e.isHerited||e.isReadOnly?"none":"1px solid #aaa"}));var An,Rn,Pn=function(e){var n,t,r,i,l,a=e.element,o=e.index,s=e.dispatch,m=e.state,f=(0,c.Z)().lang,b=(0,u.useRef)(null),Z=q().readonly,h=(0,d.useQuery)(Ue.V,{variables:{id:String(null===a||void 0===a||null===(n=a.settings)||void 0===n?void 0:n.attribute)||null},skip:!(null!==a&&void 0!==a&&null!==(t=a.settings)&&void 0!==t&&t.attribute)}),x=h.loading,y=h.error,g=h.data,E=(0,u.useState)(!1),j=(0,p.Z)(E,2),I=j[0],C=j[1],_=(0,wn.L)({accept:[Fe.ATTRIBUTE,Fe.FORM_ELEMENT,Fe.RESERVE_LAYOUT_ELEMENT],collect:function(e){return{isOver:!!e.isOver()&&a.uiElement.canDrop(e.getItem())}},canDrop:function(e){return a.uiElement.canDrop(e.element)&&!Z},hover:function(e,n){var t=n.isOver({shallow:!0});if(e.element.id!==a.id&&t){var r=e.currentPos?(0,H.Z)({},e.currentPos):{order:999,containerId:a.containerId},i=b.current.getBoundingClientRect(),l=n.getClientOffset().y-i.top,d=o,u=e.index,c=u<=d,m=u>d,v=i.bottom-i.top,f=.5*v,p=v-.5*v;if(e.dropAtPos={order:d,containerId:a.containerId},c&&l>p||m&&l<f||u<0){var Z=d;e.currentPos={order:Z,containerId:a.containerId},e.dropAtPos={order:Z,containerId:a.containerId},u<0&&(e.index=Z),u<0?s({type:xe.ADD_ELEMENT,element:(0,H.Z)({},e.element),position:{order:Z,containerId:a.containerId}}):u!==Z&&s({type:xe.MOVE_ELEMENT,elementId:e.element.id,from:r,to:e.dropAtPos}),e.index=Z}}}}),D=(0,p.Z)(_,2)[1],w=(0,Xe.c)({item:{type:Fe.ATTRIBUTE,element:a,index:o,currentPos:{order:o,containerId:a.containerId},originPos:{order:o,containerId:a.containerId}},collect:function(e){return{isDragging:!!e.isDragging()}},canDrag:!Z,end:function(e,n){n.didDrop()||s({type:xe.MOVE_ELEMENT,elementId:n.getItem().element.id,from:n.getItem().currentPos,to:n.getItem().originPos})}}),N=(0,p.Z)(w,3),S=N[1],k=N[2];if(x)return(0,B.jsx)(v.Z,{});if(y)return(0,B.jsxs)("div",{children:["ERROR ",y]});var A=null===g||void 0===g||null===(r=g.attributes)||void 0===r?void 0:r.list[0],R=(0,H.Z)((0,H.Z)({},a.settings),{},{attribute:"undefined"!==typeof(null===a||void 0===a||null===(i=a.settings)||void 0===i?void 0:i.attribute)?A:null,label:(null===a||void 0===a||null===(l=a.settings)||void 0===l?void 0:l.label)||A&&(0,X.dX)(A.label,f)||a.type});return D(k(b)),(0,B.jsxs)(Sn,{ref:b,onMouseEnter:function(){return C(!0)},onMouseLeave:function(){return C(!1)},isOver:!1,isHerited:!!a.herited,children:[I&&(0,B.jsxs)(Nn,{icon:!0,children:[(0,B.jsx)(T.Z,{onClick:function(){s({type:xe.OPEN_SETTINGS,element:a})},children:(0,B.jsx)(O.Z,{name:"cog"})}),(0,B.jsx)(T.Z,{onClick:function(){s({type:xe.REMOVE_ELEMENT,element:a})},children:(0,B.jsx)(O.Z,{name:"cancel"})})]}),!a.herited&&!Z&&(0,B.jsx)(kn,{ref:S,children:(0,B.jsx)(O.Z,{name:"bars",fitted:!0})}),(0,B.jsx)(On,{isHerited:!!a.herited,isReadOnly:Z,children:(0,B.jsx)(a.uiElement.component.type,{elementData:a,settings:R,state:m,dispatch:s})})]})},Ln=_.ZP.div(An||(An=(0,b.Z)(["\n    background: ",";\n    padding: ",";\n    color: #aaaaaa;\n    text-align: center;\n    display: flex;\n    flex-direction: column;\n    width: 100%;\n    min-height: ",";\n"])),(function(e){return e.isRootContainer?"#FFF":"#EEE"}),(function(e){return e.isRootContainer?0:"2em"}),(function(e){return e.isRootContainer?"calc(100vh - 18rem)":"auto"})),Bn=_.ZP.div(Rn||(Rn=(0,b.Z)(["\n    border: 3px dashed #ddd;\n    border-radius: 5px;\n    text-align: center;\n    padding: 2em;\n    font-weight: bold;\n"])));var Vn=function(e){var n=e.elementData,t=e.state,r=e.dispatch,i=(0,y.$G)().t,l=(0,u.useRef)(null),a=(0,wn.L)({accept:[Fe.ATTRIBUTE,Fe.FORM_ELEMENT,Fe.RESERVE_LAYOUT_ELEMENT],drop:function(e){return{containerId:(null===n||void 0===n?void 0:n.id)||Ee}},collect:function(e){return{isOver:e.isOver({shallow:!0})}},hover:function(e,i){var a,o,s=i.isOver({shallow:!0});if(t&&r&&n&&s&&(null===(a=e.currentPos)||void 0===a?void 0:a.containerId)!==(null===n||void 0===n?void 0:n.id)&&e.element.id!==n.id){var d,u=l.current.getBoundingClientRect(),c=i.getClientOffset().y-u.top,m=e.index,v={order:c<.5*(u.bottom-u.top)?0:(null!==(o=t.activeElements[n.id])&&void 0!==o?o:[]).length||0,containerId:n.id};if(m<0)r({type:xe.ADD_ELEMENT,element:(0,H.Z)({},e.element),position:v});else r({type:xe.MOVE_ELEMENT,elementId:e.element.id,from:null!==(d=e.currentPos)&&void 0!==d?d:{order:e.element.order,containerId:e.element.containerId},to:v});e.dropAtPos=v,e.currentPos=v,e.index=v.order}}}),o=(0,p.Z)(a,2),s=o[0].isOver,d=o[1];if(!t||!r||!n)return(0,B.jsx)(B.Fragment,{});d(l);var c=t.activeElements[n.id]||[];return(0,B.jsx)(Ln,{isOver:s,isRootContainer:n.id===Ee,ref:l,children:c.length?c.map((function(e,n){return(0,B.jsx)(Pn,{element:e,index:n,state:t,dispatch:r},e.id)})):(0,B.jsx)(Bn,{children:i("forms.empty_container")})})},Mn=t(1385);var Fn,Gn=function(e){var n=e.open,t=e.tabsElement,r=e.tab,i=e.onClose,l=(0,c.Z)().availableLangs,a=ae().dispatch,o=function(e){"Enter"===e.key&&i()};return(0,B.jsxs)(K.Z,{open:n,onClose:i,closeOnEscape:!0,closeOnDimmerClick:!0,closeIcon:!0,size:"small",centered:!0,basic:!0,children:[(0,B.jsx)(K.Z.Header,{}),(0,B.jsx)(K.Z.Content,{children:l.map((function(e,n){var i,l,s;return(0,B.jsx)(Je.Z,{fluid:!0,name:e,label:e,defaultValue:null!==(i=null===r||void 0===r||null===(l=r.label)||void 0===l?void 0:l[e])&&void 0!==i?i:"",style:{margin:"1em"},onChange:(s=e,function(e,n){var i,l,o=null!==(i=null===t||void 0===t||null===(l=t.settings)||void 0===l?void 0:l.tabs)&&void 0!==i?i:[],d=o.findIndex((function(e){return e.id===r.id}));if(-1!==d){var u=(0,S.Z)(o);u[d]=(0,H.Z)((0,H.Z)({},u[d]),{},{label:(0,H.Z)((0,H.Z)({},u[d].label),{},(0,G.Z)({},s,n.value))});var c=(0,H.Z)((0,H.Z)({},null===t||void 0===t?void 0:t.settings),{},{tabs:u});a({type:xe.SAVE_SETTINGS,element:t,settings:c})}}),onKeyDown:o},e)}))})]})},Hn=(0,_.ZP)(Mn.Z.Item)(Fn||(Fn=(0,b.Z)(["\n    &&&& {\n        padding: 0 1rem;\n    }\n"])));var $n,Un=function(e){var n,t,r,i,l=e.settings,a=e.elementData,o=(0,c.Z)().lang,s=(0,y.$G)().t,d=(0,u.useState)(0),m=(0,p.Z)(d,2),v=m[0],f=m[1],b=(0,u.useState)(!1),Z=(0,p.Z)(b,2),h=Z[0],x=Z[1],g=ae(),E=g.state,j=g.dispatch,C=function(e){return{label:{fr:s("forms.new_tab_label",{index:e})},id:(0,Ke.Z)()}};if(!a||!j||!E)return(0,B.jsx)(B.Fragment,{});null!==l&&void 0!==l&&null!==(n=l.tabs)&&void 0!==n&&n.length&&v===(null===l||void 0===l||null===(t=l.tabs)||void 0===t?void 0:t.length)&&f((null===l||void 0===l||null===(i=l.tabs)||void 0===i?void 0:i.length)>1?v-1:0),null!==(r=l.tabs)&&void 0!==r&&r.length||j({type:xe.SAVE_SETTINGS,element:a,settings:(0,H.Z)((0,H.Z)({},null===a||void 0===a?void 0:a.settings),{},{tabs:[C()]})});var _=function(){return x(!0)},D=l.tabs||[],w=D.map((function(e){var n,t;return{menuItem:(0,B.jsxs)(Hn,{className:"form-tab-name",children:[(0,X.dX)(null!==(n=e.label)&&void 0!==n?n:null,o),(0,B.jsxs)(T.Z.Group,{icon:!0,compact:!0,basic:!0,size:"mini",style:{marginLeft:"10px"},children:[(0,B.jsx)(T.Z,{onClick:_,children:(0,B.jsx)(O.Z,{name:"edit"})}),D.length>1&&(0,B.jsx)(T.Z,{children:(0,B.jsx)(O.Z,{name:"cancel",onClick:(t=e.id,function(){j({type:xe.REMOVE_TAB,tabId:t,parentElement:a})})})})]})]},e.id),render:function(){var n={uiElement:tt[Ve.FIELDS_CONTAINER],id:"".concat(a.id,"/").concat(e.id),order:0,containerId:null===a||void 0===a?void 0:a.id,type:Ye.LH.layout,settings:{}};return(0,B.jsx)(I.Z.Pane,{children:(0,B.jsx)(n.uiElement.component.type,{state:E,dispatch:j,elementData:n})})}}}));return w.push({menuItem:(0,B.jsx)(Mn.Z.Item,{onClick:function(){var e,n;if(j){var t=[].concat((0,S.Z)(null!==(e=null===a||void 0===a||null===(n=a.settings)||void 0===n?void 0:n.tabs)&&void 0!==e?e:[]),[C()]);j({type:xe.SAVE_SETTINGS,element:a,settings:(0,H.Z)((0,H.Z)({},null===a||void 0===a?void 0:a.settings),{},{tabs:t})})}},children:(0,B.jsx)(O.Z,{name:"plus"})},"new_tab"),render:function(){return(0,B.jsx)(I.Z.Pane,{})}}),(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(I.Z,{menu:{tabular:!0,vertical:l.direction===Ge.VERTICAL,compact:!0,fluid:!0},activeIndex:v,onTabChange:function(e,n){f(n.activeIndex)},panes:w}),(0,B.jsx)(Gn,{open:h,tab:D[v],tabsElement:a,onClose:function(){return x(!1)}})]})},Xn=t(1519),Kn=t.n(Xn),Yn=_.ZP.div($n||($n=(0,b.Z)(["\n    display: block;\n"])));var zn=function(e){var n=e.settings.content,t=void 0===n?"":n,r=(0,y.$G)().t;return(0,B.jsx)(Yn,{"data-testid":"text-block-content",children:(0,B.jsx)(Kn(),{children:t.trim()||r("forms.text_block_helper")})})},Qn=t(71988);var qn,Wn,Jn,et=function(e){var n=e.settings;return null!==n&&void 0!==n&&n.title?(0,B.jsx)(Qn.Z,{horizontal:!0,children:null===n||void 0===n?void 0:n.title}):(0,B.jsx)(Qn.Z,{})},nt=[{name:"attribute",inputType:He.ATTRIBUTE_SELECTION},{name:"label",inputType:He.INPUT}],tt=(qn={},(0,G.Z)(qn,Ve.FIELDS_CONTAINER,{type:Ve.FIELDS_CONTAINER,component:(0,B.jsx)(Vn,{}),canDrop:function(){return!0}}),(0,G.Z)(qn,Ve.DIVIDER,{type:Ve.DIVIDER,component:(0,B.jsx)(et,{settings:{}}),settings:[{name:"title",inputType:He.INPUT}],canDrop:function(){return!1}}),(0,G.Z)(qn,Ve.TEXT_BLOCK,{type:Ve.TEXT_BLOCK,component:(0,B.jsx)(zn,{settings:{}}),settings:[{name:"content",inputType:He.RTE}],canDrop:function(){return!1}}),(0,G.Z)(qn,Ve.TABS,{type:Ve.TABS,component:(0,B.jsx)(Un,{settings:{}}),settings:[{name:"tabs",inputType:He.NONE},{name:"direction",inputType:He.SELECT,getInputSettings:function(){return{options:[Ge.HORIZONTAL,Ge.VERTICAL]}}}],canDrop:function(){return!1}}),qn),rt=(Wn={},(0,G.Z)(Wn,Me.TEXT_INPUT,{type:Me.TEXT_INPUT,component:(0,B.jsx)(dn,{settings:{}}),settings:[].concat(nt),canDrop:function(){return!1}}),(0,G.Z)(Wn,Me.CHECKBOX,{type:Me.CHECKBOX,component:(0,B.jsx)(We,{settings:{}}),settings:[].concat(nt),canDrop:function(){return!1}}),(0,G.Z)(Wn,Me.DATE,{type:Me.DATE,component:(0,B.jsx)(tn,{settings:{}}),settings:[].concat(nt,[{name:"withTime",inputType:He.CHECKBOX}]),canDrop:function(){return!1}}),(0,G.Z)(Wn,Me.ENCRYPTED,{type:Me.ENCRYPTED,component:(0,B.jsx)(ln,{settings:{}}),settings:[].concat(nt),canDrop:function(){return!1}}),(0,G.Z)(Wn,Me.DROPDOWN,{type:Me.DROPDOWN,component:(0,B.jsx)(rn,{settings:{}}),settings:[].concat(nt),canDrop:function(){return!1}}),(0,G.Z)(Wn,Me.LINK,{type:Me.LINK,component:(0,B.jsx)(Zn,{settings:{}}),settings:[].concat(nt,[{name:"columns",inputType:He.ATTRIBUTE_SELECTION_MULTIPLE,getInputSettings:function(e){return{multiple:!0,filters:{type:[Ye.GC.simple,Ye.GC.advanced]},library:e.linked_library.id}}},{name:"displayRecordIdentity",inputType:He.CHECKBOX,defaultValue:!0}]),canDrop:function(){return!1}}),(0,G.Z)(Wn,Me.TREE,{type:Me.TREE,component:(0,B.jsx)(Dn,{settings:{}}),settings:[].concat(nt),canDrop:function(){return!1}}),Wn),it=_.ZP.div(Jn||(Jn=(0,b.Z)(["\n    opacity: ",";\n    font-weight: bold;\n    cursor: move;\n    margin: 0.8em 0;\n"])),(function(e){return e.isDragging?.5:1}));var lt=function(e){var n=e.attribute,t=ae().dispatch,r=(0,c.Z)().lang,i=q().readonly,l=(0,X.dX)(n.label,r),a=(0,Xe.c)({item:{type:Fe.ATTRIBUTE,element:function(){var e,t,r=(e={},(0,G.Z)(e,Ye.aZ.boolean,rt[Me.CHECKBOX]),(0,G.Z)(e,Ye.aZ.date,rt[Me.DATE]),(0,G.Z)(e,Ye.aZ.encrypted,rt[Me.ENCRYPTED]),(0,G.Z)(e,Ye.aZ.extended,rt[Me.TEXT_INPUT]),(0,G.Z)(e,Ye.aZ.numeric,rt[Me.TEXT_INPUT]),(0,G.Z)(e,Ye.aZ.text,rt[Me.TEXT_INPUT]),(0,G.Z)(e,Ye.aZ.date_range,rt[Me.TEXT_INPUT]),e);switch(n.type){case Ye.GC.simple_link:case Ye.GC.advanced_link:t=rt[Me.LINK];break;case Ye.GC.tree:t=rt[Me.TREE];break;default:t=r[n.format]}return{id:(0,Ke.Z)(),order:0,type:Ye.LH.field,containerId:Ee,uiElement:t,settings:t.settings.reduce((function(e,n){return(0,H.Z)((0,G.Z)({},n.name,n.defaultValue),e)}),{attribute:n.id,label:l})}}(),index:-1},collect:function(e){return{isDragging:!!e.isDragging()}},canDrag:!i,end:function(e,n){if(n.didDrop()){var r;if("undefined"!==typeof n.getItem().dropAtPos)return;var i={order:(null===(r=n.getItem().dropAtPos)||void 0===r?void 0:r.order)||0,containerId:n.getDropResult().containerId};t({type:xe.ADD_ELEMENT,element:(0,H.Z)((0,H.Z)({},n.getItem().element),{},{containerId:i.containerId}),position:i})}}}),o=(0,p.Z)(a,2),s=o[0].isDragging,d=o[1];return(0,B.jsx)(it,{ref:d,isDragging:s,children:l})};var at,ot=function(){var e,n,t=ae().state,r=(0,d.useQuery)(Ue.V,{variables:{libraries:[t.library]}}),i=r.error,l=r.loading,a=r.data;return l?(0,B.jsx)(v.Z,{}):i?(0,B.jsxs)("div",{className:"error",children:["ERROR ",i]}):(0,B.jsx)(B.Fragment,{children:(null!==(e=null===a||void 0===a||null===(n=a.attributes)||void 0===n?void 0:n.list)&&void 0!==e?e:[]).map((function(e){return(0,B.jsx)(lt,{attribute:e},e.id)}))})},st=_.ZP.div(at||(at=(0,b.Z)(["\n    opacity: ",";\n    font-weight: bold;\n    cursor: move;\n    margin: 1em 0;\n"])),(function(e){return e.isDragging?.5:1}));var dt=function(e){var n=e.element,t=ae().dispatch,r=(0,y.$G)().t,i=q().readonly,l={id:(0,Ke.Z)(),order:0,containerId:Ee,type:Ye.LH.layout,uiElement:n},a=(0,Xe.c)({item:{type:Fe.RESERVE_LAYOUT_ELEMENT,element:l,index:-1},collect:function(e){return{isDragging:!!e.isDragging()}},canDrag:!i,end:function(e,n){if(n.didDrop()){var r;if("undefined"!==typeof n.getItem().dropAtPos)return;var i={order:(null===(r=n.getItem().dropAtPos)||void 0===r?void 0:r.order)||0,containerId:n.getDropResult().containerId};t({type:xe.ADD_ELEMENT,element:(0,H.Z)((0,H.Z)({},n.getItem().element),{},{containerId:i.containerId}),position:i})}else{var l,a=(null===(l=n.getItem().dropAtPos)||void 0===l?void 0:l.containerId)||Ee;t({type:xe.REMOVE_ELEMENT,element:(0,H.Z)((0,H.Z)({},n.getItem().element),{},{containerId:a})})}}}),o=(0,p.Z)(a,2),s=o[0].isDragging,d=o[1];return(0,B.jsx)(st,{isDragging:s,ref:d,children:r("forms.elements.".concat(n.type))})};var ut=function(){return(0,B.jsx)(B.Fragment,{children:Object.keys(tt).map((function(e){return(0,B.jsx)(dt,{element:tt[e]},e)}))})};var ct=function(){var e=(0,y.$G)().t,n=[{menuItem:e("forms.layout"),render:function(){return(0,B.jsx)(I.Z.Pane,{children:(0,B.jsx)(ut,{})})}},{menuItem:e("forms.attributes"),render:function(){return(0,B.jsx)(I.Z.Pane,{children:(0,B.jsx)(ot,{})})}}];return(0,B.jsx)(I.Z,{panes:n})},mt=t(59740),vt=["uiElementType"];var ft=t(53213),pt=t(5168),bt=t(95541),Zt=t(41442);var ht=function(e){var n,t=e.onChange,r=e.fieldName,i=e.library,l=e.filters,a=e.disabled,o=e.multiple,s=void 0!==o&&o,d=(0,y.$G)().t,u=ae().state.elementInSettings,c=null===u||void 0===u||null===(n=u.settings)||void 0===n?void 0:n[r];return(0,B.jsx)(Zt.Z,{multiple:s,disabled:a,placeholder:d("forms.select_attribute"),name:r,onChange:function(e,n){return t(n.name,n.value)},filters:(0,H.Z)((0,H.Z)({},l),{},{libraries:[i]}),fluid:!0,value:c},r)};var xt,yt=function(e){var n,t=e.onChange,r=e.fieldName,i=e.disabled,l=ae().state.elementInSettings;return(0,B.jsx)(ze.Z,{toggle:!0,name:r,onChange:function(e,n){return t(n.name,n.checked)},disabled:i,checked:!(null===l||void 0===l||null===(n=l.settings)||void 0===n||!n[r])})},gt=t(29720),Et=t.n(gt),jt=_.ZP.div(xt||(xt=(0,b.Z)(["\n    .rte-editor-toolbar select {\n        padding: 3px 25px 3px 3px;\n        background: transparent;\n    }\n"])));var It=function(e){var n,t,r=e.fieldName,i=e.onChange,l=e.disabled,a=(0,y.$G)().t,o=ae().state.elementInSettings,s=(0,u.useState)(Et().createValueFromString(String(null!==(n=null===o||void 0===o||null===(t=o.settings)||void 0===t?void 0:t[r])&&void 0!==n?n:""),"markdown")),d=(0,p.Z)(s,2),c=d[0],m=d[1];return(0,B.jsx)(jt,{"data-testid":"rte-editor-wrapper",children:(0,B.jsx)(Et(),{value:c,onChange:m,onBlur:function(){i(r,c.toString("markdown"))},disabled:l,toolbarConfig:{display:["INLINE_STYLE_BUTTONS","BLOCK_TYPE_BUTTONS","BLOCK_TYPE_DROPDOWN","HISTORY_BUTTONS"],INLINE_STYLE_BUTTONS:[{label:a("forms.rte.bold"),style:"BOLD"},{label:a("forms.rte.italic"),style:"ITALIC"}],BLOCK_TYPE_DROPDOWN:[{label:a("forms.rte.normal"),style:"unstyled",className:"normal_text"},{label:a("forms.rte.header1"),style:"header-one"},{label:a("forms.rte.header2"),style:"header-two"},{label:a("forms.rte.header3"),style:"header-three"}],BLOCK_TYPE_BUTTONS:[{label:a("forms.rte.ul"),style:"unordered-list-item"},{label:a("forms.rte.ol"),style:"ordered-list-item"}]},toolbarClassName:"rte-editor-toolbar"})})},Ct=t(92299);var Tt=function(e){var n,t=e.onChange,r=e.fieldName,i=e.options,l=e.disabled,a=(0,y.$G)().t,o=ae().state.elementInSettings,s=i.map((function(e){return{key:e,value:e,text:a("forms.settings.select_options.".concat(e))}}));return(0,B.jsx)(Ct.Z,{options:s,name:r,disabled:l,value:String((null===o||void 0===o||null===(n=o.settings)||void 0===n?void 0:n[r])||Ge.HORIZONTAL),onChange:function(e,n){return t(n.name,n.value)}})};var _t=function(e){var n,t=e.onChange,r=e.fieldName,i=e.disabled,l=ae().state.elementInSettings;return(0,B.jsx)(Je.Z,{type:"text",name:r,id:r,disabled:i,onChange:function(e,n){t(n.name,n.value)},value:(null===l||void 0===l||null===(n=l.settings)||void 0===n?void 0:n[r])||""})};var Dt,wt=function(e){var n,t,r,i=e.settingsField,l=(0,y.$G)().t,a=q().readonly,o=ae(),s=o.state,u=s.elementInSettings,c=s.library,m=o.dispatch,f=(0,d.useQuery)(bt.y,{variables:{id:String(null===(n=u.settings)||void 0===n?void 0:n.attribute)}}),p=f.loading,b=f.error,Z=f.data;if(p)return(0,B.jsx)(v.Z,{});if(b)return(0,B.jsx)("div",{className:"error",children:b.message});var h,x=null===Z||void 0===Z||null===(t=Z.attributes)||void 0===t||null===(r=t.list)||void 0===r?void 0:r[0];if(i.inputType===He.NONE)return null;var g=(0,H.Z)({onChange:function(e,n){m({type:xe.SAVE_SETTINGS,settings:(0,G.Z)({},e,n)})},disabled:a,fieldName:i.name},i.getInputSettings?i.getInputSettings(x):null);switch(i.inputType){case He.ATTRIBUTE_SELECTION:h=(0,B.jsx)(ht,(0,H.Z)((0,H.Z)({},g),{},{library:c}));break;case He.ATTRIBUTE_SELECTION_MULTIPLE:h=(0,B.jsx)(ht,(0,H.Z)({},g));break;case He.CHECKBOX:h=(0,B.jsx)(yt,(0,H.Z)({},g));break;case He.RTE:h=(0,B.jsx)(It,(0,H.Z)({},g));break;case He.SELECT:h=(0,B.jsx)(Tt,(0,H.Z)({},g));break;default:h=(0,B.jsx)(_t,(0,H.Z)({},g))}return(0,B.jsxs)(pt.Z.Field,{children:[(0,B.jsx)("label",{children:l("forms.settings.".concat(i.name))}),h]},i.name)},Nt=_.ZP.div(Dt||(Dt=(0,b.Z)(["\n    padding: 1.5em;\n    min-height: calc(100vh - 24rem);\n"])));var St=function(){var e,n=ae(),t=n.state,r=t.elementInSettings,i=t.openSettings,l=(t.library,n.dispatch),a=(0,y.$G)().t,o=(0,u.useCallback)((function(){return l({type:xe.CLOSE_SETTINGS})}),[l]);return(0,B.jsxs)(K.Z,{open:i,onClose:o,closeOnDimmerClick:!0,closeOnEscape:!0,closeIcon:!0,dimmer:!0,size:"large",className:"scrolling",children:[(0,B.jsxs)(K.Z.Header,{children:[(0,B.jsx)(O.Z,{name:"settings"})," ",a("admin.settings")]}),(0,B.jsx)(K.Z.Content,{scrolling:!0,children:r&&(0,B.jsx)(Nt,{children:(0,B.jsx)(pt.Z,{name:"settings-edition",children:((null===(e=r.uiElement)||void 0===e?void 0:e.settings)||[]).map((function(e){return(0,B.jsx)(wt,{settingsField:e},e.name)}))})})}),(0,B.jsx)(K.Z.Actions,{children:(0,B.jsxs)(T.Z,{className:"close-button",onClick:o,children:[(0,B.jsx)(O.Z,{name:"close"})," ",a("admin.close")]})})]})},kt=St;var Ot=function(){var e=ae(),n=e.state,t=e.dispatch,r={id:Ee,order:0,containerId:Ee,type:Ye.LH.layout,uiElement:tt[Ve.FIELDS_CONTAINER]};return(0,B.jsxs)(ft.Z.Pushable,{children:[(0,B.jsx)(r.uiElement.component.type,{elementData:r,state:n,dispatch:t}),(0,B.jsx)(kt,{})]})};var At,Rt=function(){var e,n=(0,y.$G)().t,t=(0,W.Z)().addMessage,r=q(),i=r.form,l=r.library,a=r.readonly,o=(0,u.useReducer)(Te,function(e,n){for(var t=n.elements.reduce((function(e,n){var t=n.elements.reduce((function(e,n){var t=n.containerId||Ee,r=n.uiElementType,i=(0,mt.Z)(n,vt),l=n.type===Ye.LH.layout?tt[r]:rt[r],a=(0,H.Z)((0,H.Z)({},i),{},{uiElement:l,settings:n.settings.reduce((function(e,n){var t=n.value;return"columns"===n.key&&(t=t.map((function(e){return"object"===typeof e&&"undefined"!==typeof e.id?e.id:e}))),(0,H.Z)((0,H.Z)({},e),{},(0,G.Z)({},n.key,t))}),{})});return"undefined"===typeof e[t]&&(e[t]=[]),e[t].push(a),e}),{});if(!n.dependencyValue)return e[ye][ge]=t,e;var r=n.dependencyValue.attribute;"undefined"===typeof e[r]&&(e[r]={});var i=de({id:n.dependencyValue.value.id||"",library:{id:n.dependencyValue.value.library||"",label:null},label:"",color:"",preview:null});return e[r][i]=t,e}),(0,G.Z)({},ye,(0,G.Z)({},ge,{}))),r=(0,H.Z)({},t[ye][ge]),i=0,l=Object.keys(r);i<l.length;i++){var a=l[i];r[a]=r[a].map((function(e){return(0,H.Z)((0,H.Z)({},e),{},{herited:!1})})).sort(ve)}return{form:n,library:e,activeDependency:null,openSettings:!1,elementInSettings:null,elements:t,activeElements:r}}(l,i)),s=(0,p.Z)(o,2),c=s[0],m=s[1],v=(0,u.useState)(!1),b=(0,p.Z)(v,2),Z=b[0],x=b[1],g=te(),E=g.setButton,j=g.removeButton,I=(0,d.useMutation)(ee,{onCompleted:function(){return x(!1)},onError:function(){return x(!1)}}),_=(0,p.Z)(I,1)[0],D=(0,u.useCallback)((0,f.Z)(h().mark((function e(){var r;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=2;break}return e.abrupt("return");case 2:return x(!0),r=Object.keys(c.elements).reduce((function(e,n){var t=Object.keys(c.elements[n]).reduce((function(e,t){var r={elements:Object.values(c.elements[n][t]).flat().map((function(e){return{id:e.id,containerId:e.containerId,order:e.order,uiElementType:e.uiElement.type,type:e.type,settings:Object.entries(e.settings||{}).reduce((function(e,n){var t=(0,p.Z)(n,2),r=t[0],i=t[1];return"undefined"!==typeof i&&e.push({key:r,value:i}),e}),[])}}))};if(n!==ye&&t!==ge){var i=t.split("/"),l=(0,p.Z)(i,2),a={library:l[0],id:l[1]};r.dependencyValue={attribute:n,value:a}}return[].concat((0,S.Z)(e),[r])}),[]);return[].concat((0,S.Z)(e),(0,S.Z)(t))}),[]),e.next=6,_({variables:{formData:{id:i.id,library:l,elements:r}}});case 6:t({type:J.Q7.SUCCESS,content:n("forms.save_success")}),x(!1);case 8:case"end":return e.stop()}}),e)}))),[c]);return(0,u.useEffect)((function(){if(!a){var e="saveContent";return E(e,(0,B.jsxs)(T.Z,{loading:Z,primary:!0,icon:!0,labelPosition:"left",onClick:D,children:[(0,B.jsx)(O.Z,{name:"save"}),n("admin.save")]},e)),function(){j(e)}}}),[Z,D]),(0,B.jsx)(le.Provider,{value:{state:c,dispatch:m},children:(0,B.jsxs)(C.Z,{columns:2,stackable:!0,verticalAlign:"top",children:[(null===(e=c.activeDependency)||void 0===e?void 0:e.attribute)&&(0,B.jsx)(C.Z.Row,{stretched:!0,children:(0,B.jsx)(Pe,{})}),(0,B.jsxs)(C.Z.Row,{stretched:!0,children:[(0,B.jsxs)(C.Z.Column,{width:4,className:"elements",children:[(0,B.jsx)($e,{}),(0,B.jsx)(ct,{})]}),(0,B.jsx)(C.Z.Column,{className:"layout",width:12,children:(0,B.jsx)(Ot,{})})]})]})})},Pt=t(91492),Lt=t(43248);(0,_.ZP)(pt.Z.Group)(At||(At=(0,b.Z)(["\n    margin-top: 10px;\n"])));var Bt=function(e){var n=e.onSubmit,t=(0,c.Z)(),r=t.defaultLang,i=t.availableLangs,l=q(),a=l.form,o=l.library,s=l.readonly,d=te(),m=d.setButton,v=d.removeButton,b=(0,u.useRef)(),Z=null!==a,x=(0,y.$G)().t,g=(0,u.useState)({id:"",system:!1,label:null,dependencyAttributes:[]}),E=(0,p.Z)(g,2),j=E[0],I=E[1];return(0,u.useEffect)((function(){if(!s&&!Z){var e="saveForm";return m(e,(0,B.jsxs)(T.Z,{type:"submit",primary:!0,icon:!0,labelPosition:"left",onClick:b.current,children:[(0,B.jsx)(O.Z,{name:"save"}),x("admin.submit")]},e)),function(){return v(e)}}}),[s,Z,o,a]),(0,u.useEffect)((function(){a&&I((0,H.Z)((0,H.Z)({},(0,X.ei)(a,["id","system","label"])),{},{dependencyAttributes:(0,X.PT)((null===a||void 0===a?void 0:a.dependencyAttributes)||[],"id")}))}),[a]),(0,B.jsx)(Pt.J9,{initialValues:j,onSubmit:function(e){var t,r=(0,H.Z)((0,H.Z)({},(0,X.CE)(e,["system"])),{},{label:null!==(t=null===e||void 0===e?void 0:e.label)&&void 0!==t?t:null,library:o});return n(r)},render:function(e){var n=e.handleSubmit,t=e.handleBlur,l=e.setFieldValue,a=e.submitForm,o=e.errors,d=e.values,u=e.touched;b.current=n;var c=function(e,n){m(e,n);var t=n.name,i=n.value,a=t.split("."),o=(0,p.Z)(a,2),s=o[0],d=o[1];Z||"label"!==s||d!==r||l("id",(0,X.GV)(i))},m=function(e,n){var t="checkbox"===n.type?n.checked:n.value,r=n.name;l(r,t)},v=function(){var e=(0,f.Z)(h().mark((function e(n,t){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m(n,t);case 2:Z&&a();case 3:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),y=function(e){Z?a():t(e)},g=function(e){"Enter"===e.key&&a()},E=d.id,j=d.label,I=d.dependencyAttributes,C=function(e){return(0,X.zQ)(e,u,{},o)};return(0,B.jsxs)(pt.Z,{onSubmit:n,children:[(0,B.jsxs)(pt.Z.Group,{grouped:!0,children:[(0,B.jsx)("label",{children:x("libraries.label")}),i.map((function(e){return(0,B.jsx)(Lt.Z,{error:C("label.".concat(e)),children:(0,B.jsx)(pt.Z.Input,{label:"".concat(e," ").concat(e===r?"*":""),name:"label."+e,"aria-label":"label."+e,disabled:s,value:(null===j||void 0===j?void 0:j[e])||"",onChange:c,onBlur:y,onKeyPress:g})},e)}))]}),(0,B.jsx)(Lt.Z,{error:C("id"),children:(0,B.jsx)(pt.Z.Input,{label:x("attributes.ID"),disabled:Z||s,name:"id","aria-label":"id",onChange:m,onBlur:y,value:E})}),(0,B.jsx)(Lt.Z,{error:C("dependencyAttributes"),children:(0,B.jsx)(Zt.Z,{label:x("forms.dependency_attributes"),filters:{type:[Ye.GC.tree]},multiple:!0,name:"dependencyAttributes",value:I,onChange:v,disabled:s})})]})},enableReinitialize:!0})},Vt=Bt;var Mt=function(){var e=q(),n=e.form,t=e.library,r=(e.readonly,e.setForm),i=(0,d.useMutation)(ee,{onError:function(e){},onCompleted:function(e){null!==a&&void 0!==a&&a.replace&&a.replace({pathname:o,hash:"forms",search:"fid=".concat(e.saveForm.id)})},update:function(e){n||(0,X.Ku)(e,"forms",{filters:{library:t}})}}),l=(0,p.Z)(i,1)[0],a=(0,E.k6)(),o=(0,E.TH)().pathname,s=function(){var e=(0,f.Z)(h().mark((function e(n){var i;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l({variables:{formData:(0,H.Z)((0,H.Z)({},n),{},{id:n.id,library:t})}});case 2:i=e.sent,r(i.data.saveForm);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,B.jsx)(Vt,{onSubmit:s})},Ft=Mt;var Gt=function(){var e,n=(0,y.$G)().t,t=(0,c.Z)().lang,r=q().form,i=null===r?n("forms.new"):(0,X.dX)(null!==(e=null===r||void 0===r?void 0:r.label)&&void 0!==e?e:null,t),l=[{key:"infos",mustBeDisplayed:!0,menuItem:n("forms.informations"),render:function(){return(0,B.jsx)(Ft,{})}},{key:"content",mustBeDisplayed:!!r,menuItem:n("forms.content"),render:function(){return(0,B.jsx)(Rt,{})}}].filter((function(e){return e.mustBeDisplayed}));return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(j.Z,{className:"no-grow","data-testid":"header",children:i}),(0,B.jsx)(I.Z,{menu:{secondary:!0,pointing:!0},panes:l,className:"grow flex-col height100",renderActiveOnly:!0})]})};var Ht=function(e){var n,t=e.formId,r=e.libraryId,i=e.readonly,l=(0,u.useState)(null),a=(0,p.Z)(l,2),o=a[0],s=a[1],c=(0,d.useQuery)(z,{variables:{library:r,id:t||""},fetchPolicy:"no-cache",skip:!t}),m=c.loading,f=c.error,b=c.data;return(0,u.useEffect)((function(){var e,n,t,r;null!==b&&void 0!==b&&null!==(e=b.forms)&&void 0!==e&&null!==(n=e.list)&&void 0!==n&&n[0]&&s(null===b||void 0===b||null===(t=b.forms)||void 0===t||null===(r=t.list)||void 0===r?void 0:r[0])}),[b]),m?(0,B.jsx)(v.Z,{}):f?(0,B.jsxs)("div",{"data-test-id":"error",children:["ERROR ",f.message]}):!t||b&&null!==b&&void 0!==b&&null!==(n=b.forms)&&void 0!==n&&n.list.length?(0,B.jsx)(Q.Provider,{value:{form:o,library:r,readonly:i,setForm:s},children:(0,B.jsx)(Gt,{})}):(0,B.jsx)("div",{children:"Cannot retrieve form"})};var $t=function(e){var n=e.open,t=e.onClose,r=e.formId,i=e.libraryId,l=e.readonly,a=(0,y.$G)().t,o=(0,u.useState)({}),s=(0,p.Z)(o,2),d=s[0],c=s[1];return(0,B.jsx)(ne.Provider,{value:{buttons:d,setButton:function(e,n){c((0,H.Z)((0,H.Z)({},d),{},(0,G.Z)({},e,n)))},removeButton:function(e){var n=Object.keys(d).reduce((function(n,t){return t!==e&&(n[t]=d[t]),n}),{});c(n)}},children:(0,B.jsxs)(K.Z,{open:n,size:"fullscreen",centered:!0,closeOnDimmerClick:!0,closeOnEscape:!0,closeIcon:!0,dimmer:!0,className:"overlay",onClose:t,children:[(0,B.jsx)(K.Z.Content,{scrolling:!0,children:(0,B.jsx)(Ht,{formId:r,libraryId:i,readonly:l})}),(0,B.jsxs)(K.Z.Actions,{children:[(0,B.jsxs)(T.Z,{className:"close-button",onClick:t,children:[(0,B.jsx)(O.Z,{name:"cancel"})," ",a("admin.close")]}),Object.values(d)]})]})})},Ut=t(26637),Xt=t(52788);var Kt=function(e){var n=e.loading,t=e.forms,r=e.filters,i=void 0===r?{}:r,l=e.onFiltersChange,a=e.onCreate,o=e.onRowClick,s=e.onDelete,d=(0,c.Z)().lang,u=(0,y.$G)().t,m=((0,Ut.Z)().permissions,function(e,n){"checkbox"===n.type&&!1===i.system&&n.checked&&(n.indeterminate=!0,n.checked=!1),l&&l(n)}),f=function(e){return function(){return s(e)}};return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(C.Z,{children:(0,B.jsx)(C.Z.Column,{floated:"right",width:4,textAlign:"right",verticalAlign:"middle",children:(0,B.jsxs)(T.Z,{icon:!0,labelPosition:"left",size:"medium",onClick:a,"data-test-id":"create-form-btn",children:[(0,B.jsx)(O.Z,{name:"plus"}),u("forms.new")]})})}),(0,B.jsxs)(un.Z,{selectable:!0,striped:!0,children:[(0,B.jsxs)(un.Z.Header,{children:[(0,B.jsxs)(un.Z.Row,{children:[(0,B.jsx)(un.Z.HeaderCell,{width:7,children:u("admin.label")}),(0,B.jsx)(un.Z.HeaderCell,{width:7,children:u("admin.id")}),(0,B.jsx)(un.Z.HeaderCell,{width:1,children:u("admin.isSystem")}),(0,B.jsx)(un.Z.HeaderCell,{width:1})]},"titles"),(0,B.jsxs)(un.Z.Row,{className:"filters",children:[(0,B.jsx)(un.Z.HeaderCell,{children:(0,B.jsx)(Je.Z,{size:"small",fluid:!0,placeholder:u("admin.label")+"...",name:"label",value:i.label||"",onChange:m},"label")},"label"),(0,B.jsx)(un.Z.HeaderCell,{children:(0,B.jsx)(Je.Z,{size:"small",fluid:!0,placeholder:u("admin.id")+"...",name:"id",value:i.id||"",onChange:m},"id")},"id"),(0,B.jsx)(un.Z.HeaderCell,{children:(0,B.jsx)(ze.Z,{indeterminate:"undefined"===typeof i.system,name:"system",checked:i.system,onChange:m},"system")},"system"),(0,B.jsx)(un.Z.HeaderCell,{})]},"filters")]}),(0,B.jsx)(un.Z.Body,{children:n?(0,B.jsx)(un.Z.Row,{children:(0,B.jsx)(un.Z.Cell,{colSpan:6,children:(0,B.jsx)(v.Z,{})})}):t.map((function(e){var n,t=(0,X.dX)(e.label,d);return(0,B.jsxs)(un.Z.Row,{"data-test-id":"form-list-row",onClick:(n=e.id,function(){return o(n)}),children:[(0,B.jsx)(un.Z.Cell,{children:t}),(0,B.jsx)(un.Z.Cell,{children:e.id}),(0,B.jsx)(un.Z.Cell,{width:1,children:(0,B.jsx)(ze.Z,{readOnly:!0,checked:e.system})}),(0,B.jsx)(un.Z.Cell,{children:(0,B.jsx)(L.Z,{action:f(e.id),confirmMessage:u("forms.confirm_delete",{formLabel:t}),children:(0,B.jsx)(Xt.Z,{disabled:e.system})})})]},e.id)}))})]})]})};var Yt,zt,Qt=function(e){var n,t,r=e.libraryId,i=e.readonly,l=(0,u.useState)({}),a=(0,p.Z)(l,2),o=a[0],s=a[1],c=(0,d.useQuery)(U,{variables:(0,H.Z)((0,H.Z)({},(0,X.Rw)(o)),{},{library:r})}),m=c.loading,v=c.error,f=c.data,b=(0,d.useMutation)($),Z=(0,p.Z)(b,1)[0],h=(0,u.useState)(null),x=(0,p.Z)(h,2),y=x[0],g=x[1],E=(0,u.useState)(!1),j=(0,p.Z)(E,2),I=j[0],C=j[1];return v?(0,B.jsxs)("div",{className:"error",children:["Error ",v.message]}):m||null!==f&&void 0!==f&&null!==(n=f.forms)&&void 0!==n&&n.list?(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(Kt,{loading:m,libraryId:r,forms:(null===f||void 0===f||null===(t=f.forms)||void 0===t?void 0:t.list)||[],filters:o,onFiltersChange:function(e){var n="checkbox"===e.type?e.indeterminate?void 0:e.checked:e.value,t=(0,H.Z)((0,H.Z)({},o),{},(0,G.Z)({},e.name,n));s(t)},onCreate:function(){g(null),C(!0)},onRowClick:function(e){g(e),C(!0)},onDelete:function(e){return Z({variables:{formId:e,library:r},update:function(e,n){var t,i,l,a=n.data.deleteForm,o=e.readQuery({query:U,variables:{library:r}});(0,X.Ku)(e,"forms",{filters:{library:r}});var s={forms:{list:(0,S.Z)((null===o||void 0===o||null===(t=o.forms)||void 0===t?void 0:t.list)||[]).filter((function(e){return e.id!==a.id})),totalCount:null!==o&&void 0!==o&&null!==(i=o.forms)&&void 0!==i&&i.totalCount?(null===o||void 0===o||null===(l=o.forms)||void 0===l?void 0:l.totalCount)-1:0,__typename:"FormsList"}};e.writeQuery({query:U,variables:{library:r},data:s})}})}}),I&&(0,B.jsx)($t,{formId:y,open:I,libraryId:r,onClose:function(){C(!1)},readonly:i})]}):(0,B.jsx)("div",{children:"Could not retrieve forms"})},qt=t(39359),Wt=w()(Yt||(Yt=(0,b.Z)(["\n    ","\n    mutation SAVE_LIBRARY($libData: LibraryInput!, $lang: [AvailableLanguage!]) {\n        saveLibrary(library: $libData) {\n            ...LibraryDetails\n        }\n    }\n"])),qt.o),Jt=t(36770),er=t(61247),nr=t(9983),tr=w()(zt||(zt=(0,b.Z)(["\n    query GET_VIEWS($library: String!) {\n        views(library: $library) {\n            list {\n                id\n                label\n            }\n        }\n    }\n"]))),rr=["views"];var ir=function(e){var n=e.views,t=void 0===n?[]:n,r=(0,mt.Z)(e,rr),i=(0,c.Z)().lang,l=t.map((function(e){return{key:e.id,value:e.id,text:(0,X.dX)(e.label,i)}}));return l.unshift({key:"",value:"",text:""}),(0,B.jsx)(pt.Z.Dropdown,(0,H.Z)((0,H.Z)({},r),{},{search:!0,options:l}))},lr=["library"];var ar,or=function(e){var n,t,r=e.library,i=(0,mt.Z)(e,lr),l=(0,d.useQuery)(tr,{variables:{library:r}}),a=l.loading,o=l.error,s=l.data;if(a)return(0,B.jsx)(v.Z,{});if(o)return(0,B.jsxs)("div",{"data-test-id":"error",children:["Error ",o.message]});var u=null!==(n=null===s||void 0===s||null===(t=s.views)||void 0===t?void 0:t.list)&&void 0!==n?n:[];return(0,B.jsx)(ir,(0,H.Z)({views:u},i))},sr=(0,_.ZP)(pt.Z.Group)(ar||(ar=(0,b.Z)(["\n    margin-top: 10px;\n"]))),dr=function(e){var n,t,r=e.library,i=e.onSubmit,l=e.readonly,a=e.errors,o=e.onCheckIdExists,s=(0,y.$G)().t,d=(0,c.Z)(),u=d.defaultLang,m=d.availableLangs,v=d.lang,b=null!==r,Z={id:"",system:!1,label:{fr:"",en:""},icon:null,behavior:Ye.mU.standard,attributes:[],permissions_conf:null,defaultView:null,fullTextAttributes:[],recordIdentityConf:{label:null,color:null,preview:null,treeColorPreview:null},permissions:{admin_library:!0,access_library:!0,access_record:!0,create_record:!0,edit_record:!0,delete_record:!0}},x=null===r?Z:(0,H.Z)((0,H.Z)({},r),{},{defaultView:null!==(n=null===r||void 0===r||null===(t=r.defaultView)||void 0===t?void 0:t.id)&&void 0!==n?n:null,fullTextAttributes:null!==r&&void 0!==r&&r.fullTextAttributes?r.fullTextAttributes.map((function(e){return e.id})):[]}),g=x.attributes?x.attributes.map((function(e){return{key:e.id,value:e.id,text:(0,X.dX)(e.label,v)||e.id}})):[],E=null!==r&&void 0!==r&&r.attributes?r.attributes.filter((function(e){return e.type===Ye.GC.tree})).map((function(e){return{key:e.id,value:e.id,text:(0,X.dX)(e.label,v)||e.id}})):[];g.unshift({key:"",value:"",text:""});var j=a&&a.extensions.code===nr.Z.VALIDATION_ERROR?a.extensions.fields:{},I=er.Z_().required().matches(/^[a-z0-9_]+$/);b||(I=I.test("isIdUnique",s("admin.validation_errors.id_exists"),o));var C=er.Ry().shape({label:er.Ry().shape((0,G.Z)({},u||v[0],er.Z_().required())),id:I,recordIdentityConf:er.Ry().shape({label:er.Z_().nullable(),color:er.Z_().nullable(),preview:er.Z_().nullable(),treeColorPreview:er.Z_().nullable()}).nullable()});return(0,B.jsx)(Pt.J9,{initialValues:x,onSubmit:function(e){i(e)},render:function(e){var n,t,i=e.handleSubmit,a=e.handleBlur,o=e.setFieldValue,d=e.errors,c=e.values,v=e.touched,Z=e.submitForm,x=(e.isValid,e.isValidating,e.isSubmitting,function(e,n){y(e,n);var t=n.name,r=n.value,i=t.split("."),l=(0,p.Z)(i,2),a=l[0],s=l[1];b||"label"!==a||s!==u||o("id",(0,X.GV)(r))}),y=function(){var e=(0,f.Z)(h().mark((function e(n,t){var r,i;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="checkbox"===t.type?t.checked:t.value,i=t.name,e.next=4,o(i,r);case 4:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),I=function(){var e=(0,f.Z)(h().mark((function e(n,t){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y(n,t);case 2:b&&Z();case 3:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),C=function(e){b?Z():a(e)},T=function(e){"Enter"===e.key&&Z()},_=function(){var e=(0,f.Z)(h().mark((function e(n){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:I(null,{name:"icon",value:{whoAmI:n}});case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),D=c.id,w=c.label,N=c.behavior,S=c.recordIdentityConf,k=c.defaultView,A=c.fullTextAttributes,R=function(e){return(0,X.zQ)(e,v,j||{},d)},P=Object.values(Ye.mU).map((function(e){return{key:e,value:e,text:s("libraries.behavior_".concat(e))}}));return(0,B.jsxs)(pt.Z,{onSubmit:function(){return i()},children:[(0,B.jsxs)(pt.Z.Group,{grouped:!0,children:[(0,B.jsx)("label",{children:s("libraries.label")}),m.map((function(e){var n;return(0,B.jsx)(Lt.Z,{error:R("label.".concat(e)),children:(0,B.jsx)(pt.Z.Input,{label:"".concat(e," ").concat(e===u?"*":""),name:"label."+e,"aria-label":"label."+e,disabled:l,value:null!==(n=null===w||void 0===w?void 0:w[e])&&void 0!==n?n:"",onChange:x,onBlur:C,onKeyPress:T})},e)}))]}),(0,B.jsx)(Lt.Z,{error:R("id"),children:(0,B.jsx)(pt.Z.Input,{label:s("attributes.ID"),disabled:b||l,name:"id","aria-label":"id",onChange:y,onBlur:C,value:D})}),(0,B.jsx)(Lt.Z,{error:R("behavior"),children:(0,B.jsx)(pt.Z.Select,{label:s("libraries.behavior"),disabled:b||l,name:"behavior","aria-label":"behavior",onChange:I,onBlur:C,value:N,options:P})}),(0,B.jsx)(Lt.Z,{error:R("libraries.fulltext_attributes"),children:(0,B.jsx)(pt.Z.Dropdown,{search:!0,selection:!0,multiple:!0,options:g,name:"fullTextAttributes","aria-label":"fullTextAttributes",disabled:!b||l,label:s("libraries.fulltext_attributes"),value:A,onChange:I,onBlur:C})}),b&&(0,B.jsx)(Lt.Z,{error:R("defaultView"),children:(0,B.jsx)(or,{search:!0,selection:!0,label:s("libraries.default_view"),disabled:l,name:"defaultView","aria-label":"defaultView",value:null!==k&&void 0!==k?k:"",library:r.id,onChange:I,onBlur:a})}),(0,B.jsxs)(pt.Z.Group,{grouped:!0,children:[(0,B.jsx)("label",{children:s("libraries.record_identity")}),(0,B.jsx)(Lt.Z,{error:R("recordIdentityConf.label"),children:(0,B.jsx)(pt.Z.Dropdown,{search:!0,selection:!0,options:g,name:"recordIdentityConf.label",disabled:l,label:s("libraries.record_identity_label"),value:S&&S.label?S.label:"",onChange:I})}),(0,B.jsx)(Lt.Z,{error:R("recordIdentityConf.color"),children:(0,B.jsx)(pt.Z.Dropdown,{search:!0,selection:!0,options:g,name:"recordIdentityConf.color",disabled:l,label:s("libraries.record_identity_color"),value:S&&S.color?S.color:"",onChange:I})}),(0,B.jsx)(Lt.Z,{error:R("recordIdentityConf.preview"),children:(0,B.jsx)(pt.Z.Dropdown,{search:!0,selection:!0,options:g,name:"recordIdentityConf.preview",disabled:l,label:s("libraries.record_identity_preview"),value:S&&S.preview?S.preview:"",onChange:I})}),(0,B.jsx)(Lt.Z,{error:R("recordIdentityConf.preview"),children:(0,B.jsx)(pt.Z.Dropdown,{search:!0,selection:!0,options:E,name:"recordIdentityConf.treeColorPreview",disabled:l,label:s("libraries.record_identity_dependent_color_and_preview"),value:S&&S.treeColorPreview?S.treeColorPreview:"",onChange:I})})]}),(0,B.jsx)(Lt.Z,{error:R("icon.whoAmI"),children:(0,B.jsx)(Jt.Z,{onChange:_,value:null!==(n=null===(t=c.icon)||void 0===t?void 0:t.whoAmI)&&void 0!==n?n:null,label:s("applications.icon")})}),!l&&!b&&(0,B.jsx)(sr,{children:(0,B.jsxs)(pt.Z.Button,{icon:!0,primary:!0,type:"submit",labelPosition:"left",children:[(0,B.jsx)(O.Z,{name:"save"}),s("admin.submit")]})})]})},validationSchema:C})},ur=dr;var cr,mr=function(e){var n,t=e.library,r=e.readonly,i=(0,E.k6)(),l=!t,a=(0,d.useMutation)(Wt,{onError:function(){},update:function(e){l&&(0,X.Ku)(e,"libraries")}}),o=(0,p.Z)(a,2),s=o[0],u=o[1].error,c=(0,d.useLazyQuery)(m.w,{fetchPolicy:"no-cache"}),v=(0,p.Z)(c,2),b=v[0],Z=v[1].data,x=function(){var e=(0,f.Z)(h().mark((function e(n){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b({variables:{id:n}});case 2:return e.abrupt("return",!!Z&&!!Z.libraries&&!Z.libraries.list.length);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),y=function(){var e=(0,f.Z)(h().mark((function e(n){var t,r;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={id:n.id,label:{fr:n.label.fr,en:n.label.en},icon:null!==(t=n.icon)&&void 0!==t&&t.whoAmI?{libraryId:n.icon.whoAmI.library.id,recordId:n.icon.whoAmI.id}:null,behavior:n.behavior,defaultView:n.defaultView||null,fullTextAttributes:n.fullTextAttributes,recordIdentityConf:null!==n.recordIdentityConf?{label:n.recordIdentityConf.label,preview:n.recordIdentityConf.preview,color:n.recordIdentityConf.color,treeColorPreview:n.recordIdentityConf.treeColorPreview}:null},e.next=3,s({variables:{libData:r}});case 3:l&&i.replace({pathname:"/libraries/edit/"+n.id});case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),g=null!==u&&void 0!==u&&null!==(n=u.graphQLErrors)&&void 0!==n&&n.length?u.graphQLErrors[0]:null;return(0,B.jsx)(ur,{library:t,onSubmit:y,readonly:r,errors:g,onCheckIdExists:x})},vr=mr,fr=t(68648),pr=t(90930),br=t(10290),Zr=(0,_.ZP)(fr.Z)(cr||(cr=(0,b.Z)(["\n    position: absolute;\n    top: 2rem;\n    right: 2rem;\n"])));var hr=function(e){var n=e.library,t=e.onSubmitSettings,r=e.readonly,i=(0,y.$G)().t,l=(0,c.Z)().lang,a={permissionTreeAttributes:[],relation:Ye.sl.and},o={library:[Ye.Au.admin_library,Ye.Au.access_library],entities:[Ye.Au.access_record,Ye.Au.create_record,Ye.Au.edit_record,Ye.Au.delete_record]},s=(n.permissions_conf||a).permissionTreeAttributes.map((function(e){return{key:e.id,menuItem:(0,X.dX)(e.label,l),render:function(){return(0,B.jsx)(I.Z.Pane,{className:"grow flex-col height100",children:e.linked_tree?(0,B.jsx)(br.Z,{treeAttribute:e,permissionType:Ye.r3.record,applyTo:n.id,readOnly:r},e.id):(0,B.jsx)("p",{children:"Missing tree ID"})},e.id)}}}));return s.unshift({key:"libPermissions",menuItem:i("permissions.default"),render:function(){return(0,B.jsx)(I.Z.Pane,{className:"grow flex-col height100",children:(0,B.jsx)(pr.Z,{type:Ye.r3.library,actions:o,applyTo:n.id,readOnly:r},"libPermissions")},"libPermissions")}}),(0,B.jsxs)("div",{className:"flex-col height100",children:[(0,B.jsx)(Zr,{permissionsSettings:n.permissions_conf,onChangeSettings:function(e){t(e)},library:n,readonly:r}),(0,B.jsx)(I.Z,{panes:s,className:"grow flex-col height100"})]})};var xr,yr,gr,Er=function(e){var n=e.library,t=e.readonly,r=(0,d.useMutation)(Wt),i=(0,p.Z)(r,1)[0];return(0,B.jsx)(hr,{library:n,readonly:t,onSubmitSettings:function(e){return i({variables:{libData:{id:n.id,permissions_conf:e}}})}})},jr=t(43157),Ir=w()(xr||(xr=(0,b.Z)(["\n    mutation PURGE_RECORDS($libraryId: String!) {\n        purgeInactiveRecords(libraryId: $libraryId) {\n            id\n        }\n    }\n"]))),Cr=t(2745),Tr=t(5918),_r=_.ZP.div(yr||(yr=(0,b.Z)(["\n    margin: 1rem 0;\n"]))),Dr=_.ZP.div(gr||(gr=(0,b.Z)(["\n    padding: 1.5rem;\n    text-align: center;\n\n    .warning {\n        white-space: pre-line;\n        margin-bottom: 1rem;\n        color: #9f3a38;\n        font-weight: bold;\n        line-height: 1.2em;\n        font-size: 1.2em;\n    }\n"])));var wr,Nr=function(e){var n,t,r=e.library,i=e.readonly,l=(0,y.$G)().t,a=(0,d.useQuery)((0,Cr.gy)(r.gqlNames.query),{variables:{pagination:{limit:1,offset:0},filters:[{field:"active",condition:Cr.Hq.EQUAL,value:"false"}]}}),o=a.loading,s=a.error,c=a.data,m=a.refetch,b=(0,d.useMutation)(Ir,{variables:{libraryId:r.id}}),Z=(0,p.Z)(b,2),x=Z[0],g=Z[1],E=g.loading,j=g.error,I=u.useState(!1),C=(0,p.Z)(I,2),_=C[0],D=C[1],w=function(){return D(!1)},N=function(){var e=(0,f.Z)(h().mark((function e(){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,w(),e.next=4,x();case 4:m(),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();if(o||E)return(0,B.jsx)(v.Z,{});if(s||j)return(0,B.jsx)(jr.Z,{message:(null===s||void 0===s?void 0:s.message)||(null===j||void 0===j?void 0:j.message)});var S=null!==(n=null===c||void 0===c||null===(t=c[r.gqlNames.query])||void 0===t?void 0:t.totalCount)&&void 0!==n?n:0,k=(0,B.jsxs)(Dr,{children:[(0,B.jsx)("div",{className:"warning",children:l("libraries.purge.warning",{interpolation:!1})}),(0,B.jsx)("div",{children:l("libraries.purge.confirm")})]});return(0,B.jsxs)("div",{children:[(0,B.jsx)(_r,{children:l("libraries.purge.summary",{count:S})}),!!S&&!i&&(0,B.jsxs)(T.Z,{primary:!0,onClick:function(){return D(!0)},icon:!0,labelPosition:"left",children:[(0,B.jsx)(O.Z,{name:"trash alternate outline"}),l("libraries.purge.launch_button")]}),_&&(0,B.jsx)(Tr.Z,{open:_,onCancel:w,onConfirm:N,content:k,cancelButton:l("admin.cancel"),confirmButton:l("admin.submit")})]})},Sr=Nr,kr=(0,_.ZP)(j.Z)(wr||(wr=(0,b.Z)(["\n    display: flex;\n    align-items: center;\n"])));kr.displayName="Title";var Or=function(e){var n,t,r=e.library,i=e.readOnly,l=(0,y.$G)().t,a=(0,E.k6)(),o=(0,E.TH)(),s=null===r,c=(0,d.useMutation)(N),m=(0,p.Z)(c,2),v=m[0],b=m[1].loading,Z=s?l("libraries.new"):(null===(n=r.label)||void 0===n?void 0:n.fr)||(null===(t=r.label)||void 0===t?void 0:t.en)||r.id,j=[{key:"infos",mustBeDisplayed:!0,menuItem:l("libraries.informations"),render:function(){return(0,B.jsx)(I.Z.Pane,{className:"grow",children:(0,B.jsx)(vr,{library:r,readonly:i})},"infos")}},{key:"permissions",mustBeDisplayed:!s,menuItem:l("libraries.permissions"),render:function(){return(0,B.jsx)(I.Z.Pane,{className:"grow flex-col height100",children:(0,B.jsx)(Er,{library:r,readonly:i})},"permissions")}},{key:"attributes",mustBeDisplayed:!s,menuItem:l("libraries.attributes"),render:function(){return(0,B.jsx)(I.Z.Pane,{className:"grow",children:(0,B.jsx)(F,{library:r,readonly:i})},"attributes")}},{key:"forms",mustBeDisplayed:!s,menuItem:l("forms.title"),render:function(){return(0,B.jsx)(I.Z.Pane,{className:"height100",style:{padding:"0",border:"0px none"},children:(0,B.jsx)(Qt,{libraryId:r.id,readonly:i})},"forms")}},{key:"purge",mustBeDisplayed:!s,menuItem:l("libraries.purge.title"),render:function(){return(0,B.jsx)(I.Z.Pane,{className:"height100",style:{padding:"0",border:"0px none"},children:(0,B.jsx)(Sr,{library:r,readonly:i})},"purge")}}].filter((function(e){return e.mustBeDisplayed})),_=o?o.hash.replace("#",""):void 0,D=(0,u.useState)(_?j.findIndex((function(e){return _===e.key})):0),w=(0,p.Z)(D,2),S=w[0],k=w[1],O=function(){var e=(0,f.Z)(h().mark((function e(){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v({variables:{libraryId:r.id}});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsxs)(C.Z,{padded:!0,verticalAlign:"middle",children:[(0,B.jsx)(C.Z.Column,{width:12,children:(0,B.jsxs)(kr,{className:"no-grow",role:"heading","aria-label":"title",children:[(0,B.jsx)(x.Z,{library:r}),Z]})}),!s&&(0,B.jsx)(C.Z.Column,{width:4,textAlign:"right",children:(0,B.jsxs)(T.Z,{primary:!0,disabled:b,onClick:O,loading:b,"aria-label":"index",children:[(0,B.jsx)(g.Ehc,{})," ",l("libraries.index_fulltext_search")]})})]}),(0,B.jsx)(I.Z,{activeIndex:S,onTabChange:function(e,n){n.panes&&void 0!==n.activeIndex&&(k(Number(n.activeIndex.toString())),null===a||void 0===a||a.push("#".concat(n.panes[n.activeIndex].key)))},menu:{secondary:!0,pointing:!0},panes:j,className:"grow flex-col height100"})]})},Ar=Or,Rr=function(e){var n,t,r=e.match.params.id,i=(0,c.Z)().lang,l=(0,d.useQuery)(m.w,{variables:{id:r,lang:i}}),a=l.loading,o=l.error,s=l.data,u=!(null!==s&&void 0!==s&&null!==(n=s.libraries)&&void 0!==n&&null!==(t=n.list[0])&&void 0!==t&&t.permissions.admin_library),f=function(e){return(0,B.jsx)(Ar,{library:e,readOnly:u})};return r?a?(0,B.jsx)(v.Z,{}):"undefined"!==typeof o?(0,B.jsxs)("p",{children:["Error: ",o.message]}):s&&s.libraries&&s.libraries.list.length?f(s.libraries.list[0]):(0,B.jsx)("p",{children:"Unknown library"}):f(null)}},36770:function(e,n,t){t.d(n,{Z:function(){return c}});var r=t(80688),i=t(74790),l=(t(54681),t(70663)),a=t(52987),o=t(43157),s=t(64449),d=t(45871),u=t(57450);var c=function(e){var n,t,c=e.label,m=e.value,v=e.onChange,f=e.disabled,p=(0,l.$G)().t,b=(0,r.useQuery)(i.c,{variables:{behavior:[a.mU.files]}}),Z=b.loading,h=b.error,x=b.data;if(Z)return(0,u.jsx)(s.Z,{});if(h)return(0,u.jsx)(o.Z,{message:h.message});var y=null!==(n=null===x||void 0===x||null===(t=x.libraries)||void 0===t?void 0:t.list)&&void 0!==n?n:[];return y.length?(0,u.jsx)(d.Z,{label:c,value:m,onChange:v,disabled:f,libraries:y.map((function(e){return e.id}))}):(0,u.jsx)(o.Z,{message:p("file_selector.no_files_libraries")})}},76307:function(e,n,t){t.d(n,{Z:function(){return s}});var r=t(56666),i=(t(54681),t(55152)),l=t(52987),a=t(73657),o=t(57450);var s=function(e){var n,t,s,d,u=e.library,c=(n={},(0,r.Z)(n,l.mU.files,"images outline"),(0,r.Z)(n,l.mU.directories,"folder outline"),(0,r.Z)(n,l.mU.standard,"file alternate outline"),n),m=null!==(t=null===u||void 0===u?void 0:u.behavior)&&void 0!==t?t:l.mU.standard;return null!==u&&void 0!==u&&null!==(s=u.icon)&&void 0!==s&&null!==(d=s.whoAmI)&&void 0!==d&&d.preview?(0,o.jsx)(a.Z,{image:u.icon.whoAmI.preview.small,color:null,label:null}):(0,o.jsx)(i.Z,{"data-testid":"generic-icon",name:c[m],size:"big"})}},45871:function(e,n,t){t.d(n,{Z:function(){return b}});var r,i=t(2867),l=t(71171),a=t(73377),o=t(19046),s=t(54681),d=t(70663),u=t(92042),c=t(55152),m=t(5918),v=t(37893),f=t(57450),p=v.ZP.div(r||(r=(0,l.Z)(["\n    display: flex;\n    height: 3rem;\n\n    && .buttons {\n        display: none;\n    }\n\n    &:hover .buttons {\n        display: block;\n    }\n\n    > * {\n        margin-right: 1em;\n    }\n"])));var b=function(e){var n=e.onChange,t=e.label,r=e.value,l=e.disabled,v=e.libraries,b=e.required,Z=void 0!==b&&b,h=(0,d.$G)().t,x=s.useState(!1),y=(0,i.Z)(x,2),g=y[0],E=y[1],j=s.useState(!1),I=(0,i.Z)(j,2),C=I[0],T=I[1],_=function(){return T(!1)},D=function(){E(!0)};return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("label",{children:t}),(0,f.jsxs)(p,{children:[r&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(o.Z,{record:r}),!l&&(0,f.jsxs)(u.Z.Group,{basic:!0,children:[(0,f.jsx)(u.Z,{type:"button",icon:!0,onClick:D,title:"exchange","aria-label":"exchange",name:"exchange",children:(0,f.jsx)(c.Z,{name:"exchange"})}),!Z&&(0,f.jsx)(u.Z,{type:"button",icon:!0,onClick:function(){return T(!0)},"aria-label":"delete",children:(0,f.jsx)(c.Z,{name:"close"})})]})]}),!r&&(0,f.jsxs)(u.Z,{type:"button",icon:!0,labelPosition:"left",onClick:D,children:[(0,f.jsx)(c.Z,{name:"search"}),h("record_selector.select")]})]}),g&&(0,f.jsx)(a.Z,{library:v,open:g,onClose:function(){return E(!1)},onSelect:function(e){n(e),E(!1)}}),C&&(0,f.jsx)(m.Z,{open:C,onCancel:_,onConfirm:function(){n(null),_()},content:h("record_selector.delete_confirm"),confirmButton:h("admin.submit"),cancelButton:h("admin.cancel")})]})}}}]);
//# sourceMappingURL=78.3bd3128c.chunk.js.map