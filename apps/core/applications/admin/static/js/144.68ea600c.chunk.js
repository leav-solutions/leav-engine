(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[144,378],{45611:function(e,n,r){"use strict";r.d(n,{Z:function(){return b}});var i=r(33028),t=r(80688),l=(r(54681),r(74790)),a=r(59740),s=r(5168),o=r(74280),d=r(71446),u=r(57450),c=["loading","libraries"],m=function(e){e.loading;var n=e.libraries,r=(0,a.Z)(e,c),t=(0,o.Z)().lang,l=n?n.map((function(e){return{key:e.id,value:e.id,text:(0,d.dX)(e.label,t)}})):[];return delete r.t,delete r.tReady,delete r.defaultNS,delete r.i18nOptions,delete r.reportNS,(0,u.jsx)(s.Z.Dropdown,(0,i.Z)((0,i.Z)({},r),{},{search:!0,options:l}))};m.defaultProps={loading:!1,libraries:[]};var p=m;var b=function(e){var n=(0,t.useQuery)(l.c),r=n.loading,a=n.data;return(0,u.jsx)(p,(0,i.Z)((0,i.Z)({},e),{},{loading:r,libraries:a&&a.libraries?a.libraries.list:null}))}},10290:function(e,n,r){"use strict";r.d(n,{Z:function(){return m}});var i=r(2867),t=r(54681),l=r(70621),a=r(71446),s=r(73218),o=r(22660),d=r(78053),u=r(57450),c=function(e){var n=e.treeAttribute,r=e.permissionType,c=e.applyTo,m=e.readOnly,p=t.useState({node:{id:l.Y},path:[],treeIndex:0}),b=(0,i.Z)(p,2),f=b[0],h=b[1],v=t.useState({node:{id:l.Y},path:[],treeIndex:0}),x=(0,i.Z)(v,2),Z=x[0],y=x[1];if(!n.linked_tree)return(0,u.jsx)("p",{children:"Cannot find tree"});var g=[(0,u.jsx)(o.Z,{treeId:n.linked_tree.id,onClick:function(e){return h((0,a.xN)(e)!==(0,a.xN)(f)?e:null)},selectedNode:f},"perm_tree")];return f&&(g.push((0,u.jsx)(o.Z,{treeId:"users_groups",onClick:function(e){return y((0,a.xN)(e)!==(0,a.xN)(Z)?e:null)},selectedNode:Z})),Z&&g.push((0,u.jsx)(d.Z,{permParams:{type:r,applyTo:c,usersGroup:Z.node.id!==l.Y?Z.node.id:null,permissionTreeTarget:{tree:n.linked_tree.id,nodeId:f.node.id!==l.Y?f.node.id:null}},readOnly:m}))),(0,u.jsx)(s.Z,{columnsNumber:3,columnsContent:g})};c.defaultProps={readOnly:!1};var m=c},68648:function(e,n,r){"use strict";r.d(n,{Z:function(){return z}});var i,t=r(38777),l=r(33028),a=r(2867),s=r(59740),o=r(71171),d=r(74280),u=r(54681),c=r(70663),m=r(31010),p=r(55152),b=r(887),f=r(92042),h=r(37893),v=r(19913),x=r(52987),Z=r(53852),y=r(80688),g=r(43157),j=r(64449),w=r(39918),_=r(85823),C=r(80687),k=r(71207),P=r(57450),I=(0,h.ZP)(_.Z.Item)(i||(i=(0,o.Z)(["\n    &&&& {\n        cursor: pointer;\n        padding: 0.5rem;\n    }\n    &:hover {\n        background-color: ",";\n    }\n"])),k.d6);var A=function(e){var n=e.attributes,r=e.onSelect,i=(0,d.Z)().lang,t=(0,c.$G)().t,l=function(e){return function(){r(e)}};return(0,P.jsxs)(_.Z,{divided:!0,"aria-label":"attribute-selector-list",children:[!n.length&&(0,P.jsx)(C.Z,{info:!0,size:"tiny",children:t("permissions_settings.no_attributes_to_add")}),n.map((function(e){return(0,P.jsxs)(I,{onClick:l(e),children:[(0,P.jsx)(_.Z.Header,{children:(0,v.dX)(e.label,i)}),(0,P.jsx)(_.Z.Description,{children:e.id})]},e.id)}))]})};var S,$,O,T=function(e){var n,r,i=e.library,t=e.selectedAttributes,l=e.onSelectAttribute,s=(0,c.$G)().t,o=(0,u.useState)(!1),d=(0,a.Z)(o,2),m=d[0],b=d[1],f=(0,y.useLazyQuery)(w.V,{variables:{libraries:i?[i.id]:null,type:[x.GC.tree]}}),h=(0,a.Z)(f,2),v=h[0],_=h[1],C=_.loading,k=_.error,I=_.data,S=_.called;(0,u.useEffect)((function(){m&&!S&&v()}),[m,S]);var $=(null!==(n=null===I||void 0===I||null===(r=I.attributes)||void 0===r?void 0:r.list)&&void 0!==n?n:[]).filter((function(e){return!t.includes(e.id)}));return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)(Z.Z,{basic:!0,compact:!0,onClick:function(){b(!0)},children:[(0,P.jsx)(p.Z,{name:"plus"}),s("permissions_settings.add_permissions_attribute")]}),C&&(0,P.jsx)(j.Z,{size:"small"}),k&&(0,P.jsx)(g.Z,{message:k.message,size:"small"}),m&&S&&!C&&!k&&(0,P.jsx)(A,{attributes:$,onSelect:function(e){l(e.id),b(!1)}})]})},R=["permissionsSettings","onChangeSettings","library","readonly"],N=h.ZP.div(S||(S=(0,o.Z)(["\n    display: flex;\n    gap: 1rem;\n    flex-direction: column;\n    min-width: 225px;\n    max-width: 90vw;\n    font-size: 1rem;\n"]))),D=h.ZP.div($||($=(0,o.Z)(["\n    cursor: pointer;\n"]))),G=(0,h.ZP)(m.Z.Cell)(O||(O=(0,o.Z)(["\n    &&& {\n        ","\n    }\n"])),(function(e){return!e.$hasAttributes&&"border-top: none;"})),E=x.sl.and;var z=function(e){var n,r,i=e.permissionsSettings,o=e.onChangeSettings,h=e.library,y=e.readonly,g=(0,s.Z)(e,R),j=(0,c.$G)().t,w=(0,d.Z)().lang,_=u.useState(null!==(n=null===i||void 0===i?void 0:i.relation)&&void 0!==n?n:x.sl.and),C=(0,a.Z)(_,2),k=C[0],I=C[1],A=null!==(r=null===i||void 0===i?void 0:i.permissionTreeAttributes)&&void 0!==r?r:[],S=(0,P.jsxs)(D,(0,l.Z)((0,l.Z)({},g),{},{children:[(0,P.jsx)(p.Z,{name:"cog"}),j("permissions_settings.title")]})),$=Object.values(x.sl),O=function(e){return function(){I(e),o({permissionTreeAttributes:i.permissionTreeAttributes.map((function(e){return e.id})),relation:e})}},z={type:[x.GC.tree]};return h&&(z.libraries=[h.id]),(0,P.jsx)(b.Z,{trigger:S,on:"click",closeOnEscape:!0,position:"bottom left",style:{maxWidth:"none"},children:(0,P.jsxs)(N,{children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("h5",{children:j("permissions_settings.permissions_attributes")}),(0,P.jsxs)(m.Z,{compact:!0,children:[(0,P.jsx)(m.Z.Body,{children:A.map((function(e){return(0,P.jsxs)(m.Z.Row,{children:[(0,P.jsx)(m.Z.Cell,{children:(0,v.dX)(e.label,w)}),(0,P.jsx)(m.Z.Cell,{width:3,children:!y&&(0,P.jsx)(Z.Z,{"aria-label":"remove",icon:"trash alternate outline",onClick:(n=e.id,function(){var e;o({permissionTreeAttributes:A.map((function(e){return e.id})).filter((function(e){return e!==n})),relation:null!==(e=null===i||void 0===i?void 0:i.relation)&&void 0!==e?e:E})})})})]},e.id);var n}))}),!y&&(0,P.jsx)(m.Z.Footer,{children:(0,P.jsx)(m.Z.Row,{children:(0,P.jsx)(G,{colSpan:2,$hasAttributes:!!A.length,children:(0,P.jsx)(T,{library:h,onSelectAttribute:function(e){var n,r={permissionTreeAttributes:[].concat((0,t.Z)(A.map((function(e){return e.id}))),[e]),relation:null!==(n=null===i||void 0===i?void 0:i.relation)&&void 0!==n?n:E};o(r)},selectedAttributes:A.map((function(e){return e.id}))})})})})]})]}),A.length>1&&(0,P.jsxs)("div",{children:[(0,P.jsx)("h5",{children:j("permissions_settings.operator")}),(0,P.jsx)(f.Z.Group,{basic:!0,children:$.map((function(e){return(0,P.jsx)(f.Z,{disabled:y,compact:!0,onClick:O(e),active:k===e,children:j("permissions_settings.operator_".concat(e))},e)}))})]})]})})}},73168:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return qe}});var i,t,l,a=r(80688),s=r(54681),o=r(26637),d=r(24532),u=r(52987),c=r(64449),m=r(2867),p=r(15098),b=r(70663),f=r(47016),h=r(81592),v=r(63851),x=r(74280),Z=r(19913),y=r(34795),g=r(77162),j=r.n(g),w=r(72335),_=r(71171),C=r(42737),k=r.n(C)()(i||(i=(0,_.Z)(["\n    mutation SAVE_TREE($treeData: TreeInput!) {\n        saveTree(tree: $treeData) {\n            id\n            system\n            label\n            behavior\n            libraries {\n                library {\n                    id\n                    label\n                    attributes {\n                        id\n                        label\n                        type\n                        ... on TreeAttribute {\n                            linked_tree {\n                                id\n                            }\n                        }\n                    }\n                }\n                settings {\n                    allowMultiplePositions\n                    allowedAtRoot\n                    allowedChildren\n                }\n            }\n            permissions_conf {\n                libraryId\n                permissionsConf {\n                    permissionTreeAttributes {\n                        id\n                        label\n                    }\n                    relation\n                }\n            }\n        }\n    }\n"]))),P=r(56666),I=r(33028),A=r(91492),S=r(88674),$=r.n(S),O=r(5168),T=r(37893),R=r(61247),N=r(9983),D=r(43248),G=r(38777),E=r(55152),z=r(8450),M=r(92042),F=r(37256),B=r(56022),L=r(45611),V=r(57450),X=T.ZP.label(t||(t=(0,_.Z)(["\n    font-weight: 700;\n"]))),q=(0,T.ZP)(E.Z)(l||(l=(0,_.Z)(["\n    cursor: pointer;\n"])));var Q,Y=function(e){var n=e.onChange,r=e.libraries,i=e.readonly,t=(0,b.$G)().t,l=function(e){return function(i,t){var l=t.value;"checkbox"===t.type?l="allowedChildren"===t.name?t.checked?["__all__"]:[]:t.checked:"allowedChildren"!==t.name||t.value.length||(l=["__all__"]);var a=r;a[e].settings=(0,I.Z)((0,I.Z)({},a[e].settings),{},(0,P.Z)({},t.name,l)),n(a)}},a=function(e){return function(i,t){var l=r;l[e].library=t.value,n(l)}},s=function(e){return function(){var i=(0,G.Z)(r);n([].concat((0,G.Z)(i.splice(0,e)),(0,G.Z)(i.splice(e+1))))}};return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsxs)(z.Z,{children:[(0,V.jsx)(z.Z.Column,{textAlign:"left",floated:"left",width:8,verticalAlign:"middle",children:(0,V.jsx)(X,{children:t("trees.libraries")})}),!i&&(0,V.jsx)(z.Z.Column,{floated:"right",width:8,textAlign:"right",verticalAlign:"middle",children:(0,V.jsxs)(M.Z,{"data-test-id":"add-button",type:"button",icon:!0,labelPosition:"left",size:"small",onClick:function(){n([].concat((0,G.Z)(r),[{library:"",settings:{allowMultiplePositions:!1,allowedAtRoot:!0,allowedChildren:["__all__"]}}]))},children:[(0,V.jsx)(E.Z,{name:"plus"}),t("trees.add_library")]})})]}),r.map((function(e,n){return(0,V.jsx)(F.Z,{children:(0,V.jsx)(z.Z,{columns:3,stackable:!0,children:(0,V.jsxs)(z.Z.Row,{verticalAlign:"middle",children:[(0,V.jsx)(z.Z.Column,{width:4,children:(0,V.jsx)(L.Z,{"data-test-id":"lib-selector",disabled:i,multiple:!1,fluid:!0,selection:!0,name:"libraries",onChange:a(n),value:e.library})}),(0,V.jsx)(z.Z.Column,{width:11,textAlign:"right",children:(0,V.jsx)(z.Z,{columns:1,stackable:!0,children:(0,V.jsx)(z.Z.Row,{verticalAlign:"middle",children:(0,V.jsx)(z.Z.Column,{textAlign:"left",children:(0,V.jsx)(B.Z,{"data-test-id":"settings-allowMultiplePositions-".concat(e.library),toggle:!0,name:"allowMultiplePositions",checked:e.settings.allowMultiplePositions,label:t("trees.allow_multiple_positions"),onChange:l(n),disabled:i})})})})}),!i&&(0,V.jsx)(z.Z.Column,{width:1,textAlign:"right",children:(0,V.jsx)(q,{"data-test-id":"delete-button",name:"cancel",onClick:s(n)})})]})})},n)}))]})},J=(0,T.ZP)(O.Z.Group)(Q||(Q=(0,_.Z)(["\n    margin-top: 10px;\n"]))),U=function(e){var n=e.tree,r=e.onSubmit,i=e.readonly,t=e.errors,l=e.onCheckIdExists,a=(0,b.$G)().t,s={id:"",label:{fr:"",en:""},behavior:u.ZJ.standard,system:!1,permissions_conf:null,libraries:[]},o=null===n?s:(0,I.Z)((0,I.Z)({},n),{},{libraries:n.libraries.map((function(e){return{library:e.library.id,settings:$()(e.settings,["__typename"])}}))}),d=null!==n,c=(0,x.Z)(),p=(c.lang,c.defaultLang),f=c.availableLangs,h=t&&t.extensions.code===N.Z.VALIDATION_ERROR?t.extensions.fields:{},v=R.Z_().required().matches(/^[a-z0-9_]+$/);d||(v=v.test("isIdUnique",a("admin.validation_errors.id_exists"),l));var y=R.Ry().shape({label:R.Ry().shape((0,P.Z)({},p||f[0],R.Z_().required())),id:v,libraries:R.IX(R.Ry().shape({library:R.Z_(),settings:R.Ry()}))}),g=Object.values(u.ZJ).map((function(e){return{key:e,value:e,text:a("trees.behavior_".concat(e))}}));return(0,V.jsx)(A.J9,{initialValues:o,onSubmit:function(e){r(e)},render:function(e){var n=e.handleSubmit,r=e.handleBlur,t=e.setFieldValue,l=e.errors,s=e.values,o=e.touched,u=function(e,n){c(e,n);var r=n.name,i=n.value,l=r.split("."),a=(0,m.Z)(l,2),s=a[0],o=a[1];d||"label"!==s||o!==p||t("id",(0,Z.GV)(i))},c=function(e,n){var r="checkbox"===n.type?n.checked:n.value,i=n.name;t(i,r)},b=s.id,v=s.label,x=s.libraries,y=s.system,j=s.behavior,w=function(e){return(0,Z.zQ)(e,o,h||{},l)};return(0,V.jsxs)(O.Z,{onSubmit:n,children:[(0,V.jsxs)(O.Z.Group,{grouped:!0,children:[(0,V.jsx)("label",{children:a("trees.label")}),f.map((function(e){return(0,V.jsx)(D.Z,{error:w("label.".concat(e)),children:(0,V.jsx)(O.Z.Input,{label:"".concat(e," ").concat(e===p?"*":""),width:"4",name:"label."+e,disabled:i,value:v&&v[e]?v[e]:"",onChange:u})},e)}))]}),(0,V.jsx)(D.Z,{error:w("id"),children:(0,V.jsx)(O.Z.Input,{label:a("trees.ID"),width:"4",disabled:d||i,name:"id",onChange:c,onBlur:r,value:b})}),(0,V.jsx)(D.Z,{error:w("behavior"),children:(0,V.jsx)(O.Z.Select,{label:a("trees.behavior"),disabled:!0,name:"behavior",onChange:c,onBlur:r,value:j,options:g})}),(0,V.jsx)(D.Z,{error:w("libraries"),children:(0,V.jsx)(Y,{libraries:x,onChange:function(e){t("libraries",e)},readonly:y||i})}),!i&&(0,V.jsx)(J,{children:(0,V.jsx)(O.Z.Button,{type:"submit",children:a("admin.submit")})})]})},validationSchema:y})};var H,K=function(e){var n=e.tree,r=e.readonly,i=(0,f.k6)(),t=!n,l=(0,a.useMutation)(k,{update:function(){var e=(0,y.Z)(j().mark((function e(r){return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n||(0,Z.Ku)(r,"trees");case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()}),s=(0,m.Z)(l,1)[0],o=(0,a.useLazyQuery)(w.u,{fetchPolicy:"no-cache"}),d=(0,m.Z)(o,2),u=d[0],c=d[1].data,p=function(){var e=(0,y.Z)(j().mark((function e(n){var r,l;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s({variables:{treeData:{id:n.id,label:n.label,libraries:null!==(r=null===(l=n.libraries)||void 0===l?void 0:l.filter((function(e){return e.library})))&&void 0!==r?r:null}},refetchQueries:["GET_TREES"]});case 2:t&&i.replace({pathname:"/trees/edit/"+n.id});case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),b=function(){var e=(0,y.Z)(j().mark((function e(n){return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u({variables:{id:n}});case 2:return e.abrupt("return",!!c&&!!c.trees&&!c.trees.list.length);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,V.jsx)(U,{tree:n,readonly:r,onSubmit:p,onCheckIdExists:b})},W=K,ee=r(12700),ne=r.n(ee),re=r(90930),ie=r(68648),te=r(10290),le=(0,T.ZP)(ie.Z)(H||(H=(0,_.Z)(["\n    position: absolute;\n    top: 2rem;\n    right: 2rem;\n"])));var ae=function(e){var n,r,i,t,l=e.readonly,a=e.treeLibraries,s=e.tree,o=e.onSubmitSettings,d=(0,x.Z)().lang,c=(0,b.$G)().t,m=null!==(n=null===(r=s.permissions_conf)||void 0===r||null===(i=r.filter((function(e){return e.libraryId===a.library.id})))||void 0===i||null===(t=i[0])||void 0===t?void 0:t.permissionsConf)&&void 0!==n?n:null,p=null!==m&&void 0!==m&&m.permissionTreeAttributes?null===m||void 0===m?void 0:m.permissionTreeAttributes.map((function(e){return{key:"a.id",menuItem:(0,Z.dX)(e.label,d),render:function(){return(0,V.jsx)(h.Z.Pane,{className:"grow flex-col height100",children:(0,V.jsx)(te.Z,{treeAttribute:e,permissionType:u.r3.tree_node,applyTo:"".concat(s.id,"/").concat(a.library.id),readOnly:l},e.id)},"treePermissions")}}})):[];return p.unshift({key:"libPermissions",menuItem:c("permissions.library_tab_name"),render:function(){return(0,V.jsx)(h.Z.Pane,{className:"grow flex-col height100",children:(0,V.jsx)(re.Z,{type:u.r3.tree_library,applyTo:"".concat(s.id,"/").concat(a.library.id),readOnly:l},"libPermissions")},"libPermissions")}}),(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(le,{permissionsSettings:m,onChangeSettings:function(e){return o(a.library.id,e)},library:a.library,readonly:l}),(0,V.jsx)(h.Z,{panes:p,className:"grow flex-col height100"})]})};var se=function(e){var n=e.tree,r=e.readonly,i=e.onSubmitSettings,t=(0,b.$G)().t,l=(0,x.Z)().lang,a=[{key:"treePermissions",menuItem:t("permissions.tree_tab_name"),render:function(){return(0,V.jsx)(h.Z.Pane,{className:"grow flex-col height100",children:(0,V.jsx)(re.Z,{type:u.r3.tree,applyTo:n.id,readOnly:r},"treePermissions")},"treePermissions")}}];return a=[].concat((0,G.Z)(a),(0,G.Z)(n.libraries.map((function(e){return{key:e.library.id,menuItem:(0,Z.dX)(e.library.label,l),render:function(){return(0,V.jsx)(h.Z.Pane,{className:"grow flex-col height100",children:(0,V.jsx)(ae,{tree:n,treeLibraries:e,onSubmitSettings:i,readonly:r})},e.library.id)}}})))),(0,V.jsx)(h.Z,{panes:a,className:"grow flex-col height100"})};var oe,de,ue,ce,me=function(e){var n=e.tree,r=e.readonly,i=(0,a.useMutation)(k),t=(0,m.Z)(i,1)[0];return(0,V.jsx)(se,{tree:n,readonly:r,onSubmitSettings:function(e,r){var i,l=[{libraryId:e,permissionsConf:r}].concat((0,G.Z)((null!==(i=n.permissions_conf)&&void 0!==i?i:[]).map((function(e){return{libraryId:e.libraryId,permissionsConf:{permissionTreeAttributes:e.permissionsConf.permissionTreeAttributes.map((function(e){return e.id})),relation:e.permissionsConf.relation}}})))),a=ne()(l,(function(e){return e.libraryId}));return t({variables:{treeData:{id:n.id,permissions_conf:a}}})}})},pe=r(93749),be="library",fe="__root__",he="__all__",ve=r(41344),xe=r(29653),Ze=r(89301),ye=T.ZP.div(oe||(oe=(0,_.Z)(["\n    border: 1px solid #ddd;\n    border-radius: 0.25rem;\n    margin: 0.25rem 0 1rem 0;\n    padding: 0.5rem;\n    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n    cursor: grab;\n    width: 100%;\n    background-color: ",";\n    position: relative;\n"])),(function(e){return e.isOver?"#f5f5f5":"#FFF"})),ge=T.ZP.div(de||(de=(0,_.Z)(["\n    margin-top: 1rem;\n"]))),je=(0,T.ZP)(M.Z)(ue||(ue=(0,_.Z)(["\n    position: absolute;\n    top: 0.5rem;\n    right: 0.5rem;\n    &&&,\n    &&&:hover,\n    &&&:focus {\n        padding: 0;\n        margin: 0;\n        border: none;\n        box-shadow: none;\n    }\n"]))),we=(0,T.ZP)(v.Z)(ce||(ce=(0,_.Z)(["\n    cursor: pointer;\n"])));var _e,Ce,ke=function e(n){var r=n.libraryItem,i=n.parentItemId,t=n.tree,l=n.readOnly,a=n.onMove,o=(0,x.Z)().lang,d=(0,s.useState)(!1),u=(0,m.Z)(d,2),c=u[0],p=u[1],f=(0,b.$G)().t,h=(0,Ze.c)({item:{type:be,from:i,library:r},canDrag:!l,end:function(e,n){var i=n.getDropResult();i&&a(r.library.id,e.from,i.id)}}),v=(0,m.Z)(h,2)[1],Z=(0,ve.L)({accept:[be],canDrop:function(){return!l},drop:function(e,n){if(n.isOver({shallow:!0}))return p(!0),{id:r.library.id}},collect:function(e){return{isOverElement:e.isOver({shallow:!0}),isOverNested:e.isOver()}}}),y=(0,m.Z)(Z,2),g=y[0],j=g.isOverNested,w=g.isOverElement,_=y[1],C=t.libraries.filter((function(e){return r.settings.allowedChildren.some((function(n){return n===e.library.id||"__all__"===n}))})),k=c||j;return(0,V.jsx)(ye,{ref:v,isOver:w,"data-testid":"dependencies-library-item-".concat(r.library.id),children:(0,V.jsxs)("div",{ref:_,children:[(0,V.jsxs)(we,{size:"small",onClick:function(){p(!c)},children:[(0,V.jsxs)("span",{children:[k?(0,V.jsx)(E.Z,{name:"triangle down",style:{fontSize:"1rem"}}):(0,V.jsx)(E.Z,{name:"triangle right",style:{fontSize:"1rem"}}),(0,xe.a0)(r.library.label,o)]}),!l&&(0,V.jsx)(je,{basic:!0,circular:!0,size:"small",onClick:function(e){e.preventDefault(),e.stopPropagation(),a(r.library.id,i,null)},"aria-label":f("admin.remove"),children:(0,V.jsx)(E.Z,{name:"trash"})})]}),k&&(0,V.jsx)(V.Fragment,{children:C.length?(0,V.jsxs)(ge,{"data-testid":"allowed-children",children:[(0,V.jsxs)("div",{children:[f("trees.allow_children"),":"]}),C.map((function(n){return(0,V.jsx)(e,{tree:t,libraryItem:n,parentItemId:r.library.id,readOnly:l,onMove:a},n.library.id)}))]}):(0,V.jsx)("div",{children:f("trees.no_children_allowed")})})]})},r.library.id)},Pe=ke,Ie=T.ZP.div(_e||(_e=(0,_.Z)(["\n    background: ",";\n    border: 2px dashed #ccc;\n    border-radius: 0.25rem;\n    padding: 1rem;\n    margin: 1rem 0;\n"])),(function(e){return e.isOver?"#f5f5f5":"#FFF"})),Ae=T.ZP.div(Ce||(Ce=(0,_.Z)(["\n    color: #ccc;\n    font-weight: bold;\n    margin: 3rem auto;\n    text-align: center;\n"])));var Se,$e,Oe=function(e){var n=e.tree,r=e.onMove,i=e.readOnly,t=(0,b.$G)().t,l=(0,ve.L)({accept:[be],canDrop:function(){return!i},drop:function(e,n){if(n.isOver({shallow:!0}))return{id:fe}},collect:function(e){return{isOver:e.isOver({shallow:!0})}}}),a=(0,m.Z)(l,2),s=a[0].isOver,o=a[1],d=n.libraries.filter((function(e){return e.settings.allowedAtRoot}));return(0,V.jsxs)(Ie,{ref:o,isOver:s,"data-testid":"dependencies-editor-root",children:[(0,V.jsx)(v.Z,{size:"small",children:t("trees.root")}),d.length?d.map((function(e){return(0,V.jsx)(Pe,{tree:n,libraryItem:e,parentItemId:fe,readOnly:i,onMove:r},e.library.id)})):(0,V.jsx)(Ae,{children:t("trees.no_root_libraries")})]})},Te=T.ZP.div(Se||(Se=(0,_.Z)(["\n    border: 1px solid #ddd;\n    border-radius: 0.25rem;\n    margin: 1rem 0;\n    padding: 0.5rem;\n    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n    cursor: grab;\n    width: 100%;\n    position: relative;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n"]))),Re=(0,T.ZP)(M.Z)($e||($e=(0,_.Z)(["\n    &&&,\n    &&&:hover,\n    &&&:focus {\n        border: none;\n        box-shadow: none;\n    }\n"])));var Ne,De,Ge,Ee=function(e){var n=e.treeLibrary,r=e.readOnly,i=e.onMove,t=(0,x.Z)().lang,l=(0,b.$G)().t,a=(0,Ze.c)({item:{type:"library",from:null,library:n},canDrag:!r,end:function(e,r){var t=r.getDropResult();t&&i(n.library.id,null,t.id)}}),s=(0,m.Z)(a,2)[1];return(0,V.jsxs)(Te,{ref:s,"data-testid":"library-item-".concat(n.library.id),children:[(0,xe.a0)(n.library.label,t),!r&&(0,V.jsx)(Re,{icon:!0,circular:!0,basic:!0,size:"small",onClick:function(){i(n.library.id,null,fe)},"aria-label":l("admin.add"),children:(0,V.jsx)(E.Z,{name:"plus"})})]},n.library.id)},ze=T.ZP.div(Ne||(Ne=(0,_.Z)(["\n    display: grid;\n    grid-template-columns: 250px 1fr;\n    grid-template-rows: 1fr;\n    grid-template-areas: 'libraries deps';\n    gap: 1rem;\n    height: 100%;\n"]))),Me=T.ZP.div(De||(De=(0,_.Z)(["\n    grid-area: libraries;\n    overflow: auto;\n    width: 250px;\n"]))),Fe=T.ZP.div(Ge||(Ge=(0,_.Z)(["\n    border-left: 1px solid #ccc;\n    padding-left: 1rem;\n    grid-area: deps;\n    overflow: auto;\n    position: relative;\n"])));var Be=function(e){var n=e.tree,r=e.readOnly,i=e.onChange,t=e.loading,l=(0,b.$G)().t,a=n.libraries.reduce((function(e,n){return e[n.library.id]=n.settings,e}),{}),s=function(e,n,r){r===fe?a[e]=(0,I.Z)((0,I.Z)({},a[e]),{},{allowedAtRoot:!0}):r&&(a[r]=(0,I.Z)((0,I.Z)({},a[r]),{},{allowedChildren:[].concat((0,G.Z)(a[r].allowedChildren),[e]).filter((function(e){return e!==he}))})),n===fe?a[e]=(0,I.Z)((0,I.Z)({},a[e]),{},{allowedAtRoot:!1}):n&&(a[n]=(0,I.Z)((0,I.Z)({},a[n]),{},{allowedChildren:a[n].allowedChildren.filter((function(n){return n!==e&&n!==he}))})),i(a)};return(0,V.jsxs)(ze,{children:[(0,V.jsx)(Me,{"data-testid":"libraries-list",children:(0,V.jsxs)(v.Z,{size:"small",children:[l("trees.libraries"),n.libraries.map((function(e){return(0,V.jsx)(Ee,{treeLibrary:e,readOnly:r,onMove:s},e.library.id)}))]})}),(0,V.jsxs)(Fe,{"data-testid":"dependencies-editor",children:[(0,V.jsxs)(v.Z,{size:"small",children:[l("trees.dependencies"),t&&(0,V.jsx)(pe.Z,{size:"tiny",active:!0,inline:!0,style:{marginLeft:"1rem"}})]}),(0,V.jsx)(Oe,{tree:n,readOnly:r,onMove:s})]})]})};var Le=function(e){var n=e.tree,r=e.readOnly,i=((0,b.$G)().t,(0,a.useMutation)(k,{onError:function(e){}})),t=(0,m.Z)(i,2),l=t[0],s=t[1].loading,o=function(){var e=(0,y.Z)(j().mark((function e(r){var i;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l({variables:{treeData:{id:n.id,libraries:null===(i=n.libraries)||void 0===i?void 0:i.map((function(e){return{library:e.library.id,settings:{allowMultiplePositions:r[e.library.id].allowMultiplePositions,allowedAtRoot:r[e.library.id].allowedAtRoot,allowedChildren:r[e.library.id].allowedChildren}}}))}}});case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,V.jsx)(Be,{tree:n,readOnly:r,onChange:o,loading:s})},Ve=Le;var Xe=function(e){var n,r=e.tree,i=e.readonly,t=(0,b.$G)().t,l=(0,x.Z)().lang,a=(0,f.k6)(),o=(0,f.TH)(),d=null===r,u=d?t("trees.new"):(0,Z.dX)(null!==(n=null===r||void 0===r?void 0:r.label)&&void 0!==n?n:null,l)||r.id,c=[{key:"infos",mustBeDisplayed:!0,menuItem:t("trees.informations"),render:function(){return(0,V.jsx)(h.Z.Pane,{className:"grow",children:(0,V.jsx)(W,{tree:r,readonly:i})},"infos")}},{key:"structure",mustBeDisplayed:!d,menuItem:t("trees.structure"),render:function(){return(0,V.jsx)(h.Z.Pane,{className:"grow",children:(0,V.jsx)(Ve,{tree:r,readOnly:i})},"structure")}},{key:"explorer",mustBeDisplayed:!d,menuItem:t("trees.explorer"),render:function(){return(0,V.jsx)(h.Z.Pane,{className:"grow",children:(0,V.jsx)(p.Z,{withFakeRoot:!0,fakeRootLabel:u,tree:r,readOnly:i})},"explorer")}},{key:"permissions",mustBeDisplayed:!d,menuItem:t("trees.permissions"),render:function(){return(0,V.jsx)(h.Z.Pane,{className:"grow",children:(0,V.jsx)(me,{tree:r,readonly:i})},"structure")}}].filter((function(e){return e.mustBeDisplayed})),y=o?o.hash.replace("#",""):void 0,g=(0,s.useState)(y?c.findIndex((function(e){return y===e.key})):0),j=(0,m.Z)(g,2),w=j[0],_=j[1];return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(v.Z,{className:"no-grow",children:u}),(0,V.jsx)(h.Z,{activeIndex:w,onTabChange:function(e,n){n.panes&&void 0!==n.activeIndex&&(_(Number(n.activeIndex.toString())),null===a||void 0===a||a.push("#".concat(n.panes[n.activeIndex].key)))},menu:{secondary:!0,pointing:!0},panes:c,className:"grow flex-col height100"})]})},qe=function(e){var n,r,i,t=e.match.params.id,l=(0,o.Z)(),s=(0,a.useQuery)(d.F,{variables:{id:t},skip:!t}),m=s.loading,p=s.error,b=s.data;return m?(0,V.jsx)(c.Z,{withDimmer:!0}):"undefined"!==typeof p?(0,V.jsxs)("p",{children:["Error: ",p.message]}):!t||null!==b&&void 0!==b&&null!==(n=b.trees)&&void 0!==n&&n.list.length?(0,V.jsx)(Xe,{tree:null!==(r=null===b||void 0===b||null===(i=b.trees)||void 0===i?void 0:i.list[0])&&void 0!==r?r:null,readonly:!l.permissions[u.Au.admin_edit_tree]}):(0,V.jsx)("div",{children:"Unknown tree"})}},39918:function(e,n,r){"use strict";r.d(n,{V:function(){return a}});var i,t=r(71171),l=r(42737),a=r.n(l)()(i||(i=(0,t.Z)(["\n    query GET_ATTRIBUTES(\n        $id: ID\n        $label: String\n        $type: [AttributeType]\n        $format: [AttributeFormat]\n        $system: Boolean\n        $multiple_values: Boolean\n        $versionable: Boolean\n        $libraries: [String!]\n    ) {\n        attributes(\n            filters: {\n                id: $id\n                label: $label\n                type: $type\n                format: $format\n                system: $system\n                multiple_values: $multiple_values\n                versionable: $versionable\n                libraries: $libraries\n            }\n        ) {\n            totalCount\n            list {\n                id\n                label\n                type\n                format\n                system\n                multiple_values\n                ... on StandardAttribute {\n                    unique\n                }\n                ... on LinkAttribute {\n                    linked_library {\n                        id\n                    }\n                    reverse_link\n                }\n                ... on TreeAttribute {\n                    linked_tree {\n                        id\n                    }\n                }\n            }\n        }\n    }\n"])))},72335:function(e,n,r){"use strict";r.d(n,{T:function(){return a},u:function(){return s}});var i,t=r(71171),l=r(42737),a="GET_TREES",s=r.n(l)()(i||(i=(0,t.Z)(["\n    query GET_TREES($id: ID, $label: String, $system: Boolean) {\n        trees(filters: {id: $id, label: $label, system: $system}) {\n            totalCount\n            list {\n                id\n                label\n                system\n                behavior\n                libraries {\n                    library {\n                        id\n                        label\n                    }\n                    settings {\n                        allowMultiplePositions\n                        allowedAtRoot\n                        allowedChildren\n                    }\n                }\n            }\n        }\n    }\n"])))},93528:function(e){e.exports=function(e,n,r){for(var i=-1,t=null==e?0:e.length;++i<t;)if(r(n,e[i]))return!0;return!1}},53970:function(e,n,r){var i=r(81294),t=r(24918),l=r(93528),a=r(82195),s=r(50598),o=r(22761);e.exports=function(e,n,r){var d=-1,u=t,c=e.length,m=!0,p=[],b=p;if(r)m=!1,u=l;else if(c>=200){var f=n?null:s(e);if(f)return o(f);m=!1,u=a,b=new i}else b=n?[]:p;e:for(;++d<c;){var h=e[d],v=n?n(h):h;if(h=r||0!==h?h:0,m&&v===v){for(var x=b.length;x--;)if(b[x]===v)continue e;n&&b.push(v),p.push(h)}else u(b,v,r)||(b!==p&&b.push(v),p.push(h))}return p}},27593:function(e,n,r){var i=r(76729),t=r(99985),l=r(27964),a=r(70239);e.exports=function(e,n){return n=i(n,e),null==(e=l(e,n))||delete e[a(t(n))]}},50598:function(e,n,r){var i=r(35889),t=r(61398),l=r(22761),a=i&&1/l(new i([,-0]))[1]==1/0?function(e){return new i(e)}:t;e.exports=a},69752:function(e,n,r){var i=r(67722);e.exports=function(e){return i(e)?void 0:e}},27964:function(e,n,r){var i=r(22374),t=r(72111);e.exports=function(e,n){return n.length<2?e:i(e,t(n,0,-1))}},99985:function(e){e.exports=function(e){var n=null==e?0:e.length;return n?e[n-1]:void 0}},88674:function(e,n,r){var i=r(26306),t=r(46817),l=r(27593),a=r(76729),s=r(79281),o=r(69752),d=r(36625),u=r(60699),c=d((function(e,n){var r={};if(null==e)return r;var d=!1;n=i(n,(function(n){return n=a(n,e),d||(d=n.length>1),n})),s(e,u(e),r),d&&(r=t(r,7,o));for(var c=n.length;c--;)l(r,n[c]);return r}));e.exports=c},12700:function(e,n,r){var i=r(48311),t=r(53970);e.exports=function(e,n){return e&&e.length?t(e,i(n,2)):[]}}}]);
//# sourceMappingURL=144.68ea600c.chunk.js.map