"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[500],{16058:function(e,n,t){t.d(n,{Z:function(){return l}});var r=t(2867),s=t(54681),a=t(70663),c=t(5918),i=t(57450),l=function(e){var n=e.confirmMessage,t=e.children,l=(0,a.$G)().t,o=(0,s.useState)(!1),d=(0,r.Z)(o,2),u=d[0],f=d[1],p=function(e){e.preventDefault(),e.stopPropagation(),f(!1)},h=s.cloneElement(t,{onClick:function(e){e.preventDefault(),e.stopPropagation(),f(!0)}});return(0,i.jsxs)("div",{onClick:function(e){e.preventDefault(),e.stopPropagation()},children:[h,(0,i.jsx)(c.Z,{open:u,content:n,onCancel:p,onConfirm:function(n){p(n),e.action()},cancelButton:l("admin.cancel"),closeOnDocumentClick:!1,closeOnDimmerClick:!1})]})}},52788:function(e,n,t){t.d(n,{Z:function(){return a}});t(54681);var r=t(92042),s=t(57450);var a=function(e){var n=e.disabled,t=e.onClick;return(0,s.jsx)(r.Z,{"aria-label":"delete",className:"delete",circular:!0,icon:"trash",disabled:n,onClick:t})}},77500:function(e,n,t){t.r(n),t.d(n,{default:function(){return ne}});var r,s,a,c,i=t(38777),l=t(34795),o=t(33028),d=t(41361),u=t(2867),f=t(71171),p=t(77162),h=t.n(p),m=t(80688),Z=t(42737),k=t.n(Z),v=k()(r||(r=(0,f.Z)(["\n    mutation CANCEL_TASK($taskId: ID!) {\n        cancelTask(taskId: $taskId)\n    }\n"]))),x=k()(s||(s=(0,f.Z)(["\n    mutation DELETE_TASK($taskId: ID!, $archive: Boolean!) {\n        deleteTask(taskId: $taskId, archive: $archive)\n    }\n"]))),g=t(54681),A=t(70663),C=t(66549),j=t(60740),b=t(63851),_=t(81592),D=t(92042),E=t(55152),y=t(37893),I=t(26637),N=t(50500),w=k()(a||(a=(0,f.Z)(["\n    ","\n    query GET_TASKS($filters: TaskFiltersInput) {\n        tasks(filters: $filters) {\n            totalCount\n            list {\n                id\n                label\n                modified_at\n                created_at\n                created_by {\n                    ...RecordIdentity\n                }\n                startAt\n                status\n                priority\n                progress {\n                    percent\n                    description\n                }\n                startedAt\n                completedAt\n                link {\n                    name\n                    url\n                }\n                canceledBy {\n                    ...RecordIdentity\n                }\n                archive\n            }\n        }\n    }\n"])),N.T),S=(0,t(175).gql)(c||(c=(0,f.Z)(["\n    ","\n    subscription SUB_TASKS_UPDATE($filters: TaskFiltersInput) {\n        task(filters: $filters) {\n            id\n            label\n            modified_at\n            created_at\n            created_by {\n                ...RecordIdentity\n            }\n            startAt\n            status\n            priority\n            progress {\n                percent\n                description\n            }\n            startedAt\n            completedAt\n            link {\n                name\n                url\n            }\n            canceledBy {\n                ...RecordIdentity\n            }\n            archive\n        }\n    }\n"])),N.T),L=t(52987),T=t(16058),B=t(57450);var Y=function(e){var n=e.disabled,t=e.onClick;return(0,B.jsx)(D.Z,{"aria-label":"cancel",className:"cancel",circular:!0,icon:"cancel",disabled:n,onClick:t})},$=t(74280),G=t(29653),P=function(e){var n=e.task,t=e.onCancel,r=(0,A.$G)().t,s=(0,I.Z)(),a=(0,$.Z)().lang;return s.permissions[L.Au.admin_cancel_task]?(0,B.jsx)(T.Z,{action:function(){return t(n.id)},confirmMessage:r("tasks.confirm_cancel",{taskName:(0,G.a0)(n.label,a)}),children:(0,B.jsx)(Y,{disabled:!1})}):null},R=function(e){var n=e.onDeleteAll,t=e.confirmMessage,r=e.label;return(0,I.Z)().permissions[L.Au.admin_delete_task]?(0,B.jsx)(T.Z,{action:n,confirmMessage:t,children:(0,B.jsx)(D.Z,{secondary:!0,disabled:!1,floated:"right",size:"small",children:r})}):null},M=t(52788),F=function(e){var n=e.task,t=e.onDelete,r=(0,A.$G)().t,s=(0,I.Z)(),a=(0,$.Z)().lang;return s.permissions[L.Au.admin_delete_task]?(0,B.jsx)(T.Z,{action:function(){return t(n.id)},confirmMessage:r("tasks.confirm_delete",{taskName:(0,G.a0)(n.label,a)}),children:(0,B.jsx)(M.Z,{disabled:!1})}):null},O=t(31010),H=t(11200),K=t(64449),U=t(92426),q=t.n(U),z=function(e,n){var t=e&&n?q().duration(q()(n).diff(q()(e))):q().duration(0);return"".concat(t.hours()+"h"," ").concat(t.minutes()+"m"," ").concat(t.seconds()+"s")},Q=function(e,n){return e.split(".").reduce((function(e,n){return e?e[n]:null}),n)},X=function(e){var n=e.striped,t=void 0!==n&&n,r=e.enabledColumns,s=e.actionsBtn,a=e.footerBtn,c=e.tasks,l=e.loading,d=(0,A.$G)().t,f=(0,$.Z)().lang,p=(0,g.useState)(0),h=(0,u.Z)(p,2),m=h[0],Z=h[1],k=(0,g.useState)({column:"completedAt",direction:"descending"}),v=(0,u.Z)(k,2),x=v[0],C=v[1];(0,g.useEffect)((function(){s&&c.length&&Z(c.map((function(e){return s(e).length})).reduce((function(e,n){return n>e?n:e}),0))}),[s]);return(0,B.jsx)("div",{style:{overflowX:"scroll"},children:(0,B.jsxs)(O.Z,{"data-testid":"TasksList",compact:!0,sortable:!0,striped:t,children:[(0,B.jsx)(O.Z.Header,{children:(0,B.jsxs)(O.Z.Row,{children:[r.map((function(e){return(0,B.jsx)(O.Z.HeaderCell,{sorted:x.column===e?x.direction:null,onClick:function(){C({column:e,direction:"ascending"===x.direction?"descending":"ascending"})},children:d("tasks.task-".concat(e))},"hc-".concat(e))})),(0,i.Z)(Array(m)).map((function(e,n){return(0,B.jsx)(O.Z.HeaderCell,{width:1},"hc-btn".concat(n))}))]})}),(0,B.jsx)(O.Z.Body,{children:l?(0,B.jsx)(O.Z.Row,{children:(0,B.jsx)(O.Z.Cell,{colSpan:6,children:(0,B.jsx)(K.Z,{})})}):c&&c.sort((function(e,n){return Q(x.column,e)<Q(x.column,n)?"ascending"===x.direction?-1:1:Q(x.column,e)>Q(x.column,n)?"ascending"===x.direction?1:-1:0})).map((function(e){var n,t,a,c,l=s?s(e):null;return(0,g.createElement)(O.Z.Row,(0,o.Z)((0,o.Z)((0,o.Z)({},(e.status===L.hY.PENDING_CANCEL||e.status===L.hY.CANCELED)&&{warning:!0}),e.status===L.hY.FAILED&&{error:!0}),{},{key:"row".concat(e.id),"data-testid":"TableRow"}),r.includes("id")&&(0,B.jsx)(O.Z.Cell,{children:e.id}),r.includes("label")&&(0,B.jsx)(O.Z.Cell,{children:(0,G.a0)(e.label,f)}),r.includes("created_by")&&(0,B.jsx)(O.Z.Cell,{children:e.created_by.whoAmI.label}),r.includes("created_at")&&(0,B.jsx)(O.Z.Cell,{children:new Date(1e3*e.created_at).toLocaleString()}),r.includes("startAt")&&(0,B.jsx)(O.Z.Cell,{children:new Date(1e3*e.startAt).toLocaleString()}),r.includes("startedAt")&&(0,B.jsx)(O.Z.Cell,{children:e.startedAt?new Date(1e3*e.startedAt).toLocaleString():""}),r.includes("canceledBy")&&(0,B.jsx)(O.Z.Cell,{children:null===(n=e.canceledBy)||void 0===n?void 0:n.whoAmI.label}),r.includes("completedAt")&&(0,B.jsx)(O.Z.Cell,{children:new Date(1e3*e.completedAt).toLocaleString()}),r.includes("progress.percent")&&(0,B.jsx)(O.Z.Cell,{textAlign:"center",children:(0,B.jsx)(H.Z,(0,o.Z)((0,o.Z)((0,o.Z)((0,o.Z)({percent:(null===(t=e.progress)||void 0===t?void 0:t.percent)||0,progress:!0},e.status===L.hY.DONE&&{success:!0}),(e.status===L.hY.CANCELED||e.status===L.hY.PENDING_CANCEL)&&{warning:!0}),e.status===L.hY.FAILED&&{error:!0}),{},{children:d("tasks.task-statuses.".concat(e.status))}))}),r.includes("progress.description")&&(0,B.jsx)(O.Z.Cell,{children:null!==(a=e.progress)&&void 0!==a&&a.description?(0,G.a0)(null===(c=e.progress)||void 0===c?void 0:c.description,f):""}),r.includes("duration")&&(0,B.jsx)(O.Z.Cell,{children:z(e.startedAt,e.completedAt)}),r.includes("archive")&&(0,B.jsx)(O.Z.Cell,{children:(0,B.jsx)(E.Z,{name:e.archive?"check":"close"})}),!!l&&(0,i.Z)(Array(m)).map((function(n,t){var r=l.length===m?t:m-l.length-t;return(0,B.jsx)(O.Z.Cell,{textAlign:"center",children:l[r]},"actionBtn".concat(r).concat(e.id))})))}))}),!!a&&(0,B.jsx)(O.Z.Footer,{children:(0,B.jsx)(O.Z.Row,{children:(0,B.jsx)(O.Z.HeaderCell,{colSpan:r.length+m,children:a.map((function(e){return e}))})})})]})})};X.defaultProps={loading:!1,tasks:[],filters:{}};var J,V=X,W=(0,y.ZP)(b.Z)(J||(J=(0,f.Z)(["\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n"]))),ee=function(){var e=(0,A.$G)().t,n=(0,I.Z)(),t=(0,C.TL)(),r=(0,C.CG)((function(e){return e.tasks})).tasks,s=(0,g.useState)([]),a=(0,u.Z)(s,2),c=a[0],f=a[1],p=(0,g.useState)([]),Z=(0,u.Z)(p,2),k=Z[0],b=Z[1],y=(0,m.useQuery)(w,{skip:!n,onCompleted:function(e){var n,r=(0,d.Z)(e.tasks.list);try{for(r.s();!(n=r.n()).done;){var s=n.value;t((0,j.gI)(s))}}catch(a){r.e(a)}finally{r.f()}}}),N=y.loading,T=y.error;(0,m.useSubscription)(S,{onSubscriptionData:function(e){var n=(0,o.Z)({},e.subscriptionData.data.task);t((0,j.gI)(n))}});var Y=function(e){return e.status===L.hY.CREATED||e.status===L.hY.PENDING||e.status===L.hY.RUNNING||e.status===L.hY.PENDING_CANCEL},$=function(e){return e.status===L.hY.CANCELED||e.status===L.hY.DONE||e.status===L.hY.FAILED};(0,g.useEffect)((function(){r&&(f(Object.values(r).filter(Y).sort((function(e,n){return e.startAt-n.startAt}))),b(Object.values(r).filter($).sort((function(e,n){return n.completedAt-e.completedAt}))))}),[r]);var G=(0,m.useMutation)(x),M=(0,u.Z)(G,1)[0],O=(0,m.useMutation)(v),H=(0,u.Z)(O,1)[0],K=function(){var e=(0,l.Z)(h().mark((function e(){var n,r,s,a,c=arguments;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=c.length>0&&void 0!==c[0]&&c[0],r=(0,d.Z)(k),e.prev=2,r.s();case 4:if((s=r.n()).done){e.next=12;break}if(a=s.value,!(!n||n&&a.archive)){e.next=10;break}return e.next=9,M({variables:{taskId:a.id,archive:!1}});case 9:t((0,j._5)({id:a.id}));case 10:e.next=4;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),r.e(e.t0);case 17:return e.prev=17,r.f(),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[2,14,17,20]])})));return function(){return e.apply(this,arguments)}}(),U=function(){var e=(0,l.Z)(h().mark((function e(n){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M({variables:{taskId:n,archive:!1}});case 2:t((0,j._5)({id:n}));case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),q=function(){var e=(0,l.Z)(h().mark((function e(n){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,H({variables:{taskId:n}});case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),z=[{menuItem:e("tasks.in_progress"),render:function(){return(0,B.jsx)(_.Z.Pane,{children:(0,B.jsx)(V,{enabledColumns:["id","label","created_by","created_at","startAt","startedAt","progress.percent","progress.description","duration"],striped:!0,actionsBtn:function(e){return e.status!==L.hY.PENDING_CANCEL?[(0,B.jsx)(P,{onCancel:q,task:e})]:[]},loading:N||!c,tasks:c})})}},{menuItem:e("tasks.completed"),render:function(){return(0,B.jsx)(_.Z.Pane,{children:(0,B.jsx)(V,{enabledColumns:["id","label","created_by","created_at","startAt","startedAt","canceledBy","completedAt","progress.percent","progress.description","duration","archive"],actionsBtn:function(e){return[].concat((0,i.Z)(e.link?[(0,B.jsx)(D.Z,{basic:!0,color:"blue",icon:"download",href:e.link.url},"download-file")]:[]),[(0,B.jsx)(F,{onDelete:U,task:e})])},loading:N||!k,tasks:k,footerBtn:[(0,B.jsx)(R,{confirmMessage:e("tasks.confirm_delete_all"),label:e("tasks.delete_all"),onDeleteAll:K},"btn-delAll"),(0,B.jsx)(R,{confirmMessage:e("tasks.confirm_delete_all_archives"),label:e("tasks.delete_archives"),onDeleteAll:function(){return K(!0)}},"btn-delArchives")]})})}}];return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsxs)(W,{size:"large",children:[(0,B.jsx)(E.Z,{name:"tasks"}),e("tasks.title")]}),"undefined"!==typeof T?(0,B.jsxs)("p",{children:["Error: ",T.message]}):(0,B.jsx)(_.Z,{panes:z})]})},ne=ee}}]);
//# sourceMappingURL=500.50bcb08e.chunk.js.map