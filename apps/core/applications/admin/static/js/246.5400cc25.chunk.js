(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[246,378],{7806:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return je}});var i,t,l,o,a,s,u,d,c=r(34795),f=r(2867),v=r(71171),p=r(77162),b=r.n(p),h=r(80688),Z=r(29653),m=r(43157),x=r(64449),g=r(74280),j=r(26637),_=r(88674),P=r.n(_),k=r(175),y=(0,k.gql)(i||(i=(0,v.Z)(["\n    query GET_VERSION_PROFILE_BY_ID($id: ID!) {\n        versionProfiles(filters: {id: $id}) {\n            list {\n                id\n                label\n                description\n                trees {\n                    id\n                    label\n                }\n                linkedAttributes {\n                    id\n                    label\n                }\n            }\n        }\n    }\n"]))),w=r(42875),C=(0,k.gql)(t||(t=(0,v.Z)(["\n    mutation SAVE_VERSION_PROFILE($versionProfile: VersionProfileInput!) {\n        saveVersionProfile(versionProfile: $versionProfile) {\n            id\n            label\n            description\n            trees {\n                id\n                label\n            }\n        }\n    }\n"]))),A=r(54681),I=r(70663),R=r(47016),E=r(63851),S=r(71988),q=r(37893),V=r(52987),B=r(56666),G=r(33028),L=r(59740),N=r(43248),O=r(46389),$=r(91492),D=r(5168),F=r(55152),Q=r(80687),M=r(19913),z=r(61247),T=r(38777),U=r(39719),K=r(38769),H=r(16058),J=r(53852),X=r(8726),Y=r(31010),W=r(35925),ee=r(71207),ne=r(57450),re=q.ZP.div(l||(l=(0,v.Z)(["\n    &&& {\n        margin-top: 1rem;\n    }\n"]))),ie=q.ZP.div(o||(o=(0,v.Z)(["\n    max-height: 20rem;\n    overflow-y: auto;\n    border-top-left-radius: ",";\n    border-top-right-radius: ",";\n\n    && > table {\n        border-radius: 0;\n        border-bottom: none;\n        border-top: none;\n    }\n"])),ee.g4,ee.g4),te=(0,q.ZP)(Y.Z.Row)(a||(a=(0,v.Z)(["\n    cursor: pointer;\n"]))),le=q.ZP.span(s||(s=(0,v.Z)(["\n    color: rgba(0, 0, 0, 0.4);\n    font-size: 0.9rem;\n    margin-left: 0.5rem;\n"]))),oe=q.ZP.div(u||(u=(0,v.Z)(["\n    padding: 0.5rem 1rem;\n    border: 1px solid ",";\n    border-radius: ",";\n    border-bottom-left-radius: 0;\n    border-bottom-right-radius: 0;\n    background: ",";\n"])),ee.T7,ee.g4,ee.E4),ae=q.ZP.div(d||(d=(0,v.Z)(["\n    padding: 0.5rem 1rem;\n    border: 1px solid ",";\n    border-radius: ",";\n    background: ",";\n\n    ","\n"])),ee.T7,ee.g4,ee.E4,(function(e){return e.$hasAttributes&&"\n        border-top-left-radius: 0;\n        border-top-right-radius: 0;\n    "}));var se,ue,de,ce=function(e){var n=e.readonly,r=e.profile,i=(0,g.Z)().lang,t=(0,I.$G)().t,l=(0,A.useState)({visible:!1}),o=(0,f.Z)(l,2),a=o[0],s=o[1],u=(0,h.useMutation)(X.u),d=(0,f.Z)(u,1)[0],v=(0,h.useApolloClient)(),p=A.useState(!1),m=(0,f.Z)(p,2),x=m[0],j=m[1],_=A.useState(""),P=(0,f.Z)(_,2),k=P[0],w=P[1],C=function(){j(!1)},R=function(){var e=(0,c.Z)(b().mark((function e(n){var i;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all(n.map((function(e){return d({variables:{attrData:{id:e,versions_conf:{versionable:!0,profile:r.id}}}})})));case 3:i=e.sent,C(),v.writeQuery({query:y,variables:{id:r.id},data:{versionProfiles:{__typename:"VersionProfileList",list:[(0,G.Z)((0,G.Z)({},r),{},{linkedAttributes:[].concat((0,T.Z)(r.linkedAttributes),(0,T.Z)(i.map((function(e){return e.data.saveAttribute}))))})]}}}),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(0);case 10:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(n){return e.apply(this,arguments)}}(),E=function(e){return function(){s({visible:!0,attribute:e.id})}},S=r.linkedAttributes.filter((function(e){return!k||e.id.match(new RegExp("".concat(k),"i"))||Object.values(e.label).some((function(e){return e.match(new RegExp("".concat(k),"i"))}))}));return(0,ne.jsxs)(re,{className:"field",children:[(0,ne.jsx)("label",{children:t("version_profiles.linked_attributes")}),!!r.linkedAttributes.length&&(0,ne.jsx)(oe,{children:(0,ne.jsx)(W.Z,{icon:"search",size:"small",onChange:function(e){w(e.target.value)},placeholder:t("admin.search_placeholder")})}),(0,ne.jsx)(ie,{children:(0,ne.jsx)(Y.Z,{children:(0,ne.jsx)(Y.Z.Body,{children:S.map((function(e){var n,l=(0,Z.a0)(e.label,i);return(0,ne.jsxs)(te,{onClick:E(e),children:[(0,ne.jsxs)(Y.Z.Cell,{children:[l,(0,ne.jsx)(le,{children:e.id})]}),(0,ne.jsx)(Y.Z.Cell,{width:1,children:(0,ne.jsx)(H.Z,{action:(n=e.id,(0,c.Z)(b().mark((function e(){return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d({variables:{attrData:{id:n,versions_conf:{versionable:!0,profile:null}}}});case 2:v.writeQuery({query:y,variables:{id:r.id},data:{versionProfiles:{__typename:"VersionProfileList",list:[(0,G.Z)((0,G.Z)({},r),{},{linkedAttributes:(0,T.Z)(r.linkedAttributes.filter((function(e){return e.id!==n})))})]}}});case 3:case"end":return e.stop()}}),e)})))),confirmMessage:t("version_profiles.unlink_attribute_confirm",{attributeLabel:l}),children:(0,ne.jsx)(J.Z,{icon:"cancel",name:"unlink","aria-label":"unlink"})})})]},e.id)}))})})}),!n&&(0,ne.jsx)(ae,{$hasAttributes:!!r.linkedAttributes.length,children:(0,ne.jsxs)(J.Z,{basic:!0,labelPosition:"left",onClick:function(e){e.preventDefault(),e.stopPropagation(),j(!0)},children:[(0,ne.jsx)(F.Z,{name:"plus"}),t("version_profiles.link_attributes")]})}),x&&(0,ne.jsx)(U.Z,{openModal:x,onClose:C,onSubmit:R,filter:{type:[V.GC.advanced,V.GC.advanced_link,V.GC.tree]},selection:r.linkedAttributes.map((function(e){return e.id}))}),a.visible&&(0,ne.jsx)(K.Z,{open:!0,onClose:function(){return s({visible:!1})},attribute:a.attribute})]})},fe=ce,ve=["isNewProfile"],pe=(0,q.ZP)((function(e){e.isNewProfile;var n=(0,L.Z)(e,ve);return(0,ne.jsx)(D.Z,(0,G.Z)({},n))}))(se||(se=(0,v.Z)(["\n    && {\n        position: unset;\n        display: grid;\n        grid-template-rows: ",";\n    }\n"])),(function(e){return e.isNewProfile?"auto 6rem":"auto"})),be=q.ZP.div(ue||(ue=(0,v.Z)([""]))),he=q.ZP.div(de||(de=(0,v.Z)(["\n    border-top: 1px solid #dddddd;\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    padding: 1em;\n    text-align: right;\n    display: flex;\n    justify-content: flex-end;\n    align-items: center;\n"])));var Ze,me=function(e){var n,r=e.readonly,i=e.loading,t=e.profile,l=e.onSubmit,o=e.errors,a=e.onCheckIdUniqueness,s=(0,I.$G)().t,u=(0,g.Z)(),d=u.availableLangs,v=u.defaultLang,p=r||i,h={id:"",label:d.reduce((function(e,n){return e[n]="",e}),{}),description:d.reduce((function(e,n){return e[n]="",e}),{}),trees:[]},m=!t,x=(0,G.Z)((0,G.Z)((0,G.Z)({},h),t),{},{trees:(null!==(n=null===t||void 0===t?void 0:t.trees)&&void 0!==n?n:[]).map((function(e){return e.id}))}),j=o&&o.extensions.code===Z.ZB.VALIDATION_ERROR?o.extensions.fields:{},_=z.Z_().required().matches(/^[a-z0-9_]+$/);m&&(_=_.test("isIdUnique",s("admin.validation_errors.id_exists"),a));var P=z.Ry().shape({id:_,label:z.Ry().shape((0,B.Z)({},v,z.Z_().required())),description:z.Ry().shape((0,B.Z)({},v,z.Z_())).nullable(),trees:z.IX(z.Z_())});return(0,ne.jsxs)(ne.Fragment,{children:[(null===o||void 0===o?void 0:o.extensions.code)===Z.ZB.PERMISSION_ERROR&&(0,ne.jsx)(Q.Z,{negative:!0,children:(0,ne.jsxs)(Q.Z.Header,{children:[(0,ne.jsx)(F.Z,{name:"ban"})," ",o.message,(0,ne.jsx)(F.Z,{"aria-label":"ban"})," ",o.message]})}),(0,ne.jsx)($.J9,{initialValues:x,onSubmit:function(e){l(e)},validateOnChange:!0,validationSchema:P,children:function(e){var n=e.handleSubmit,l=e.handleBlur,o=e.setFieldValue,a=e.errors,u=e.values,h=e.touched,Z=e.submitForm,x=function(e,n){g(e,n);var r=n.name,i=n.value,t=r.split("."),l=(0,f.Z)(t,2),a=l[0],s=l[1];m&&"label"===a&&s===v&&o("id",(0,M.GV)(i))},g=function(){var e=(0,c.Z)(b().mark((function e(n,r){var i,t,l;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="checkbox"===r.type,t=i?r.checked:r.value,l=r.name,e.next=5,o(l,t);case 5:case"end":return e.stop()}}),e)})));return function(n,r){return e.apply(this,arguments)}}(),_=function(){var e=(0,c.Z)(b().mark((function e(n,r){return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g(n,r);case 2:m||Z();case 3:case"end":return e.stop()}}),e)})));return function(n,r){return e.apply(this,arguments)}}(),P=function(e){return(0,M.zQ)(e,h,j||{},a)},k=function(e){m?l(e):Z()},y=function(e){"Enter"===e.key&&Z()};return(0,ne.jsxs)(pe,{onSubmit:function(){return n()},"aria-label":"infos-form",isNewProfile:m,children:[(0,ne.jsxs)(be,{children:[(0,ne.jsxs)(D.Z.Group,{grouped:!0,children:[(0,ne.jsx)("label",{children:s("admin.label")}),d.map((function(e){var n,r;return(0,ne.jsx)(N.Z,{error:P("label.".concat(e)),children:(0,ne.jsx)(D.Z.Input,{required:e===v,label:e,width:"4",name:"label.".concat(e),"aria-label":"label.".concat(e),disabled:p,onChange:x,onBlur:k,onKeyPress:y,value:null!==(n=null===(r=u.label)||void 0===r?void 0:r[e])&&void 0!==n?n:""})},e)}))]}),(0,ne.jsxs)(D.Z.Group,{grouped:!0,children:[(0,ne.jsx)("label",{children:s("admin.description")}),d.map((function(e){var n,r;return(0,ne.jsx)(N.Z,{error:P("description.".concat(e)),children:(0,ne.jsx)(D.Z.Input,{label:e,value:null!==(n=null===(r=u.description)||void 0===r?void 0:r[e])&&void 0!==n?n:"",width:"4",name:"description.".concat(e),"aria-label":"description.".concat(e),disabled:p,onChange:g,onBlur:k,onKeyPress:y})},e)}))]}),(0,ne.jsx)(N.Z,{error:P("id"),children:(0,ne.jsx)(D.Z.Input,{required:!0,label:s("admin.id"),width:"4",disabled:!m||p,name:"id","aria-label":"id",onChange:g,onBlur:k,value:u.id})}),(0,ne.jsx)(N.Z,{error:P("trees"),children:(0,ne.jsx)(O.Z,{label:s("version_profiles.trees"),placeholder:s("version_profiles.select_trees"),fluid:!0,selection:!0,multiple:!0,width:"4",disabled:p,name:"trees","aria-label":"id",onChange:_,onBlur:k,value:u.trees})}),!m&&(0,ne.jsx)(fe,{profile:t,readonly:r})]}),!r&&m&&(0,ne.jsx)(he,{children:(0,ne.jsxs)(D.Z.Button,{type:"submit",primary:!0,icon:!0,loading:i,"data-test-id":"attribute-infos-submit-btn",style:{float:"right"},labelPosition:"left",children:[(0,ne.jsx)(F.Z,{name:"save outline"}),s("admin.submit")]})})]})}})]})},xe=me;q.ZP.div(Ze||(Ze=(0,v.Z)(["\n    display: grid;\n    grid-template-rows: auto 1fr;\n"])));var ge=function(e){var n,r,i,t,l,o,a,s,u,d=e.match,v=(0,h.useApolloClient)(),p=(0,R.k6)(),_=(0,I.$G)().t,k=(0,g.Z)().lang,A=(0,j.Z)(),q=null!==(n=null===(r=d.params)||void 0===r?void 0:r.id)&&void 0!==n?n:null,B=!q,G=(0,h.useQuery)(y,{variables:{id:q},skip:B}),L=G.loading,N=G.error,O=G.data,$=(0,h.useMutation)(C,{onCompleted:function(e){B&&p.push("/version_profiles/edit/".concat(e.saveVersionProfile.id))},update:function(e){B&&e.evict({fieldName:"versionProfiles"})}}),D=(0,f.Z)($,2),F=D[0],Q=D[1],M=Q.loading,z=(Q.error,function(){var e=(0,c.Z)(b().mark((function e(n){return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,F({variables:{versionProfile:{id:n.id,description:n.description,label:n.label,trees:n.trees}}});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.error(e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(n){return e.apply(this,arguments)}}()),T=function(){var e=(0,c.Z)(b().mark((function e(n){var r,i,t;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return",!0);case 2:return e.prev=2,e.next=5,v.query({query:w.o,variables:{filters:{id:n}},errorPolicy:"all"});case 5:return t=e.sent,e.abrupt("return",!(null!==t&&void 0!==t&&null!==(r=t.data)&&void 0!==r&&null!==(i=r.versionProfiles)&&void 0!==i&&i.list.length));case 9:return e.prev=9,e.t0=e.catch(2),e.abrupt("return",!0);case 12:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(n){return e.apply(this,arguments)}}();if(L)return(0,ne.jsx)(x.Z,{});if(N)return(0,ne.jsx)(m.Z,{message:N.message});if(!B&&(null===O||void 0===O||null===(i=O.versionProfiles)||void 0===i||!i.list.length))return(0,ne.jsx)(m.Z,{message:_("version_profiles.not_found")});var U=null!==O&&void 0!==O&&null!==(t=O.versionProfiles)&&void 0!==t&&t.list.length?P()(null===O||void 0===O||null===(l=O.versionProfiles)||void 0===l||null===(o=l.list)||void 0===o?void 0:o[0],"__typename"):null,K=null!==(a=!(null!==A&&void 0!==A&&null!==(s=A.permissions)&&void 0!==s&&s[V.Au.admin_edit_version_profile]))&&void 0!==a&&a,H=null!==N&&void 0!==N&&null!==(u=N.graphQLErrors)&&void 0!==u&&u.length?N.graphQLErrors[0]:null,J=null!==U&&void 0!==U&&U.label?(0,Z.a0)(U.label,k):_("version_profiles.new");return(0,ne.jsxs)(ne.Fragment,{children:[(0,ne.jsxs)(E.Z,{children:[(0,ne.jsx)(E.Z.Content,{children:J}),(0,ne.jsx)(S.Z,{})]}),(0,ne.jsx)(xe,{profile:U,readonly:K,loading:M,errors:H,onCheckIdUniqueness:T,onSubmit:z})]})},je=ge},27593:function(e,n,r){var i=r(76729),t=r(99985),l=r(27964),o=r(70239);e.exports=function(e,n){return n=i(n,e),null==(e=l(e,n))||delete e[o(t(n))]}},69752:function(e,n,r){var i=r(67722);e.exports=function(e){return i(e)?void 0:e}},27964:function(e,n,r){var i=r(22374),t=r(72111);e.exports=function(e,n){return n.length<2?e:i(e,t(n,0,-1))}},99985:function(e){e.exports=function(e){var n=null==e?0:e.length;return n?e[n-1]:void 0}},88674:function(e,n,r){var i=r(26306),t=r(46817),l=r(27593),o=r(76729),a=r(79281),s=r(69752),u=r(36625),d=r(60699),c=u((function(e,n){var r={};if(null==e)return r;var u=!1;n=i(n,(function(n){return n=o(n,e),u||(u=n.length>1),n})),a(e,d(e),r),u&&(r=t(r,7,s));for(var c=n.length;c--;)l(r,n[c]);return r}));e.exports=c}}]);
//# sourceMappingURL=246.5400cc25.chunk.js.map