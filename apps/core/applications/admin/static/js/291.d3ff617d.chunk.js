"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[291],{70621:function(e,n,t){t.d(n,{Y:function(){return r}});var r="root"},90930:function(e,n,t){t.d(n,{Z:function(){return g}});var r,i=t(2867),a=t(54681),l=t(70621),o=t(71446),s=t(73218),d=t(22660),u=t(78053),c=t(33028),f=t(59740),v=t(71171),p=t(70663),h=t(85823),m=t(63851),b=t(37893),x=t(57450),_=["isSelected"],Z=(0,b.ZP)((function(e){e.isSelected;var n=(0,f.Z)(e,_);return(0,x.jsx)(h.Z.Item,(0,c.Z)({},n))}))(r||(r=(0,v.Z)(["\n    &&&&& {\n        background-color: ",";\n        text-align: left;\n        margin: 0.5em 0;\n        border: 1px solid #ddd;\n        border-radius: 3px;\n\n        :hover {\n            background-color: ",";\n        }\n    }\n"])),(function(e){return e.isSelected?"#DEF4FF":"none"}),(function(e){return e.isSelected?"#DEF4FF":"none"}));var y=function(e){var n=e.actions,t=e.type,r=e.selectedGroup,i=e.onSelect,a=(0,p.$G)().t,l=function(e){return function(){return i(e)}};return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(m.Z,{as:"h4",children:a("permissions.type.".concat(t))}),(0,x.jsx)(h.Z,{selection:!0,relaxed:!0,children:Object.keys(n).map((function(e){return(0,x.jsx)(Z,{onClick:l(e),isSelected:e===r,children:(0,x.jsx)(h.Z.Content,{children:a("permissions.group.".concat(e))})},e)}))})]})};var g=function(e){var n=e.applyTo,t=e.readOnly,r=e.type,c=e.actions,f=(0,a.useState)({node:{id:l.Y},path:[],treeIndex:0}),v=(0,i.Z)(f,2),p=v[0],h=v[1],m=(0,a.useState)(c?Object.keys(c)[0]:null),b=(0,i.Z)(m,2),_=b[0],Z=b[1],g=c?3:2,E=[];return c&&E.push((0,x.jsx)(y,{actions:c,type:r,selectedGroup:_,onSelect:function(e){Z(e)}})),c&&!_||E.push([(0,x.jsx)(d.Z,{treeId:"users_groups",onClick:function(e){return h((0,o.xN)(e)!==(0,o.xN)(p)?e:null)},selectedNode:p},"users_groups")]),p&&E.push((0,x.jsx)(u.Z,{permParams:{type:r,actions:null===c||void 0===c?void 0:c[_],applyTo:n,usersGroup:"root"!==p.node.id?p.node.id:null},readOnly:t})),(0,x.jsx)(s.Z,{columnsNumber:g,columnsContent:E})}},22660:function(e,n,t){t.d(n,{Z:function(){return v}});var r=t(80688),i=t(43157),a=t(24532),l=(t(54681),t(70663)),o=t(63851),s=t(74280),d=t(71446),u=t(64449),c=t(15098),f=t(57450),v=function(e){var n=e.treeId,t=e.onClick,v=e.selectedNode,p=(0,l.$G)().t,h=(0,s.Z)().lang,m=(0,r.useQuery)(a.F,{variables:{id:n}}),b=m.loading,x=m.error,_=m.data;if(b)return(0,f.jsx)(u.Z,{});if(x||null===_||void 0===_||!_.trees)return(0,f.jsx)(i.Z,{message:x.message});var Z=_.trees.list[0],y=(0,d.dX)(Z.label,h);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(o.Z,{as:"h4",children:y}),(0,f.jsx)(c.Z,{compact:!0,tree:Z,onClickNode:t,selection:v?[v]:null,readOnly:!0,withFakeRoot:!0,fakeRootLabel:p("permissions.any_entity",{entityName:y,interpolation:{escapeValue:!1}})},Z.id)]})}},78053:function(e,n,t){t.d(n,{Z:function(){return Q}});var r,i,a,l,o=t(34795),s=t(2867),d=t(33028),u=t(77162),c=t.n(u),f=t(80688),v=t(54681),p=t(71171),h=t(42737),m=t.n(h),b=m()(r||(r=(0,p.Z)(["\n    query GET_PERMISSIONS_ACTIONS($type: PermissionTypes!, $applyOn: String) {\n        permissionsActionsByType(type: $type, applyOn: $applyOn) {\n            name\n            label\n        }\n    }\n"]))),x=m()(i||(i=(0,p.Z)(["\n    query GET_PERMISSIONS(\n        $type: PermissionTypes!\n        $applyTo: ID\n        $actions: [PermissionsActions!]!\n        $usersGroup: ID\n        $permissionTreeTarget: PermissionsTreeTargetInput\n    ) {\n        perm: permissions(\n            type: $type\n            applyTo: $applyTo\n            actions: $actions\n            usersGroup: $usersGroup\n            permissionTreeTarget: $permissionTreeTarget\n        ) {\n            name\n            allowed\n        }\n        inheritPerm: inheritedPermissions(\n            type: $type\n            applyTo: $applyTo\n            actions: $actions\n            userGroupNodeId: $usersGroup\n            permissionTreeTarget: $permissionTreeTarget\n        ) {\n            name\n            allowed\n        }\n    }\n"]))),_=m()(a||(a=(0,p.Z)(["\n    mutation SAVE_PERMISSION($permData: PermissionInput!) {\n        savePermission(permission: $permData) {\n            type\n            applyTo\n            usersGroup\n            actions {\n                name\n                allowed\n            }\n            permissionTreeTarget {\n                nodeId\n                tree\n            }\n        }\n    }\n"]))),Z=t(64449),y=t(56666),g=t(37893),E=t(57450),T=g.ZP.img(l||(l=(0,p.Z)(["\n    transform: translate(0px, -1px) scale(1.5);\n    width: ",";\n"])),(function(e){var n;return null!==(n=null===e||void 0===e?void 0:e.size)&&void 0!==n?n:"1em"}));var I=function(e){var n=e.svg,t=e.label,r=e.size,i=e.style;return(0,E.jsx)("div",{style:(0,d.Z)({width:r,height:r,display:"inline-block"},i),children:(0,E.jsx)(T,{src:n,alt:t,size:r})})};var j=t.p+"static/media/PermissionsAllowedIcon.dfca86616d4fa8c2b789273f9d065a54.svg",R=function(){return(0,E.jsx)(I,{svg:j,label:"permissions allowed"})};var S=t.p+"static/media/PermissionsForbiddenIcon.0a25cc0d325b292d7c28b4fc52cee7ec.svg",C=function(){return(0,E.jsx)(I,{svg:S,label:"permissions allowed"})};var N=t.p+"static/media/PermissionsInheritIcon.9fe2c684b2548cadf2231120c9668797.svg",A=function(){return(0,E.jsx)(I,{svg:N,label:"permissions allowed"})},k=t(70663),w=t(63851),O=t(31010),D=t(74280),L=t(19913),F=t(15280),V=t.n(F),$=t(35925);function P(e){var n=e.value,t=e.inheritValue,r=e.as,i=e.onChange,a=e.forbiddenColor,l=e.allowedColor,d=e.readOnly,u=v.useState(!1),f=(0,s.Z)(u,2),p=f[0],h=f[1],m=function(e){return!1===e?0:null===e?1:2},b={0:!1,1:null,2:!0},x={0:a,1:"#FFFFFF",2:l},_=m(n),y=null!==n?x[_]:V()(x[m(t)],40),g=r;g.displayName="Wrapper";var T=function(){var e=(0,o.Z)(c().mark((function e(n,t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h(!0),e.next=3,i(b[t.value]);case 3:h(!1);case 4:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}();return(0,E.jsx)(g,{style:{background:y},children:p?(0,E.jsx)(Z.Z,{size:"tiny",withLabel:!1}):(0,E.jsx)($.Z,{"aria-label":"permission-selector",type:"range",min:"0",max:"2",step:"1",value:_,disabled:d,style:{border:"none"},onChange:T,transparent:!0,fluid:!0})})}P.defaultProps={readOnly:!1};var G,M=P,B=g.ZP.div(G||(G=(0,p.Z)(["\n    display: flex;\n    flex-direction: row;\n    justify-content: space-between;\n"]))),H=function(e){var n=e.permissions,t=e.actions,r=e.inheritedPermissions,i=e.onChange,a=e.readOnly,l=void 0!==a&&a,o=(0,k.$G)().t,s=(0,D.Z)().lang,u=n.reduce((function(e,n){return(0,d.Z)((0,d.Z)({},e),{},(0,y.Z)({},n.name,n.allowed))}),{}),c=r.reduce((function(e,n){return(0,d.Z)((0,d.Z)({},e),{},(0,y.Z)({},n.name,n.allowed))}),{});return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(w.Z,{as:"h4",children:o("permissions.permission_col_name")}),(0,E.jsxs)(O.Z,{celled:!0,children:[(0,E.jsx)(O.Z.Header,{children:(0,E.jsxs)(O.Z.Row,{children:[(0,E.jsx)(O.Z.HeaderCell,{width:10}),(0,E.jsx)(O.Z.HeaderCell,{width:6,children:(0,E.jsxs)(B,{children:[(0,E.jsx)(C,{}),(0,E.jsx)(A,{}),(0,E.jsx)(R,{})]})})]})}),(0,E.jsx)(O.Z.Body,{children:t.map((function(e){var n;if(void 0===typeof u[e.name])return null;return(0,E.jsxs)(O.Z.Row,{children:[(0,E.jsx)(O.Z.Cell,{children:(0,E.jsx)("p",{children:(0,L.dX)(e.label,s)})}),(0,E.jsx)(M,{as:O.Z.Cell,value:null!==(n=u[e.name])&&void 0!==n?n:null,inheritValue:c[e.name],onChange:function(n){return i({name:e.name,allowed:n})},forbiddenColor:"#FF0000",allowedColor:"#99cc00",readOnly:l})]},e.name)}))})]})]})},U=function(e){var n,t=e.permParams,r=e.readOnly,i=void 0!==r&&r,a=(0,f.useQuery)(b,{variables:{type:t.type,applyOn:t.applyTo},fetchPolicy:"network-only",notifyOnNetworkStatusChange:!0}),l=a.loading,u=a.error,v=a.data,p=(null!==(n=null===v||void 0===v?void 0:v.permissionsActionsByType)&&void 0!==n?n:[]).filter((function(e){var n;return!t.actions||(null===(n=t.actions)||void 0===n?void 0:n.includes(e.name))})),h=(0,d.Z)((0,d.Z)({},t),{},{actions:p.map((function(e){return e.name}))}),m=(0,f.useQuery)(x,{variables:h,fetchPolicy:"network-only",notifyOnNetworkStatusChange:!0,skip:!v}),y=m.loading,g=m.error,T=m.data,I=(0,f.useMutation)(_),j=(0,s.Z)(I,1)[0];if(l||y)return(0,E.jsx)(Z.Z,{});if(g||u||null===T||void 0===T||!T.perm||null===T||void 0===T||!T.inheritPerm)return(0,E.jsxs)("div",{className:"error","data-test-id":"error",children:["Error fetching permissions ",null===u||void 0===u?void 0:u.toString()," ",null===g||void 0===g?void 0:g.toString()]});var R=function(){var e=(0,o.Z)(c().mark((function e(n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j({variables:{permData:(0,d.Z)((0,d.Z)({},t),{},{actions:[n]})},refetchQueries:[{query:x,variables:h}]});case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,E.jsx)(H,{onChange:R,actions:p,permissions:T.perm,inheritedPermissions:T.inheritPerm,readOnly:i})},Q=U},98132:function(e,n,t){t.d(n,{Z:function(){return $e}});var r,i,a,l,o,s=t(2867),d=t(54681),u=t(70663),c=t(33495),f=t(92042),v=t(55152),p=t(19046),h=t(80688),m=t(18758),b=t(64449),x=t(41361),_=t(34795),Z=t(77162),y=t.n(Z),g=t(33722),E=t(74280),T=t(71171),I=t(42737),j=t.n(I),R=t(50500),S=j()(r||(r=(0,T.Z)(["\n    ","\n    mutation CREATE_RECORD($library: ID!) {\n        createRecord(library: $library) {\n            id\n            ...RecordIdentity\n        }\n    }\n"])),R.T),C=t(19913),N=t(52987),A=j()(i||(i=(0,T.Z)(["\n    fragment ValueDetails on GenericValue {\n        id_value\n        created_at\n        modified_at\n        version {\n            treeId\n            treeNode {\n                id\n                record {\n                    id\n                    whoAmI {\n                        id\n                        label\n                        library {\n                            id\n                        }\n                    }\n                }\n            }\n        }\n        metadata {\n            name\n            value {\n                value\n                raw_value\n            }\n        }\n\n        ... on Value {\n            value\n            raw_value\n        }\n\n        ... on LinkValue {\n            linkValue: value {\n                ...RecordIdentity\n            }\n        }\n\n        ... on TreeValue {\n            treeValue: value {\n                record {\n                    ...RecordIdentity\n                }\n                ancestors {\n                    record {\n                        ...RecordIdentity\n                    }\n                }\n            }\n        }\n    }\n"]))),k=j()(a||(a=(0,T.Z)(["\n    fragment ValueDetailsExtended on GenericValue {\n        id_value\n        created_at\n        modified_at\n        version {\n            treeId\n            treeNode {\n                id\n                record {\n                    id\n                    whoAmI {\n                        id\n                        label\n                        library {\n                            id\n                        }\n                    }\n                }\n            }\n        }\n        metadata {\n            name\n            value {\n                value\n                raw_value\n            }\n        }\n\n        ... on Value {\n            id_value\n        }\n\n        ... on LinkValue {\n            linkValue: value {\n                ...RecordIdentity\n            }\n        }\n\n        ... on TreeValue {\n            treeValue: value {\n                record {\n                    ...RecordIdentity\n                }\n                ancestors {\n                    record {\n                        ...RecordIdentity\n                    }\n                }\n            }\n        }\n    }\n"]))),w=function(e){var n,t=e.id;switch(e.format){case N.aZ.extended:n="".concat(t,': property(attribute: "').concat(t,'") { ...ValueDetailsExtended }');break;case N.aZ.text:default:n="".concat(t,': property(attribute: "').concat(t,'") { ...ValueDetails }')}return n};function O(e,n){var t=n.find((function(e){return e.format===N.aZ.extended}))?k:"";return(0,C.FQ)(l||(l=(0,T.Z)(["\n        ","\n        ","\n        ","\n\n        query ","($id: String!, $version: [ValueVersionInput]) {\n            record: ",'(filters: {field: "id", condition: EQUAL, value: $id}, version: $version) {\n                list {\n                    ...RecordIdentity\n                    ',"\n                }\n            }\n        }\n    "])),R.T,A,t,"RECORD_DATA_".concat(e.id),e.gqlNames.query,n.map(w))}var D,L,F=j()(o||(o=(0,T.Z)(["\n    ","\n    mutation SAVE_VALUE_BATCH(\n        $library: ID!\n        $recordId: ID!\n        $version: [ValueVersionInput!]\n        $values: [ValueBatchInput!]!\n    ) {\n        saveValueBatch(library: $library, recordId: $recordId, version: $version, values: $values) {\n            values {\n                id_value\n                modified_at\n                created_at\n                version {\n                    treeId\n                    treeNode {\n                        id\n                        record {\n                            id\n                            whoAmI {\n                                id\n                                label\n                                library {\n                                    id\n                                }\n                            }\n                        }\n                    }\n                }\n                attribute {\n                    id\n                }\n\n                ... on Value {\n                    value\n                    raw_value\n                }\n\n                ... on LinkValue {\n                    linkValue: value {\n                        ...RecordIdentity\n                    }\n                }\n\n                ... on TreeValue {\n                    treeValue: value {\n                        record {\n                            ...RecordIdentity\n                        }\n\n                        ancestors {\n                            record {\n                                ...RecordIdentity\n                            }\n                        }\n                    }\n                }\n            }\n            errors {\n                type\n                attribute\n                input\n                message\n            }\n        }\n    }\n"])),R.T),V=t(38777),$=t(33028),P=t(91492),G=t(5168),M=t(43248),B=t(31010),H=t(69356),U=t(37893),Q=t(42538),q=t(73377),Y=t(1385),z=t(5918),W=t(57450),K=(0,U.ZP)(B.Z.Row)(D||(D=(0,T.Z)(["\n    position: relative;\n    padding: 0;\n"]))),X=(0,U.ZP)(Y.Z)(L||(L=(0,T.Z)(["\n    &&& {\n        position: absolute;\n        background: none;\n        box-shadow: 0 0 40px 20px #444 inset;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        margin: 0;\n        border-radius: 0;\n    }\n"]))),J=function(e){var n=e.value,t=e.onDeleteLink,r=e.readonly,i=void 0!==r&&r,a=(0,u.$G)().t,l=(0,d.useState)(!1),o=(0,s.Z)(l,2),c=o[0],f=o[1],h=(0,d.useState)(!1),m=(0,s.Z)(h,2),b=m[0],x=m[1],_=(0,d.useState)(!1),Z=(0,s.Z)(_,2),y=Z[0],g=Z[1];return(0,W.jsx)(W.Fragment,{children:n.linkValue&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(K,{"data-test-id":"link_element_wrapper",onMouseEnter:function(){return f(!0)},onMouseLeave:function(){return f(!1)},style:{position:"relative"},className:"my_row",children:(0,W.jsxs)(B.Z.Cell,{style:{position:"relative"},children:[(0,W.jsx)(p.Z,{record:n.linkValue.whoAmI}),c&&(0,W.jsxs)(X,{"data-test-id":"link_element_hover_menu",size:"small",inverted:!0,children:[(0,W.jsxs)(Y.Z.Item,{"data-test-id":"edit_record_btn",size:"big",onClick:function(){return g(!0)},children:[(0,W.jsx)(v.Z,{name:"edit outline",size:"large"}),a("records.edit")]}),!i&&(0,W.jsxs)(Y.Z.Item,{"data-test-id":"delete_link_btn",size:"big",onClick:function(){return x(!0)},children:[(0,W.jsx)(v.Z,{name:"trash alternate",size:"large"}),a("records.delete_link")]})]})]})},"".concat(n.id_value,"_").concat(n.linkValue.whoAmI.id)),(0,W.jsx)($e,{open:y,onClose:function(){return g(!1)},recordId:n.linkValue.whoAmI.id,library:n.linkValue.whoAmI.library.id}),!i&&(0,W.jsx)(z.Z,{"data-test-id":"delete_confirm_modal",open:b,onCancel:function(){return x(!1)},onConfirm:function(){return t(n)},content:a("records.delete_confirm")})]})})},ee=t(25154);var ne,te,re,ie=function(e){var n=e.value,t=e.readOnly,r=e.onDeleteLink,i=(0,u.$G)().t,a=(0,d.useState)(!1),l=(0,s.Z)(a,2),o=l[0],c=l[1],f=(0,d.useState)(null),v=(0,s.Z)(f,2),p=v[0],h=v[1];if(!n.treeValue)return(0,W.jsx)(B.Z.Row,{children:(0,W.jsx)(B.Z.Cell,{children:"Invalid value"})});var m=[{text:i("records.edit"),icon:"edit outline",action:function(e){h(e),c(!0)}}];return t||m.push({text:i("records.delete_link"),icon:"trash alternate outline",action:function(){return r(n)},displayFilter:function(e){var t;return e.id===(null===(t=n.treeValue)||void 0===t?void 0:t.record.whoAmI.id)}}),(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(B.Z.Row,{children:(0,W.jsx)(B.Z.Cell,{children:(0,W.jsx)(ee.Z,{element:n.treeValue,actions:m})})}),o&&!!p&&(0,W.jsx)($e,{library:p.library.id,recordId:p.id,open:o,onClose:function(){return c(!1)}})]})},ae=U.ZP.div(ne||(ne=(0,T.Z)(["\n    float: right;\n"]))),le=U.ZP.div(te||(te=(0,T.Z)(["\n    margin-bottom: 1em;\n"]))),oe=(0,U.ZP)(f.Z)(re||(re=(0,T.Z)(["\n    &&& {\n        margin-left: 1em;\n    }\n"])));var se=function(e){var n=e.values,t=e.attribute,r=e.onChange,i=e.readonly,a=(0,u.$G)().t,l=(0,E.Z)().lang,o=(0,d.useState)(!1),c=(0,s.Z)(o,2),f=c[0],v=c[1],p=(0,d.useState)(!1),h=(0,s.Z)(p,2),m=h[0],b=h[1],x=(0,d.useState)(!1),_=(0,s.Z)(x,2),Z=_[0],y=_[1],g=n.filter((function(e){return null!==e})),T=function(){return v(!1)},I=function(){return y(!1)},j=function(e){return function(n){r({linkValue:null,id_value:n.id_value,modified_at:null,created_at:null,version:null},e)}},R=(0,W.jsx)(oe,{type:"button",content:a("records.add_value"),icon:"plus",compact:!0,basic:!0,labelPosition:"left",onClick:function(e){t.type===N.GC.tree&&y(!0)}}),S=!i&&(t.multiple_values||!g.length);return(0,W.jsxs)(le,{id:"inputField",children:[(0,W.jsxs)(B.Z,{"data-test-id":"link_values",compact:"very",children:[(0,W.jsx)(B.Z.Header,{children:(0,W.jsx)(B.Z.Row,{children:(0,W.jsxs)(B.Z.HeaderCell,{children:[(0,W.jsx)("label",{children:(0,C.dX)(t.label,l)}),S&&(0,C.NE)(t)&&t.linked_library&&(0,W.jsx)(H.Z,{trigger:R,icon:!1,children:(0,W.jsxs)(H.Z.Menu,{children:[(0,W.jsx)(H.Z.Item,{"data-test-id":"add_value_btn",onClick:function(){return v(!0)},icon:"search",text:a("records.select_record")}),(0,W.jsx)(H.Z.Item,{"data-test-id":"add_value_create_btn",onClick:function(){return b(!0)},icon:"plus circle",text:a("records.create_record")})]})}),S&&t.type===N.GC.tree&&R,(0,W.jsx)(ae,{"data-test-id":"elements_count",children:a("records.links_elements_count",{count:n?g.length:0})})]})})}),(0,W.jsx)(B.Z.Body,{children:g.map((function(e,n){if(!(!e||(0,C.nV)(e)&&!e.linkValue||(0,C.ci)(e)&&!e.treeValue))return(0,C.NE)(t)?(0,W.jsx)(J,{value:e,onDeleteLink:j(n),readonly:i},"".concat(e.id_value,"_").concat(e.linkValue.whoAmI.id)):(0,W.jsx)(ie,{value:e,onDeleteLink:j(n)},"".concat(e.id_value,"_").concat(e.treeValue.record.whoAmI.id))}))})]}),!i&&(0,C.NE)(t)&&t.linked_library&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(q.Z,{open:f,library:t.linked_library.id,onSelect:function(e){r({linkValue:{id:e.id,whoAmI:e},id_value:null,modified_at:null,created_at:null,version:null},n.length),T()},onClose:T}),t.linked_library&&(0,W.jsx)($e,{library:t.linked_library.id,open:m,onClose:function(e){e&&r({linkValue:{id:e.id,whoAmI:e},id_value:null,modified_at:null,created_at:null,version:null},n.length),b(!1)}})]}),!i&&(0,C.TB)(t)&&t.linked_tree&&(0,W.jsx)(Q.Z,{open:Z,onClose:I,tree:t.linked_tree.id,onSelect:function(e){var t=e.node,i={treeValue:{id:t.id,record:{whoAmI:t.record.whoAmI},ancestors:t.parents.map((function(e){return{record:{whoAmI:e.record.whoAmI}}}))},id_value:null,modified_at:null,created_at:null,version:null};r(i,n.length),I()}})]})},de=function(e){var n={id_value:null,modified_at:null,created_at:null,version:null};switch(e.type){case N.GC.simple_link:case N.GC.advanced_link:return(0,$.Z)((0,$.Z)({},n),{},{linkValue:null});case N.GC.tree:return(0,$.Z)((0,$.Z)({},n),{},{treeValue:null});default:return(0,$.Z)((0,$.Z)({},n),{},{value:null,raw_value:null})}},ue=function(e){var n=e.onSave,t=e.attributes,r=e.setSubmitFuncRef,i=e.errors,a=void 0===i?{}:i,l=e.inModal,o=void 0!==l&&l,s=(0,u.$G)().t,c=(0,E.Z)().lang,p=(0,d.useRef)(null);(0,d.useEffect)((function(){r&&r(p)}),[r]);var h=Object.keys(t).reduce((function(e,n){return e[n]=[(0,$.Z)({},de(t[n]))],e}),{});return(0,W.jsx)(P.J9,{render:function(e){var n=e.values,r=e.handleSubmit,i=e.setFieldValue,l=function(e,t){var r="checkbox"===t.type?t.checked:t.value,a=t.name,l=n[a].map((function(e,n){var i=n===t["data-index"]?r:e.value;return(0,$.Z)((0,$.Z)({},e),{},{value:i})}));i(a,l)},d=function(e){return function(){var t=n[e].map((function(e){return(0,$.Z)({},e)}));t.push({value:"",id_value:null}),i(e,t)}},u=function(e,t,r){if((0,C.NE)(e,!1))return(0,W.jsx)(se,{values:t,attribute:e,onChange:(a=e.id,function(e,t){var r;(0,C.AX)(e)?(r=(0,V.Z)(n[a]),r=[].concat((0,V.Z)(r.slice(0,t)),(0,V.Z)(r.slice(t+1)))):r=[].concat((0,V.Z)(n[a]),[e]),i(a,r)}),readonly:r});var a;t.length||t.push((0,$.Z)({},de(e)));var o=(0,C.dX)(e.label,c),u=!r&&(e.multiple_values||!t.length);return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)("label",{style:{display:"inline"},children:o}),u&&(0,W.jsxs)(f.Z,{type:"button",size:"mini",compact:!0,basic:!0,icon:!0,labelPosition:"right",style:{margin:"5px"},onClick:d(e.id),"data-test-id":"add_value_btn",children:[(0,W.jsx)(v.Z,{name:"plus"}),s("records.add_value")]}),t.map((function(n,t){return(0,W.jsx)(G.Z.Input,{name:e.id,value:(null===n||void 0===n?void 0:n.value)||"","data-index":t,onChange:l,disabled:r},e.id+"_"+t)}))]})};return p.current=r,(0,W.jsxs)(G.Z,{onSubmit:r,children:[Object.keys(t).map((function(e){var r,i,l;return(0,W.jsx)(M.Z,{error:null!==(r=null===(i=a[e])||void 0===i?void 0:i.message)&&void 0!==r?r:"",children:u(t[e],n[e],(l=t[e],l.system))},e)})),!o&&(0,W.jsx)(G.Z.Group,{children:(0,W.jsxs)(G.Z.Button,{type:"submit",positive:!0,children:[(0,W.jsx)(v.Z,{name:"checkmark"})," ",s("admin.submit")]})})]})},initialValues:h,onSubmit:n,enableReinitialize:!0})},ce=function(e,n){var t;switch(n.type){case N.GC.advanced_link:case N.GC.simple_link:t=null!==e.linkValue?e.linkValue.whoAmI.id:null;break;case N.GC.tree:t=null!==e.treeValue?[e.treeValue.record.whoAmI.library.id,e.treeValue.record.whoAmI.id].join("/"):null;break;default:t=null!==e?e.value:null}return t};var fe,ve,pe,he,me,be=function(e){var n=e.attributes,t=e.library,r=e.recordId,i=e.valueVersion,a=e.onIdentityUpdate,l=e.setSubmitFunc,o=e.onPostSave,u=e.inModal,c=void 0!==u&&u,f=(0,d.useMemo)((function(){return n.reduce((function(e,n){return e[n.id]=n,e}),{})}),[n]),v=(0,E.Z)().lang,p=(0,d.useState)(r||""),m=(0,s.Z)(p,2),Z=m[0],T=m[1],I=(0,d.useState)(!1),j=(0,s.Z)(I,2),R=j[0],N=j[1],A=O(t,n),k=(0,h.useQuery)(A,{variables:{id:Z,version:(0,C.aW)(i||null),lang:v},skip:!Z||R,fetchPolicy:"no-cache"}),w=k.loading,D=k.error,L=k.data,V=k.refetch,$=k.networkStatus,P=(0,h.useMutation)(F),G=(0,s.Z)(P,2),M=G[0],B=G[1].data,H=(0,h.useMutation)(S),U=(0,s.Z)(H,1)[0],Q=(0,d.useCallback)((function(e){return e&&e.record.list[0].whoAmI?e.record.list[0].whoAmI:{id:"",library:{id:"",label:null},label:null,color:null,preview:null}}),[]);(0,d.useEffect)((function(){a&&L&&L.record&&L.record.list.length&&a(Q(L))}),[a,Q,L,t,Z]);var q=function(){var e=(0,_.Z)(y().mark((function e(n){var r,a,l,s,d,u;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return N(!0),a=Object.keys(n).filter((function(e){return!!f[e]&&!f[e].system})).reduce((function(e,t){var r,i=(0,x.Z)(n[t]);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(a&&!(0,C.AX)(a)){var l=ce(a,f[t]);""!==l&&e.push({attribute:t,id_value:a?a.id_value:null,value:l})}}}catch(o){i.e(o)}finally{i.f()}return e}),[]),l=function(e){return M({variables:{library:t.id,recordId:e,version:i?(0,C.aW)(i):null,values:a}})},e.next=5,U({variables:{library:t.id}});case 5:if(!(d=e.sent)||!d.data){e.next=11;break}return T(d.data.createRecord.id),e.next=10,l(d.data.createRecord.id);case 10:s=e.sent;case 11:return N(!1),e.next=14,V();case 14:u=e.sent,o&&null!==(r=s)&&void 0!==r&&r.data&&!s.data.errors&&!s.data.saveValueBatch.errors&&s.data.saveValueBatch.values&&o(Q(u.data));case 16:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();if(D)return(0,W.jsx)("p",{className:"error",children:"ERROR"});if(w||Z&&$!==g.Ie.ready)return(0,W.jsx)(b.Z,{withDimmer:!0});if(Z&&(!L||!L.record||!L.record.list.length))return(0,W.jsx)("p",{children:"Unknown record"});var Y=B&&B.saveValueBatch&&B.saveValueBatch.errors?B.saveValueBatch.errors.reduce((function(e,n){return e[n.attribute]=n,e}),{}):{};return(0,W.jsx)(ue,{onSave:q,attributes:f,errors:Y,setSubmitFuncRef:l,inModal:c})},xe=be,_e=j()(fe||(fe=(0,T.Z)(["\n    mutation DELETE_VALUE($library: ID!, $recordId: ID!, $attribute: ID!, $valueId: ID) {\n        deleteValue(library: $library, recordId: $recordId, attribute: $attribute, valueId: $valueId) {\n            attribute {\n                id\n            }\n            id_value\n        }\n    }\n"]))),Ze=j()(ve||(ve=(0,T.Z)(["\n    ","\n    mutation SAVE_VALUE($library: ID!, $recordId: ID!, $attribute: ID!, $value: ValueInput!) {\n        saveValue(library: $library, recordId: $recordId, attribute: $attribute, value: $value) {\n            id_value\n\n            attribute {\n                id\n            }\n\n            ... on Value {\n                value\n                raw_value\n            }\n\n            ... on LinkValue {\n                linkValue: value {\n                    ...RecordIdentity\n                }\n            }\n\n            ... on TreeValue {\n                treeValue: value {\n                    record {\n                        ...RecordIdentity\n                    }\n                }\n            }\n        }\n    }\n"])),R.T),ye=t(71446),ge=t(35925),Ee=(0,U.ZP)(f.Z.Group)(pe||(pe=(0,T.Z)(["\n    &&& {\n        position: absolute;\n        top: 0;\n        right: 0;\n        float: right;\n        border-radius: 0;\n        bottom: 0;\n        border-right: none;\n        border-top: none;\n        border-bottom: none;\n    }\n"]))),Te=(0,U.ZP)(G.Z.Field)(he||(he=(0,T.Z)(["\n    position: relative;\n"]))),Ie=(0,U.ZP)(ge.Z)(me||(me=(0,T.Z)(["\n    & input:focus {\n        padding-right: 120px;\n    }\n"])));Ie.displayName="Input";var je,Re=function(e){var n,t=e.value,r=e.attribute,i=e.readonly,a=e.onChange,l=e.onSubmit,o=e.onDelete,c=e.onCancel,v=(0,u.$G)().t,p=(0,d.useState)(!1),h=(0,s.Z)(p,2),m=h[0],b=h[1];(0,d.useEffect)((function(){return function(){n&&(b(!1),clearTimeout(n))}}));var x=function(){l(),b(!1)};return(0,W.jsxs)(Te,{"data-test-id":"input-wrapper",style:{marginBottom:"15px"},id:r.id,children:[(0,W.jsx)(Ie,{fluid:!0,type:"text",name:"".concat(r.id,"_").concat((null===t||void 0===t?void 0:t.id_value)||"newVal"),value:(null===t||void 0===t?void 0:t.value)||"",disabled:i,onFocus:function(){return b(!0)},onChange:function(e){a(e.target.value),b(!0)},onKeyPress:function(e){"Enter"===e.key&&(x(),e.target.blur()),b(!1)},onBlur:function(e){n=setTimeout((function(){return b(!1)}),150)}},"".concat(r.id,"_").concat((null===t||void 0===t?void 0:t.id_value)||"newVal")),m&&(0,W.jsxs)(Ee,{basic:!0,size:"small",children:[(0,W.jsx)(f.Z,{onClick:function(){c(),b(!1)},className:"record-input-btn","data-test-id":"cancel-btn",title:v("admin.cancel"),icon:"undo"}),(0,W.jsx)(f.Z,{onClick:function(){o(),b(!1)},className:"record-input-btn","data-test-id":"delete-btn",title:v("attributes.remove_value"),icon:"trash"}),(0,W.jsx)(f.Z,{onClick:x,className:"record-input-btn","data-test-id":"submit-btn",title:v("admin.submit"),icon:"check"})]})]})};!function(e){e.REINIT="REINIT",e.ADD="ADD",e.CHANGE="CHANGE",e.SUBMIT="SUBMIT",e.DELETE="DELETE",e.CANCEL="CANCEL"}(je||(je={}));var Se,Ce,Ne={id_value:null,value:"",raw_value:"",modified_at:null,created_at:null,version:null},Ae=function(e,n){var t,r=(null===n||void 0===n||null===(t=n.data)||void 0===t?void 0:t.valueIndex)||0;switch(n.type){case je.REINIT:var i,a;return{values:(null===n||void 0===n||null===(i=n.data)||void 0===i?void 0:i.values)||[],initialValues:(null===n||void 0===n||null===(a=n.data)||void 0===a?void 0:a.values)||[]};case je.ADD:return(0,$.Z)((0,$.Z)({},e),{},{values:[].concat((0,V.Z)(e.values),[(0,$.Z)({},Ne)])});case je.CHANGE:var l,o=(0,$.Z)((0,$.Z)({},e),{},{values:(0,V.Z)(e.values)}),s=(0,$.Z)((0,$.Z)({},o.values[r]),{},{value:(null===n||void 0===n||null===(l=n.data)||void 0===l?void 0:l.newValue)||""});return o.values[r]=s,o;case je.SUBMIT:var d=(0,$.Z)((0,$.Z)({},e),{},{initialValues:(0,V.Z)(e.initialValues)});return d.initialValues[r]=e.values[r],d;case je.DELETE:var u=(0,$.Z)({},e);return u.values=[].concat((0,V.Z)(u.values.slice(0,r)),(0,V.Z)(u.values.slice(r+1))),u.values.length||u.values.push((0,$.Z)({},Ne)),u;case je.CANCEL:var c=(0,$.Z)((0,$.Z)({},e),{},{values:(0,V.Z)(e.values)});return c.values[r]=e.initialValues[r],c;default:return e}},ke=function(e){var n=(Array.isArray(e)?e:[e]).filter((function(e){return null!==e}));return n.length||n.push({id_value:null,value:"",raw_value:"",modified_at:null,created_at:null,version:null}),n},we=U.ZP.label(Se||(Se=(0,T.Z)(["\n    font-weight: bold;\n    margin-bottom: 0.5em;\n"]))),Oe=U.ZP.div(Ce||(Ce=(0,T.Z)(["\n    position: relative;\n"])));var De=function(e){var n=e.attribute,t=e.values,r=e.readonly,i=e.onSubmit,a=e.onDelete,l=(0,u.$G)().t,o=(0,E.Z)().lang,c=(0,C.dX)(n.label,o),p=ke(t),h=(0,d.useReducer)(Ae,{values:p,initialValues:p}),m=(0,s.Z)(h,2),b=m[0],x=m[1],_=b.values;(0,d.useEffect)((function(){x({type:je.REINIT,data:{values:ke(t)}})}),[t]);var Z=function(e){var n=b.values[e];return{id_value:n.id_value,value:String(n.value)}},y=function(e){return function(){x({type:je.SUBMIT,data:{valueIndex:e}}),i(Z(e))}},g=function(e){return function(){x({type:je.DELETE,data:{valueIndex:e}}),(_[e].id_value||n.type===N.GC.simple)&&a(Z(e))}},T=function(e){return function(){x({type:je.CANCEL,data:{valueIndex:e}})}},I=!r&&(n.multiple_values||!_.length);return(0,W.jsxs)(Oe,{"data-test-id":"input-wrapper",style:{marginBottom:"15px"},id:n.id,children:[(0,W.jsx)(we,{children:c}),I&&(0,W.jsxs)(f.Z,{type:"button",size:"mini",compact:!0,basic:!0,icon:!0,labelPosition:"right",style:{margin:"5px"},onClick:function(){x({type:je.ADD})},"data-test-id":"add_value_btn",id:n.id,children:[(0,W.jsx)(v.Z,{name:"plus",id:n.id}),l("records.add_value")]}),_.map((function(e,t){return(0,W.jsx)(Re,{attribute:n,value:e,readonly:r,onChange:(i=t,function(e){x({type:je.CHANGE,data:{valueIndex:i,newValue:e}})}),onSubmit:y(t),onDelete:g(t),onCancel:T(t)},n.id+"_"+t);var i}))]},n.id)},Le=function(e){var n=e.attributes,t=e.onIdentityUpdate,r=(e.errors,e.inModal,e.library),i=e.valueVersion,a=e.initialRecordId,l=e.setRecordIdentity,o=(0,E.Z)().lang,u=void 0===a?"":a,c=O(r,n),f={id:u,version:(0,C.aW)(i||null),lang:o},v=(0,h.useQuery)(c,{variables:f,skip:!u}),p=v.loading,m=v.error,x=v.data,_=v.networkStatus,Z=(0,h.useMutation)(_e,{refetchQueries:[{query:c,variables:f}]}),y=(0,s.Z)(Z,1)[0],T=(0,h.useMutation)(Ze,{refetchQueries:[{query:c,variables:f}]}),I=(0,s.Z)(T,1)[0],j=(0,d.useCallback)((function(e){return e&&e.record.list[0].whoAmI?e.record.list[0].whoAmI:{id:"",library:{id:"",label:null},label:null,color:null,preview:null}}),[]);if((0,d.useEffect)((function(){t&&x&&x.record&&x.record.list.length&&t(j(x))}),[t,j,x,r,u]),m)return(0,W.jsxs)("p",{className:"error",children:["ERROR $",m.message]});if(p||u&&_!==g.Ie.ready)return(0,W.jsx)(b.Z,{withDimmer:!0});if(u&&(!x||!x.record||!x.record.list.length))return(0,W.jsx)("p",{children:"Unknown record"});var R=u?Object.keys(x.record.list[0]).reduce((function(e,n){return"__typename"!==n&&(e[n]=x.record.list[0][n]),e}),{}):{};l&&l(R.whoAmI);var S=function(e){return function(n){return I({variables:{library:r.id,recordId:u,attribute:e.id,value:n}})}},N=function(e){return function(n){y({variables:{library:r.id,recordId:u,attribute:e.id,valueId:n.id_value}})}};return(0,W.jsx)(W.Fragment,{children:n&&n.map((function(e){return function(e){var n=R[e.id];if((0,C.NE)(e,!1))return(0,W.jsx)(se,{values:n,attribute:e,readonly:e.system,onChange:function(n){var t,r;if((0,ye.nV)(n)&&null===n.linkValue||(0,ye.ci)(n)&&null===n.treeValue)return N(e)({id_value:n.id_value,value:null});var i={id_value:n.id_value,value:(0,ye.ci)(n)?null===(t=n.treeValue)||void 0===t?void 0:t.id:null===(r=n.linkValue)||void 0===r?void 0:r.id};return S(e)(i)}},e.id);return(0,W.jsx)(De,{values:n,attribute:e,readonly:e.readonly,onSubmit:S(e),onDelete:N(e)},e.id)}(e)}))})};var Fe=function(e){var n=e.initialRecordId,t=e.library,r=e.setRecordIdentity,i=e.onIdentityUpdate,a=t&&t.attributes?t.attributes:[];return(0,W.jsx)(Le,{attributes:a,errors:{},inModal:!0,library:t,onIdentityUpdate:i,initialRecordId:n,setRecordIdentity:r})};var Ve=function(e){var n=e.library,t=e.recordId,r=(e.version,e.onIdentityUpdate),i=e.setSubmitFunc,a=e.onPostSave,l=e.inModal,o=void 0!==l&&l,s=(0,h.useQuery)(m.w,{variables:{id:n}}),d=s.data,u=s.loading,c=s.error;if(u)return(0,W.jsx)(b.Z,{withDimmer:!0});if(c)return(0,W.jsx)("p",{className:"error",children:"ERROR"});if(!d||!d.libraries||!d.libraries.list)return(0,W.jsx)("p",{children:"Unknown library"});var f=d.libraries.list[0],v=f.attributes||[];return(0,W.jsx)(W.Fragment,{children:t?(0,W.jsx)(Fe,{initialRecordId:t,library:f,onIdentityUpdate:r}):(0,W.jsx)(xe,{onPostSave:a,attributes:v,setSubmitFunc:i,library:f,inModal:o})})},$e=function(e){var n=e.open,t=e.recordId,r=e.library,i=e.version,a=e.onClose,l=(0,u.$G)().t,o=(0,d.useState)(),h=(0,s.Z)(o,2),m=h[0],b=h[1],x=(0,d.useState)(null),_=(0,s.Z)(x,2),Z=_[0],y=_[1],g=function(){return a()};return(0,W.jsxs)(c.Z,{open:n,onClose:g,size:"large",centered:!0,closeOnDimmerClick:!0,closeOnEscape:!0,closeIcon:!0,dimmer:!0,children:[t&&m&&(0,W.jsx)(c.Z.Header,{style:{fontSize:"1.3em"},children:(0,W.jsx)(p.Z,{record:m})}),(0,W.jsx)(c.Z.Content,{scrolling:!0,style:{minHeight:"calc(30vh)"},children:(0,W.jsx)(Ve,{recordId:t,library:r,version:i,onIdentityUpdate:b,setSubmitFunc:y,inModal:!0,onPostSave:a})}),!t&&(0,W.jsxs)(c.Z.Actions,{children:[(0,W.jsxs)(f.Z,{className:"close-button",onClick:g,negative:!0,children:[(0,W.jsx)(v.Z,{name:"cancel"})," ",l("admin.cancel")]}),(0,W.jsxs)(f.Z,{className:"submit-button",onClick:function(){Z&&Z.current&&Z.current()},positive:!0,children:[(0,W.jsx)(v.Z,{name:"checkmark"})," ",l("admin.submit")]})]})]})}},73377:function(e,n,t){t.d(n,{Z:function(){return be}});var r,i=t(71171),a=t(54681),l=t(70663),o=t(33495),s=t(92042),d=t(37893),u=t(33028),c=t(2867),f=t(74280),v=t(80688),p=t(42737),h=t.n(p),m=t(85823),b=t(64449),x=t(57450),_=h()(r||(r=(0,i.Z)(["\n    query ROOT_SELECTOR_QUERY($lang: [AvailableLanguage!]) {\n        libraries {\n            list {\n                id\n                label(lang: $lang)\n            }\n        }\n    }\n"])));function Z(e){var n=e.onSelect,t=e.elem;return(0,x.jsxs)(m.Z.Item,{onClick:function(){n(t.id)},children:[(0,x.jsx)(m.Z.Icon,{name:"book",size:"big"}),(0,x.jsxs)(m.Z.Content,{children:[(0,x.jsx)(m.Z.Header,{children:t.label}),t.id]})]})}var y,g=function(e){var n=e.restrictToRoots,t=e.onSelect,r=e.lang,i=(0,v.useQuery)(_,{variables:{lang:r}}),a=i.loading,o=i.error,s=i.data,d=(0,l.$G)().t;if(a)return(0,x.jsx)(b.Z,{});if(o)return(0,x.jsx)("p",{"data-testid":"error",children:o.message});var u=(n.length>0?s.libraries.list.filter((function(e){return n.includes(e.id)})):s.libraries.list).map((function(e){return{id:e.id,label:e.label[r[0]]}}));return(0,x.jsxs)("div",{className:"ui placeholder segment",children:[(0,x.jsxs)("div",{className:"ui two column relaxed stackable grid",children:[(0,x.jsx)("div",{className:"middle aligned column",children:(0,x.jsx)(m.Z,{selection:!0,children:u.map((function(e){return(0,x.jsx)(Z,{onSelect:t,elem:e},e.id)}))})}),(0,x.jsx)("div",{className:"middle aligned column",children:(0,x.jsx)("div",{className:"ui visible info large message",children:d("navigator.select_root")})})]}),(0,x.jsx)("div",{className:"ui vertical divider",children:(0,x.jsx)("i",{className:"angle double left icon"})})]})},E=t(93520),T=t(79351),I=t(38777),j=t(35925),R=t(69356),S=t(53259),C=t(55152),N=t(37256),A="FiltersPanel_filter__-kKlp",k="FiltersPanel_filterAttribute__jOGR9",w="FiltersPanel_filterFunction__ZT2y5",O="FiltersPanel_filterValue__SivrC",D="FiltersPanel_filterRemove__Uvjhq";!function(e){e.INIT_STATE="INIT_STATE",e.SET_RESTRICT_ROOTS="SET_RESTRICT_TO_ROOTS",e.SET_SELECTED_ROOT="SET_SELECTED_ROOT",e.SET_ROOTS="SET_ROOTS",e.SET_ROOT_INFOS="SET_ROOT_INFOS",e.SET_FILTERS="SET_FILTERS",e.TOGGLE_FILTERS="TOGGLE_FILTERS",e.SET_LIST="SET_LIST",e.FILTER_REMOVE="FILTER_REMOVE",e.SELECTION_ADD="SELECTION_ADD",e.SELECTION_REMOVE="SELECTION_REMOVE",e.SET_OFFSET="SET_OFFSET",e.SET_LIMIT="SET_LIMIT"}(y||(y={}));var L,F={restrictToRoots:[],selectable:!1,onSelectionChanged:null,onEditRecordClick:null,multipleSelection:!1,selection:[],selectedRoot:null,selectedRootLabel:null,selectedRootQuery:null,selectedRootFilter:null,selectedRootAttributes:[],rootsList:[],lang:["fr"],filters:[],showFilters:!1,list:[],execSearch:!0,availableOffsets:[5,10,15,20,50,100],selectedOffset:10},V=function(e,n){switch(n.type){case y.INIT_STATE:return(0,u.Z)((0,u.Z)({},e),{},{restrictToRoots:n.data.restrictToRoots,selectedRoot:1===n.data.restrictToRoots.length?n.data.restrictToRoots[0]:null,onSelectionChanged:n.data.onSelectionChanged,multipleSelection:n.data.multipleSelection,selectable:n.data.selectable});case y.SET_RESTRICT_ROOTS:return(0,u.Z)((0,u.Z)({},e),{},{restrictToRoots:n.data,selectedRoot:1===n.data.length?n.data[0]:null});case y.SET_SELECTED_ROOT:return(0,u.Z)((0,u.Z)({},e),{},{selectedRoot:n.data,selectedRootQuery:null,selectedRootAttributes:[],list:[],filters:[],execSearch:!0});case y.SET_ROOTS:return(0,u.Z)((0,u.Z)({},e),{},{rootsList:n.data});case y.SET_ROOT_INFOS:return(0,u.Z)((0,u.Z)({},e),{},{selectedRootLabel:n.data.label,selectedRootQuery:n.data.query,selectedRootFilter:n.data.filter,selectedRootAttributes:n.data.attributes});case y.SET_FILTERS:return(0,u.Z)((0,u.Z)({},e),{},{filters:n.data,list:[],showFilters:!1,execSearch:!0});case y.FILTER_REMOVE:return(0,u.Z)((0,u.Z)({},e),{},{filters:e.filters.filter((function(e,t){return t!==n.data})),execSearch:!0});case y.TOGGLE_FILTERS:return(0,u.Z)((0,u.Z)({},e),{},{showFilters:!e.showFilters});case y.SET_LIST:return(0,u.Z)((0,u.Z)({},e),{},{list:n.data.list,totalCount:n.data.totalCount,offset:n.data.offset,execSearch:!1,availableOffsets:e.availableOffsets.length<7?[].concat((0,I.Z)(e.availableOffsets),[n.data.all]):e.availableOffsets});case y.SET_OFFSET:return(0,u.Z)((0,u.Z)({},e),{},{offset:n.data.offset,currentPage:n.data.page,execSearch:!0});case y.SET_LIMIT:return"string"===typeof n.data.limit?(0,u.Z)((0,u.Z)({},e),{},{selectedOffset:null,offset:0,currentPage:1,execSearch:!0}):(0,u.Z)((0,u.Z)({},e),{},{selectedOffset:n.data.limit,offset:0,currentPage:1,execSearch:!0});case y.SELECTION_ADD:var t=e.multipleSelection?Array.from(new Set(e.selection).add(n.data)):[n.data],r=e.onSelectionChanged;return null!==r&&setImmediate((function(){return r(t)})),(0,u.Z)((0,u.Z)({},e),{},{selection:t});case y.SELECTION_REMOVE:var i=e.selection.filter((function(e){return e.id!==n.data.id})),a=e.onSelectionChanged;return null!==a&&setImmediate((function(){return a(i)})),(0,u.Z)((0,u.Z)({},e),{},{selection:i});default:return e}},$={attribute:"",value:"",operator:"="};!function(e){e.ADD_FILTER="ADD_FILTER",e.REMOVE_FILTER="REMOVE_FILTER",e.CHANGE_VALUE="CHANGE_VALUE",e.CHANGE_ATTRIBUTE="CHANGE_ATTRIBUTE",e.RESET="RESET"}(L||(L={}));var P=function(e,n){switch(n.type){case L.ADD_FILTER:return[].concat((0,I.Z)(e),[(0,u.Z)({},$)]);case L.REMOVE_FILTER:var t=(0,I.Z)(e);return t.splice(n.data,1),t;case L.CHANGE_VALUE:return e[n.data.index]=(0,u.Z)((0,u.Z)({},e[n.data.index]),{},{value:n.data.value}),(0,I.Z)(e);case L.CHANGE_ATTRIBUTE:return e[n.data.index]=(0,u.Z)((0,u.Z)({},e[n.data.index]),{},{attribute:n.data.value}),(0,I.Z)(e);case L.RESET:return 0===n.data.length?[(0,u.Z)({},$)]:n.data;default:return e}};function G(e){var n=e.state,t=e.dispatch,r=(0,a.useReducer)(P,n.filters),i=(0,c.Z)(r,2),l=i[0],o=i[1];(0,a.useEffect)((function(){n.showFilters&&o({type:L.RESET,data:n.filters})}),[n.filters,n.showFilters]);var d=(0,a.useMemo)((function(){return n.selectedRootAttributes.map((function(e){var n;return{key:e.id,text:null===(n=e.label)||void 0===n?void 0:n.fr,value:e.id}}))}),[n.selectedRootAttributes]),u=(0,a.useMemo)((function(){return{removeFilter:function(e){o({type:L.REMOVE_FILTER,data:e})},changeValue:function(e,n){o({type:L.CHANGE_VALUE,data:{index:e,value:n}})},changeAttribute:function(e,n){o({type:L.CHANGE_ATTRIBUTE,data:{index:e,value:n}})}}}),[o]),f=(0,a.useMemo)((function(){return function(e,n){return(0,x.jsxs)(j.Z,{fluid:!0,labelPosition:"left",type:"text",placeholder:"Value...",className:A,children:[(0,x.jsx)(R.Z,{style:{width:"40%"},placeholder:"Attribute",search:!0,selection:!0,options:d,className:k,onChange:function(e,t){u.changeAttribute(n,t.value)},value:e.attribute}),(0,x.jsx)(S.Z,{className:w,children:"="}),(0,x.jsx)("input",{"data-id":n,onChange:function(e){u.changeValue(n,e.target.value)},value:e.value,className:O}),(0,x.jsx)(s.Z,{as:"a",negative:!0,onClick:function(){u.removeFilter(n)},className:D,children:(0,x.jsx)(C.Z,{name:"delete"})})]},n)}}),[d,u]);return(0,x.jsxs)(N.Z,{className:"inverted",style:{position:"absolute",top:0,right:0,width:"75%",bottom:0,textAlign:"left",boxSizing:"border-box"},children:[(0,x.jsx)("h4",{className:"ui right floated header",children:(0,x.jsx)("i",{className:"ui window close icon",onClick:function(){o({type:L.RESET,data:n.filters}),t({type:y.TOGGLE_FILTERS,data:null})}})}),(0,x.jsxs)("form",{onSubmit:function(e){e.preventDefault(),function(){var e=l.filter((function(e){return""!==e.attribute&&""!==e.operator&&""!==e.value}));t({type:y.SET_FILTERS,data:e})}()},children:[(0,x.jsxs)("h4",{className:"ui left floated header",children:[(0,x.jsxs)(s.Z,{type:"button",onClick:function(){o({type:L.ADD_FILTER,data:null})},children:[(0,x.jsx)(C.Z,{name:"add"})," Add filter"]}),(0,x.jsxs)(s.Z,{type:"submit",primary:!0,children:[(0,x.jsx)(C.Z,{name:"filter"})," Apply filters"]})]}),(0,x.jsx)("div",{className:"ui divider clearing"}),l.map(f)]})]})}var M=t(2745),B=t(31010),H=t(56022),U=t(63120),Q=t(92299),q=t(19046),Y="MainPanel_TopPanelContainer__TyfVE",z="MainPanel_ListPanelContainer__1EJB6",W="MainPanel_TopPanelHeader__ESXpC",K="MainPanel_ListPanelTable__pYsDw",X="MainPanel_ListPanelTableTh__cg+Lk",J="MainPanel_ListPanelTableThFooter__ZyENs",ee="MainPanel_ListPanelPaginationContainer__Tsw4o",ne="MainPanel_ListPanelPaginationCount__DYRe9",te="MainPanel_blurred__jRE2Q",re="MainPanel_clickable__rGGvw";function ie(e){var n=e.state,t=e.dispatch;return n.execSearch?(0,x.jsx)(le,{selectedRootQuery:n.selectedRootQuery,filters:n.filters,dispatch:t,offset:"number"===typeof n.offset?n.offset:null,limit:n.selectedOffset}):(0,x.jsx)(ae,{state:n,dispatch:t})}function ae(e){var n=e.state,t=e.dispatch,r=(0,l.$G)().t,i=n.selectable,o=(0,a.useMemo)((function(){return function(e){return function(n,r){var i=r.checked?y.SELECTION_ADD:y.SELECTION_REMOVE;t({type:i,data:e.whoAmI})}}}),[t]),s=(0,a.useMemo)((function(){return function(e){return void 0!==n.selection.find((function(n){return n.id===e}))}}),[n.selection]),d=(0,a.useMemo)((function(){var e=n.onEditRecordClick?n.onEditRecordClick:function(){};return function(n){return function(t,r){e(n.whoAmI)}}}),[n.onEditRecordClick]),u=n.totalCount&&n.selectedOffset?Math.floor(n.totalCount/n.selectedOffset)+(n.totalCount%n.selectedOffset?1:0):1,c=n.availableOffsets.map((function(e){return{text:e.toString(),value:e}}));return(0,x.jsxs)(B.Z,{className:K,selectable:!0,celled:!0,children:[(0,x.jsx)(B.Z.Header,{children:(0,x.jsxs)(B.Z.Row,{children:[i&&(0,x.jsx)(B.Z.HeaderCell,{className:X}),(0,x.jsx)(B.Z.HeaderCell,{className:X,children:"ID"}),(0,x.jsx)(B.Z.HeaderCell,{className:X})]})}),(0,x.jsx)(B.Z.Body,{children:n.list.map((function(e){return(0,x.jsxs)(B.Z.Row,{children:[i&&(0,x.jsx)(B.Z.Cell,{width:"1",children:(0,x.jsx)(H.Z,{toggle:!0,onChange:o(e),checked:s(e.whoAmI.id)})}),(0,x.jsx)(B.Z.Cell,{className:re,width:"3",onClick:d(e),children:(0,x.jsx)(q.Z,{record:e.whoAmI})}),(0,x.jsx)(B.Z.Cell,{width:"12"})]},e.whoAmI.id)}))}),(0,x.jsx)(B.Z.Footer,{children:(0,x.jsx)(B.Z.Row,{children:(0,x.jsxs)(B.Z.HeaderCell,{className:J,colSpan:"3",children:[(0,x.jsxs)("div",{className:ee,children:[(0,x.jsx)(U.Z,{onPageChange:function(e,r){var i=r.activePage,a=0;n.selectedOffset&&(a=(i-1)*n.selectedOffset);var l={offset:a,page:i};t({type:y.SET_OFFSET,data:l})},activePage:n.currentPage?n.currentPage:1,value:n.selectedOffset?n.selectedOffset:"",totalPages:u}),(0,x.jsxs)("p",{className:ne,children:[n.totalCount," ",n.selectedRootLabel]})]}),(0,x.jsx)("br",{}),(0,x.jsxs)("div",{style:{position:"absolute",bottom:"3px",right:"2px"},children:[(0,x.jsx)("span",{style:{marginRight:"5px"},children:r("navigator.select_range")}),(0,x.jsx)(Q.Z,{placeholder:r("navigator.select_range"),value:n.selectedOffset?n.selectedOffset:n.availableOffsets[n.availableOffsets.length-1],options:c,onChange:function(e,n){t({type:y.SET_LIMIT,data:{limit:n.value}})}})]})]})})})]})}function le(e){var n=e.selectedRootQuery,t=e.filters,r=e.dispatch,i=e.offset,o=e.limit,s=(0,l.$G)().t,d=(0,M.gy)(n),c=t.reduce((function(e,n,r){t.length>1&&r>0&&e.push({operator:"AND"});var i={field:n.attribute,condition:"EQUAL",value:n.value};return e.push(i),e}),[]),f=null===o?null:{offset:null!==i?i:0,limit:o},p=(0,v.useQuery)(d,{fetchPolicy:"network-only",variables:{filters:c,pagination:f}}),h=p.loading,m=p.error,_=p.data;if((0,a.useEffect)((function(){_&&r({type:y.SET_LIST,data:(0,u.Z)((0,u.Z)({},_[n]),{},{offset:i,all:Z})})}),[_]),h)return(0,x.jsx)(b.Z,{withDimmer:!0});if(m)return(0,x.jsx)("p",{"data-testid":"error",children:m.message});if(!_)return(0,x.jsx)("p",{"data-testid":"error",children:"No data"});var Z=s("navigator.display_all");return null}var oe,se=t(71988),de=t(98132);function ue(e){var n=e.state,t=e.dispatch,r=(0,l.$G)().t,i=(0,a.useState)(!1),o=(0,c.Z)(i,2),d=o[0],u=o[1],f=(0,a.useMemo)((function(){return{clearRoot:function(){t({type:y.SET_SELECTED_ROOT,data:null})},toggleFilters:function(){t({type:y.TOGGLE_FILTERS,data:null})},makeOnFilterRemove:function(e){return function(n){return n.stopPropagation(),t({type:y.FILTER_REMOVE,data:e}),!1}},selectedRootAttributesById:n.selectedRootAttributes.reduce((function(e,n){return e[n.id]=n,e}),{})}}),[t,n.selectedRootAttributes]),v=f.clearRoot,p=f.toggleFilters,h=f.makeOnFilterRemove,m=f.selectedRootAttributesById;return(0,x.jsxs)("div",{className:"ui block segment secondary height100 ".concat(W),children:[(0,x.jsxs)("h3",{children:[1!==n.restrictToRoots.length&&(0,x.jsx)(s.Z,{size:"tiny",compact:!0,circular:!0,"data-testid":"clear_root",onClick:v,icon:"random"}),(0,x.jsx)("i",{className:"book icon"}),n.selectedRootLabel]}),(0,x.jsxs)(s.Z,{size:"small","data-testid":"toggle_filters",onClick:p,children:[(0,x.jsx)(C.Z,{name:"edit"}),r("navigator.edit_filters")]}),(0,x.jsxs)(s.Z,{icon:!0,labelPosition:"left",size:"large",style:{position:"absolute",right:"10px",top:"16px"},onClick:function(){u(!0)},children:[(0,x.jsx)(C.Z,{name:"plus"}),r("records.create_record")]}),(0,x.jsx)(se.Z,{}),(0,x.jsx)(S.Z.Group,{onClick:p,color:"blue",children:n.filters.map((function(e,t){return(0,x.jsxs)(S.Z,{as:"span",image:!0,children:["".concat(m[e.attribute].label[n.lang[0]]," ").concat(e.operator," ").concat(e.value),(0,x.jsx)(S.Z.Detail,{children:(0,x.jsx)(C.Z,{name:"delete",onClick:h(t)})})]},t)}))}),d&&(0,x.jsx)(de.Z,{open:!0,onClose:function(){u(!1),t({type:y.SET_FILTERS,data:n.filters})},library:n.selectedRoot?n.selectedRoot:""})]})}function ce(e){var n=e.state,t=e.dispatch;return n.selectedRootQuery&&n.selectedRootAttributes?(0,x.jsxs)(E.Z.Dimmable,{as:"div",dimmed:n.showFilters,className:"height100",children:[(0,x.jsx)("div",{className:"".concat(Y," ").concat(n.showFilters?te:""),children:(0,x.jsx)(ue,{state:n,dispatch:t})}),(0,x.jsx)("div",{className:"ui segment ".concat(z," ").concat(n.showFilters?te:""),children:(0,x.jsx)(ie,{state:n,dispatch:t})}),(0,x.jsx)(T.Z,{visible:n.showFilters,animation:"fade left",duration:350,children:(0,x.jsx)(E.Z.Inner,{active:n.showFilters,className:"height100",style:{backgroundColor:"rgba(0,0,0,0.6)"},children:(0,x.jsx)(G,{state:n,dispatch:t})})})]}):(0,x.jsx)(ve,{state:n,dispatch:t})}var fe=h()(oe||(oe=(0,i.Z)(["\n    query QUERY_LIBRARY_CONFIG($id: ID, $lang: [AvailableLanguage!]) {\n        libraries(filters: {id: $id}) {\n            list {\n                id\n                label(lang: $lang)\n                gqlNames {\n                    query\n                    filter\n                }\n                attributes {\n                    id\n                    type\n                    format\n                    label(lang: $lang)\n                }\n            }\n        }\n    }\n"])));function ve(e){var n=e.state,t=e.dispatch,r=(0,v.useQuery)(fe,{variables:{id:n.selectedRoot,lang:n.lang}}),i=r.loading,l=r.error,o=r.data;return(0,a.useEffect)((function(){o&&t({type:y.SET_ROOT_INFOS,data:{label:o.libraries.list[0].label["".concat(n.lang[0])],query:o.libraries.list[0].gqlNames.query,filter:o.libraries.list[0].gqlNames.filter,attributes:o.libraries.list[0].attributes}})}),[null===o||void 0===o?void 0:o.libraries]),i?(0,x.jsx)(b.Z,{}):l?(0,x.jsx)("p",{"data-testid":"error",children:l.message}):null}var pe,he=function(e){var n=(0,f.Z)().lang,t=(0,a.useReducer)(V,(0,u.Z)((0,u.Z)((0,u.Z)({},F),e),{},{lang:n,selectedRoot:e.restrictToRoots&&1===e.restrictToRoots.length?e.restrictToRoots[0]:null})),r=(0,c.Z)(t,2),i=r[0],l=r[1];return(0,a.useEffect)((function(){e.getSelectionRef&&(e.getSelectionRef.current=function(){return i.selection})}),[e.getSelectionRef,i.selection]),i.selectedRoot?(0,x.jsx)(ce,{state:i,dispatch:l}):(0,x.jsx)(g,{restrictToRoots:i.restrictToRoots,lang:i.lang,onSelect:function(e){return l({type:y.SET_SELECTED_ROOT,data:e})}})},me=(0,d.ZP)(o.Z)(pe||(pe=(0,i.Z)(["\n    max-height: 90vh;\n    overflow: auto;\n"]))),be=function(e){var n=e.library,t=e.open,r=e.onClose,i=e.onSelect,a=(0,l.$G)().t;return(0,x.jsxs)(me,{open:t,onClose:r,children:[(0,x.jsx)(o.Z.Header,{children:a("records.select_record")}),(0,x.jsx)(he,{onEditRecordClick:i,restrictToRoots:Array.isArray(n)?n:[n]}),(0,x.jsx)(o.Z.Actions,{children:(0,x.jsx)(s.Z,{"data-test-id":"select-record-modal-close-btn",onClick:r,children:a("admin.cancel")})})]})}},73218:function(e,n,t){t.d(n,{Z:function(){return u}});var r,i,a=t(71171),l=(t(54681),t(37893)),o=t(57450),s=l.ZP.div(r||(r=(0,a.Z)(["\n    display: flex;\n    flex-direction: row;\n    justify-content: flex-start;\n    height: 100%;\n"]))),d=l.ZP.div(i||(i=(0,a.Z)(["\n    position: relative;\n    padding: 1em;\n    flex-direction: column;\n    display: flex;\n    text-align: center;\n    border-right: 1px solid #999999;\n    width: ",";\n\n    &:first-child {\n        padding-left: 0;\n    }\n\n    &:last-child {\n        border-right: none;\n        padding-right: 0;\n    }\n"])),(function(e){return 100/e.columnsNumber+"%"}));var u=function(e){var n=e.columnsContent,t=e.columnsNumber;return(0,o.jsx)(s,{children:n.map((function(e,n){return(0,o.jsx)(d,{columnsNumber:t,children:e},n)}))})}},43248:function(e,n,t){t.d(n,{Z:function(){return o}});var r=t(54681),i=t(5168),a=t(53259),l=t(57450);var o=function(e){var n=e.error,t=e.children,o=t?Array.isArray(t)?t:[t]:[];return(0,l.jsxs)(i.Z.Field,{children:[o.map((function(e,t){return r.cloneElement(e,{error:!!n,key:t})})),!!n&&(0,l.jsx)(a.Z,{pointing:"above",children:"string"!==typeof n?JSON.stringify(n):n})]})}},25154:function(e,n,t){t.d(n,{Z:function(){return T}});var r,i=t(41361),a=t(54681),l=t(15189),o=t(2867),s=t(71171),d=t(69356),u=t(55152),c=t(37893),f=t(19046),v=t(70663),p=t(33495),h=t(31010),m=t(57450),b=c.ZP.div(r||(r=(0,s.Z)(["\n    position: relative;\n    padding-right: 30px;\n    height: 30px;\n"])));var x,_,Z=function(e){var n=e.altPaths,t=void 0===n?[]:n,r=e.onClose;return(0,m.jsx)(p.Z,{size:"fullscreen",open:!0,onClose:function(){return r(!1)},children:(0,m.jsx)(p.Z.Content,{children:(0,m.jsx)(h.Z,{children:(0,m.jsx)(h.Z.Body,{children:t.map((function(e){return(0,m.jsx)(h.Z.Row,{children:(0,m.jsx)(h.Z.Cell,{collapsing:!0,children:(0,m.jsx)(l.Z,{sections:e.map((function(e){return{key:e.id,content:(0,m.jsx)(b,{"data-test-id":"path_part_wrapper",children:(0,m.jsx)(f.Z,{record:e})}),link:!1,active:!1}})),icon:"right angle"})})},e.map((function(e){return e.id})).join(""))}))})})})})},y=c.ZP.div(x||(x=(0,s.Z)(["\n    position: relative;\n    padding-right: 30px;\n    height: 30px;\n"]))),g=(0,c.ZP)(d.Z)(_||(_=(0,s.Z)(["\n    && {\n        position: absolute;\n        top: 7px;\n        right: 0;\n    }\n"])));var E=function(e){var n=e.record,t=e.altPaths,r=void 0===t?[]:t,i=e.actions,l=void 0===i?[]:i,s=(0,a.useState)(!1),c=(0,o.Z)(s,2),p=c[0],h=c[1],b=(0,a.useState)(!1),x=(0,o.Z)(b,2),_=x[0],E=x[1],T=(0,v.$G)().t,I=l.filter((function(e){return!e.displayFilter||e.displayFilter(n)})).map((function(e,t){return(0,m.jsx)(d.Z.Item,{text:e.text,icon:e.icon,onClick:function(){return e.action(n)}},t)}));r.length&&I.push((0,m.jsx)(d.Z.Item,{text:T("trees.alternative_paths"),icon:"list",onClick:function(){return E(!0)}},"altPaths"));var j=!!I.length,R=(0,m.jsx)(u.Z,{name:"ellipsis vertical"});return(0,m.jsxs)(y,{"data-test-id":"path_part_wrapper",onMouseEnter:function(){return h(!0)},onMouseLeave:function(){return h(!1)},children:[(0,m.jsx)(f.Z,{record:n}),j&&p&&(0,m.jsx)(g,{trigger:R,icon:!1,children:(0,m.jsx)(d.Z.Menu,{children:I})}),_&&(0,m.jsx)(Z,{altPaths:r,onClose:E})]})};var T=function(e){var n,t=e.element,r=e.actions,a=[];if(null!==(n=t.ancestors)&&void 0!==n&&n.length){var o,s=t.ancestors.slice(0,-1),d=(0,i.Z)(s);try{for(d.s();!(o=d.n()).done;){var u,c,f,v=o.value;a.push({key:null===(u=v.record)||void 0===u||null===(c=u.whoAmI)||void 0===c?void 0:c.id,content:(0,m.jsx)(E,{record:null===(f=v.record)||void 0===f?void 0:f.whoAmI,actions:r}),link:!1,active:!1})}}catch(h){d.e(h)}finally{d.f()}}var p=t.record;return p&&p.whoAmI&&a.push({key:p.whoAmI.id,content:(0,m.jsx)(E,{record:p.whoAmI,actions:r,altPaths:[]}),link:!1,active:!0}),(0,m.jsx)(l.Z,{sections:a,icon:"right angle"})}},42538:function(e,n,t){t.d(n,{Z:function(){return v}});var r=t(2867),i=t(80688),a=t(54681),l=t(70663),o=t(33495),s=t(92042),d=t(24532),u=t(64449),c=t(15098),f=t(57450),v=function(e){var n=e.open,t=e.tree,v=e.onSelect,p=e.onClose,h=(0,l.$G)().t,m=(0,a.useState)(null),b=(0,r.Z)(m,2),x=b[0],_=b[1],Z=(0,i.useQuery)(d.F,{variables:{id:t}}),y=Z.loading,g=Z.error,E=Z.data;if(y)return(0,f.jsx)(u.Z,{});if(g)return(0,f.jsxs)("p",{children:["ERROR ",g]});if(!E||!E.trees||!E.trees.list.length)return(0,f.jsx)("p",{children:"Unknown tree"});var T=E.trees.list[0];return(0,f.jsxs)(o.Z,{open:n,onClose:p,closeIcon:!0,children:[(0,f.jsx)(o.Z.Header,{children:h("trees.select_tree_node")}),(0,f.jsx)(o.Z.Content,{style:{height:"80vh"},children:(0,f.jsx)(c.Z,{tree:T,onClickNode:function(e){return _([e])},readOnly:!0,selection:x})}),(0,f.jsxs)(o.Z.Actions,{children:[(0,f.jsx)(s.Z,{"data-test-id":"select_tree_node_close_btn",negative:!0,content:h("admin.cancel"),icon:"cancel",onClick:p}),x&&x.length&&(0,f.jsx)(s.Z,{"data-test-id":"select_tree_node_submit_btn",positive:!0,content:h("admin.submit"),icon:"check",onClick:function(){var e=x[0];return v(e)}})]})]})}},15098:function(e,n,t){t.d(n,{Z:function(){return X}});var r,i,a,l,o,s,d,u=t(34795),c=t(2867),f=t(71171),v=t(33028),p=t(77162),h=t.n(p),m=t(80688),b=t(42737),x=t.n(b),_=t(50500),Z=x()(r||(r=(0,f.Z)(["\n    ","\n    query TREE_NODE_CHILDREN($treeId: ID!, $node: ID, $pagination: Pagination) {\n        treeNodeChildren(treeId: $treeId, node: $node, pagination: $pagination) {\n            list {\n                id\n                order\n                childrenCount\n                record {\n                    ...RecordIdentity\n                }\n            }\n        }\n    }\n"])),_.T),y=t(54681),g=t(66502),E=(t(44556),t(80687)),T=t(55152),I=t(37893),j=t(70621),R=x()(i||(i=(0,f.Z)(["\n    mutation ADD_TREE_ELEMENT($treeId: ID!, $element: TreeElementInput!, $parent: ID) {\n        treeAddElement(treeId: $treeId, element: $element, parent: $parent, order: 0) {\n            id\n        }\n    }\n"]))),S=x()(a||(a=(0,f.Z)(["\n    mutation DELETE_TREE_ELEMENT($treeId: ID!, $nodeId: ID!, $deleteChildren: Boolean) {\n        treeDeleteElement(treeId: $treeId, nodeId: $nodeId, deleteChildren: $deleteChildren)\n    }\n"]))),C=x()(l||(l=(0,f.Z)(["\n    mutation MOVE_TREE_ELEMENT($treeId: ID!, $nodeId: ID!, $parentTo: ID, $order: Int) {\n        treeMoveElement(treeId: $treeId, nodeId: $nodeId, parentTo: $parentTo, order: $order) {\n            id\n        }\n    }\n"]))),N=t(71446),A=t(19046),k=t(98132),w=t(73377),O=t(64449),D=t(74280),L=t(70663),F=t(53259),V=t(69356),$=t(5918),P=t(33495),G=t(92042),M=t(71207),B=t(19913),H=t(57450),U=I.ZP.div(o||(o=(0,f.Z)(["\n    /** Overrides some SortableTree CSS rules **/\n    .rst__rowContents {\n        padding: 0;\n        background: transparent;\n        height: 100%;\n        ","\n    }\n\n    .rst__rowLabel {\n        height: 100%;\n    }\n\n    .rst__rowTitle {\n        height: 100%;\n    }\n\n    .rst__row.tree-node {\n        cursor: pointer;\n        height: 100%;\n    }\n\n    .rst__row.tree-node.selected {\n        background: ",";\n    }\n    .rst__rowWrapper {\n        padding: 3px 0;\n    }\n    .rst__moveHandle,\n    .rst__loadingHandle {\n        width: 30px;\n    }\n\n    ","\n"])),(function(e){return e.compact?"\n        min-width: 130px;\n        border: none;\n        box-shadow: none;\n        ":""}),M.d6,(function(e){return e.compact?"\n    .rst__collapseButton,\n    .rst__expandButton {\n        background-size: 16px;\n        width: 12px;\n        height: 12px;\n    }\n    .rst__collapseButton:hover:not(:active),\n    .rst__expandButton:hover:not(:active) {\n        background-size: 20px;\n        width: 16px;\n        height: 16px;\n    }\n    ":""})),Q=(0,I.ZP)(F.Z)(s||(s=(0,f.Z)(["\n    background-color: ",";\n"])),(function(e){return e.bgcolor})),q={library:"",path:[],parent:null},Y=function(e){var n=e.treeSettings,t=e.treeData,r=e.onTreeChange,i=e.onVisibilityToggle,a=e.onMoveNode,l=e.onDeleteNode,o=e.onClickNode,s=e.selection,d=e.readOnly,u=e.onAddElement,f=e.compact,p=void 0!==f&&f,h=(0,L.$G)().t,m=(0,D.Z)().lang,b=(0,y.useState)(!1),x=(0,c.Z)(b,2),_=x[0],Z=x[1],E=(0,y.useState)(!1),I=(0,c.Z)(E,2),R=I[0],S=I[1],C=(0,y.useState)(!1),N=(0,c.Z)(C,2),A=N[0],F=N[1],M=(0,y.useState)(!1),Y=(0,c.Z)(M,2),z=Y[0],W=Y[1],K=(0,y.useState)(),X=(0,c.Z)(K,2),J=X[0],ee=X[1],ne=(0,y.useState)(q),te=(0,c.Z)(ne,2),re=te[0],ie=te[1],ae=function(){return S(!1)},le=function(){return F(!1)},oe=function(){return W(!1)},se=function(e){return function(){F(!1),Z(!0),e&&ie(e)}},de=h("admin.or"),ue={scaffoldBlockPxWidth:p?25:35,rowHeight:p?35:50,slideRegionSize:p?30:50};return(0,H.jsxs)(U,{className:"grow height100",compact:p,children:[null!==t&&void 0!==t&&t.length?(0,H.jsx)(g.oP,{"data-test-id":"sortable-tree",canDrag:!d,canDrop:function(e){return null!==e.nextParent},treeData:t,onChange:r,onVisibilityToggle:i,getNodeKey:B.xN,generateNodeProps:function(e){var t,r,i,a=o&&function(n){"rst__expandButton"!==n.target.className&&"rst__collapseButton"!==n.target.className&&o((0,v.Z)({},e))},l=["tree-node"];s&&s.find((function(n){return(0,B.xN)(n)===(0,B.xN)(e)}))&&l.push("selected");var u=e.node.isFakeRoot;return{canDrag:!d&&!u,buttons:[!d&&(0,H.jsx)(V.Z,{pointing:!1,basic:!0,compact:!0,icon:"ellipsis vertical",children:(0,H.jsxs)(V.Z.Menu,{children:[!u&&(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(V.Z.Item,{text:h("records.edit"),icon:"edit outline",onClick:se({parent:null!==(t=null===(r=e.parentNode)||void 0===r?void 0:r.id)&&void 0!==t?t:j.Y,library:null===(i=e.node.record.library)||void 0===i?void 0:i.id,recordId:e.node.record.id,path:e.path})},"edit_record_btn_item"),(0,H.jsx)(V.Z.Item,{text:h("trees.delete"),icon:"alternate trash outline",onClick:function(){return ee(e),void S(!0)}},"delete_record_btn_item"),(0,H.jsx)(V.Z.Divider,{})]}),(0,H.jsx)(V.Z.Header,{icon:"plus square outline",content:h("trees.add_element")}),n.libraries.map((function(n){return(0,H.jsx)(V.Z.Item,{text:(0,B.dX)(n.library.label,m),onClick:(t=e.node.id,r=e.path,i=n.library.id,function(){F(!0),ie({parent:t,library:i,path:r})}),label:(0,H.jsx)(Q,{circular:!0,bgcolor:(0,B.u_)(n.library.id),content:n.library.id[0].toUpperCase()})},"add_record_btn_item_".concat(n.library.id));var t,r,i}))]})})],className:l.join(" "),onClick:a}},onMoveNode:a,theme:ue}):(0,H.jsx)(O.Z,{withDimmer:!0}),(0,H.jsx)(k.Z,{open:_,onClose:function(e){if(Z(!1),e&&!re.recordId&&re.parent&&u)return u(e,re.parent,re.path)},recordId:re.recordId,library:re.library}),!d&&(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)($.Z,{"data-test-id":"delete_confirm_modal",open:R,onCancel:ae,onConfirm:function(){return ae(),J&&l(J)},content:h("records.delete_confirm")}),(0,H.jsxs)(P.Z,{open:A,onClose:le,closeIcon:!0,children:[(0,H.jsxs)(P.Z.Header,{children:[(0,H.jsx)(T.Z,{name:"plus square outline"}),h("trees.add_element")]}),(0,H.jsx)(P.Z.Content,{style:{textAlign:"center"},children:(0,H.jsxs)(G.Z.Group,{size:"large",children:[(0,H.jsxs)(G.Z,{type:"button",onClick:se(),children:[(0,H.jsx)(T.Z,{name:"plus circle"}),h("records.create_record")]}),(0,H.jsx)(G.Z.Or,{text:de}),(0,H.jsxs)(G.Z,{type:"button",onClick:function(){le(),W(!0)},children:[(0,H.jsx)(T.Z,{name:"search"}),h("records.select_record")]})]})})]}),(0,H.jsx)(w.Z,{open:z,library:re.library,onClose:oe,onSelect:function(e){re.parent&&u&&(u(e,re.parent,re.path),oe())}})]})]})},z=function(e,n){return e.map((function(e){var t,r=e.id===j.Y||n?(0,H.jsx)(W,{children:null!==(t=e.record.whoAmI.label)&&void 0!==t?t:e.record.whoAmI.id}):(0,H.jsx)(A.Z,{record:e.record.whoAmI,style:{height:"100%"}});return(0,v.Z)((0,v.Z)({},e),{},{title:r,expanded:!1,children:e.childrenCount?function(){return null}:null,path:[]})}))},W=I.ZP.div(d||(d=(0,f.Z)(["\n    height: 100%;\n    padding-left: 0.5rem;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n"]))),K=function(e){var n=e.tree,t=e.readOnly,r=e.onClickNode,i=e.selection,a=e.withFakeRoot,l=e.fakeRootLabel,o=e.startAt,s=e.compact,d=void 0!==s&&s,f=(0,m.useApolloClient)(),p=[{id:j.Y,record:{id:j.Y,library:{id:j.Y,label:null},whoAmI:{id:j.Y,label:l||"",color:"transparent",library:{id:j.Y,label:null},preview:null},isFakeRoot:!0},childrenCount:0,order:0}],b=a?z(p,d):[],x=(0,y.useState)(b),_=(0,c.Z)(x,2),I=_[0],A=_[1],k=(0,y.useState)(!1),w=(0,c.Z)(k,2),O=w[0],D=w[1],L=(0,y.useState)(),F=(0,c.Z)(L,2),V=F[0],$=F[1],P=function(){var e=(0,u.Z)(h().mark((function e(t,r){var i,a,l,o,s,u,c=arguments;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=!(c.length>2&&void 0!==c[2])||c[2],a=!!r,e.next=4,f.query({query:Z,variables:{treeId:n.id,node:t||null}});case 4:l=e.sent,o=l.data.treeNodeChildren?z(l.data.treeNodeChildren.list,d).map((function(e){return(0,v.Z)((0,v.Z)({},e),{},{path:r})})):[],s=(0,g.PC)({treeData:I,path:r,getNodeKey:N.xN}),a?null!==s&&(u=B((0,v.Z)((0,v.Z)({},s.node),{},{loading:!1,loaded:!0,children:o,expanded:i}),r)):u=o,D(!0),A(u),$("");case 11:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),G=function(){var e=(0,u.Z)(h().mark((function e(t){var r,i,a,l,o,s,d,u,c,v,p;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.nextParentNode,i=null!==r&&r.id!==j.Y?r.id:null,a=t.treeIndex,null!==r&&(l=(0,g.PC)({treeData:I,path:t.nextPath.slice(0,-1),getNodeKey:N.xN}),a=l?t.treeIndex-l.treeIndex-1:t.treeIndex),e.prev=4,e.next=7,f.mutate({mutation:C,variables:{treeId:n.id,nodeId:t.node.id,parentTo:i,order:a}});case 7:if(null===(o=null!==r?r.children:I)||void 0===o||!o.length){e.next=11;break}return e.next=11,Promise.all(o.map((function(e,r){return(0,N.xN)({node:e})!==(0,N.xN)(t)?f.mutate({mutation:C,variables:{treeId:n.id,nodeId:e.id,parentTo:i,order:r}}):Promise.resolve()})));case 11:$(""),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(4),p=null!==(s=null===(d=e.t0.graphQLErrors)||void 0===d||null===(u=d[0])||void 0===u||null===(c=u.extensions)||void 0===c||null===(v=c.fields)||void 0===v?void 0:v.element)&&void 0!==s?s:e.t0.message,$(p);case 18:case"end":return e.stop()}}),e,null,[[4,14]])})));return function(n){return e.apply(this,arguments)}}(),M=function(){var e=(0,u.Z)(h().mark((function e(t){var r,i;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={treeId:n.id,nodeId:t.node.id},e.next=3,f.mutate({mutation:S,variables:r});case 3:i=(0,g.k)({treeData:I,path:t.path,getNodeKey:N.xN}),A(i),$("");case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),B=function(e,n){return(0,g.Gm)({treeData:I,path:n,newNode:e,getNodeKey:N.xN})},U=function(){var e=(0,u.Z)(h().mark((function e(t,r,i){var a,l,o,s,u,c,v,p,m,b;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.mutate({mutation:R,variables:{treeId:n.id,element:{id:t.id,library:t.library.id},parent:r!==j.Y?r:null}});case 3:a=e.sent,l={id:a.data.treeAddElement.id,record:{id:t.id,library:t.library,whoAmI:t},childrenCount:0,order:0},o=(0,N.xN)({node:{id:r,path:i}}),s=(0,g.YI)({treeData:I,newNode:z([l],d)[0],parentKey:o,getNodeKey:N.xN,expandParent:!0}),A(s.treeData),$(""),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),b=null!==(u=null===(c=e.t0.graphQLErrors)||void 0===c||null===(v=c[0])||void 0===v||null===(p=v.extensions)||void 0===p||null===(m=p.fields)||void 0===m?void 0:m.element)&&void 0!==u?u:e.t0.message,$(b);case 15:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(n,t,r){return e.apply(this,arguments)}}();if(!O){var Q=a?[j.Y]:void 0;P(o||null,Q)}return(0,H.jsxs)(H.Fragment,{children:[V&&(0,H.jsx)(E.Z,{negative:!0,children:(0,H.jsxs)(E.Z.Header,{children:[(0,H.jsx)(T.Z,{name:"ban"})," ",V]})}),(0,H.jsx)(Y,{treeSettings:n,treeData:I,readOnly:t||!1,onTreeChange:A,onVisibilityToggle:function(e){var n=e.expanded,t=e.node,r=e.path;if(!t.expanded&&!t.loaded)return P(t.id,r,n)},onMoveNode:G,onDeleteNode:M,onClickNode:function(e){var n=e.path.map((function(e){var n=(0,g.sE)({treeData:I,getNodeKey:N.xN,searchQuery:e,searchMethod:function(n){return n.node.id===e}});return n.matches.length?n.matches[0].node:null}));return r?r((0,v.Z)((0,v.Z)({},e),{},{node:(0,v.Z)((0,v.Z)({},e.node),{},{parents:n})})):void 0},selection:i,onAddElement:U,compact:d})]})},X=K},82332:function(e,n,t){t.d(n,{Q:function(){return u},Z:function(){return d}});var r,i,a=t(71171),l=t(42737),o=t.n(l),s=t(50500),d=o()(r||(r=(0,a.Z)(["\n    fragment AttributeDetails on Attribute {\n        id\n        type\n        format\n        system\n        readonly\n        label\n        description\n        multiple_values\n        metadata_fields {\n            id\n            label\n            type\n            format\n        }\n        permissions_conf {\n            permissionTreeAttributes {\n                id\n                label\n                ... on TreeAttribute {\n                    linked_tree {\n                        id\n                    }\n                }\n            }\n            relation\n        }\n        versions_conf {\n            versionable\n            mode\n            profile {\n                id\n                label\n                trees {\n                    id\n                    label\n                }\n            }\n        }\n        libraries {\n            id\n            label\n        }\n\n        ... on StandardAttribute {\n            unique\n        }\n\n        ... on LinkAttribute {\n            linked_library {\n                id\n            }\n            reverse_link\n        }\n        ... on TreeAttribute {\n            linked_tree {\n                id\n            }\n        }\n    }\n"]))),u=o()(i||(i=(0,a.Z)(["\n    ","\n    fragment AttributeValuesListDetails on Attribute {\n        ... on StandardAttribute {\n            unique\n            values_list {\n                ... on StandardStringValuesListConf {\n                    enable\n                    allowFreeEntry\n                    values\n                }\n\n                ... on StandardDateRangeValuesListConf {\n                    enable\n                    allowFreeEntry\n                    dateRangeValues: values {\n                        from\n                        to\n                    }\n                }\n            }\n        }\n        ... on LinkAttribute {\n            values_list {\n                enable\n                allowFreeEntry\n                linkValues: values {\n                    ...RecordIdentity\n                }\n            }\n        }\n        ... on TreeAttribute {\n            values_list {\n                enable\n                allowFreeEntry\n                treeValues: values {\n                    record {\n                        ...RecordIdentity\n                    }\n                    ancestors {\n                        record {\n                            ...RecordIdentity\n                        }\n                    }\n                }\n            }\n        }\n    }\n"])),s.T)},74790:function(e,n,t){t.d(n,{c:function(){return s}});var r,i=t(71171),a=t(42737),l=t.n(a),o=t(50500),s=l()(r||(r=(0,i.Z)(["\n    ","\n    query GET_LIBRARIES($id: ID, $label: String, $system: Boolean, $behavior: [LibraryBehavior!]) {\n        libraries(filters: {id: $id, label: $label, system: $system, behavior: $behavior}) {\n            totalCount\n            list {\n                id\n                system\n                label\n                behavior\n                icon {\n                    ...RecordIdentity\n                }\n                gqlNames {\n                    query\n                    type\n                    list\n                    filter\n                    searchableFields\n                }\n            }\n        }\n    }\n"])),o.T)},18758:function(e,n,t){t.d(n,{w:function(){return s}});var r,i=t(71171),a=t(42737),l=t.n(a),o=t(39359),s=l()(r||(r=(0,i.Z)(["\n    ","\n    query GET_LIB_BY_ID($id: ID, $lang: [AvailableLanguage!]) {\n        libraries(filters: {id: $id}) {\n            list {\n                ...LibraryDetails\n            }\n        }\n    }\n"])),o.o)},39359:function(e,n,t){t.d(n,{o:function(){return s}});var r,i=t(71171),a=t(175),l=t(82332),o=t(50500),s=(0,a.gql)(r||(r=(0,i.Z)(["\n    ","\n    ","\n    fragment LibraryDetails on Library {\n        id\n        system\n        label\n        behavior\n        attributes {\n            ...AttributeDetails\n        }\n        fullTextAttributes {\n            id\n            label\n        }\n        permissions_conf {\n            permissionTreeAttributes {\n                id\n                ... on TreeAttribute {\n                    linked_tree {\n                        id\n                    }\n                }\n                label(lang: $lang)\n            }\n            relation\n        }\n        recordIdentityConf {\n            label\n            color\n            preview\n            treeColorPreview\n        }\n        defaultView {\n            id\n        }\n        gqlNames {\n            query\n            type\n            list\n            filter\n            searchableFields\n        }\n        permissions {\n            admin_library\n            access_library\n            access_record\n            create_record\n            edit_record\n            delete_record\n        }\n        icon {\n            ...RecordIdentity\n        }\n    }\n"])),l.Z,o.T)},2745:function(e,n,t){t.d(n,{Hq:function(){return i},gy:function(){return s}});var r,i,a,l=t(71171),o=t(19913);!function(e){e.BEGIN_WITH="BEGIN_WITH",e.BETWEEN="BETWEEN",e.CLASSIFIED_IN="CLASSIFIED_IN",e.CONTAINS="CONTAINS",e.END_AFTER="END_AFTER",e.END_BEFORE="END_BEFORE",e.END_ON="END_ON",e.END_WITH="END_WITH",e.EQUAL="EQUAL",e.GREATER_THAN="GREATER_THAN",e.IS_EMPTY="IS_EMPTY",e.IS_NOT_EMPTY="IS_NOT_EMPTY",e.LAST_MONTH="LAST_MONTH",e.LESS_THAN="LESS_THAN",e.NEXT_MONTH="NEXT_MONTH",e.NOT_CLASSIFIED_IN="NOT_CLASSIFIED_IN",e.NOT_CONTAINS="NOT_CONTAINS",e.NOT_EQUAL="NOT_EQUAL",e.START_AFTER="START_AFTER",e.START_BEFORE="START_BEFORE",e.START_ON="START_ON",e.TODAY="TODAY",e.TOMORROW="TOMORROW",e.VALUES_COUNT_EQUAL="VALUES_COUNT_EQUAL",e.VALUES_COUNT_GREATER_THAN="VALUES_COUNT_GREATER_THAN",e.VALUES_COUNT_LOWER_THAN="VALUES_COUNT_LOWER_THAN",e.YESTERDAY="YESTERDAY"}(i||(i={})),function(e){e.AND="AND",e.CLOSE_BRACKET="CLOSE_BRACKET",e.OPEN_BRACKET="OPEN_BRACKET",e.OR="OR"}(a||(a={}));var s=function(e){return(0,o.FQ)(r||(r=(0,l.Z)(["\n    query($filters:[RecordFilterInput], $pagination: RecordsPagination) {\n        "," (filters:$filters, pagination: $pagination){\n            totalCount\n            list {\n                whoAmI{\n                    id,\n                    label,\n                    color,\n                    preview {\n                        small\n                        medium\n                        pdf\n                        big\n                    },\n                    library{\n                        id,\n                        label\n                    }\n                }\n            }\n        }\n    }\n"])),e)}},24532:function(e,n,t){t.d(n,{F:function(){return l}});var r,i=t(71171),a=t(42737),l=t.n(a)()(r||(r=(0,i.Z)(["\n    query GET_TREE_BY_ID($id: ID) {\n        trees(filters: {id: $id}) {\n            totalCount\n            list {\n                id\n                label\n                system\n                behavior\n                permissions_conf {\n                    libraryId\n                    permissionsConf {\n                        permissionTreeAttributes {\n                            id\n                            label\n                            ... on TreeAttribute {\n                                linked_tree {\n                                    id\n                                }\n                            }\n                        }\n                        relation\n                    }\n                }\n                libraries {\n                    library {\n                        id\n                        label\n                        attributes {\n                            id\n                            label\n                            type\n                        }\n                    }\n                    settings {\n                        allowMultiplePositions\n                        allowedAtRoot\n                        allowedChildren\n                    }\n                }\n            }\n        }\n    }\n"])))},19913:function(e,n,t){t.d(n,{AX:function(){return r.AX},CE:function(){return r.CE},FQ:function(){return r.FQ},GV:function(){return r.GV},Ku:function(){return r.Ku},NE:function(){return r.NE},PT:function(){return r.PT},Rw:function(){return r.Rw},TB:function(){return r.TB},aW:function(){return r.aW},ci:function(){return r.ci},dX:function(){return r.dX},ei:function(){return r.ei},k9:function(){return r.k9},nV:function(){return r.nV},u_:function(){return r.u_},xN:function(){return r.xN},zQ:function(){return r.zQ}});var r=t(71446)}}]);
//# sourceMappingURL=291.d3ff617d.chunk.js.map